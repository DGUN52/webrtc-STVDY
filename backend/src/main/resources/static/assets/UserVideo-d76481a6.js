import{c as W,a as Ln}from"./_commonjsHelpers-de833af9.js";import{A as ti,K as ni,o as Vn,c as xn,G as ii,a as ri,b as dn,t as oi,z as si}from"./index-ec503cca.js";var ai={},Xt={};(function(r){var t=W&&W.__extends||function(){var n=function(i,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,d){s.__proto__=d}||function(s,d){for(var p in d)Object.prototype.hasOwnProperty.call(d,p)&&(s[p]=d[p])},n(i,o)};return function(i,o){n(i,o);function s(){this.constructor=i}i.prototype=o===null?Object.create(o):(s.prototype=o.prototype,new s)}}();function e(n){if(!n)return e.__;Array.prototype.reduce||(Array.prototype.reduce=function(s,d){for(var p=d,c=0;c<this.length;c++)p=s(p,this[c],c,this);return p});var i="",o=("."+n).split(".").reduce(function(s,d,p,c){i?i+="."+d:i=d;var l=s["__"+i];return l===void 0&&(e.Logger.prototype=s,l=new e.Logger(i),s["__"+i]=l),l},e.__);return o}(function(n){n.requestId="",n.entryId=0,n._createXMLHttpRequest=function(){return new XMLHttpRequest},n._getTime=function(){return new Date().getTime()},n._console=console,n._appenderNames=[];function i(E,f,R){if(f[E]!==void 0){if(f[E]===null){delete R[E];return}R[E]=f[E]}}function o(E){if(n.enabled!=null&&!n.enabled)return!1;try{if(E.userAgentRegex&&!new RegExp(E.userAgentRegex).test(navigator.userAgent))return!1}catch{}try{if(E.ipRegex&&n.clientIP&&!new RegExp(E.ipRegex).test(n.clientIP))return!1}catch{}return!0}function s(E,f){try{if(E.disallow&&new RegExp(E.disallow).test(f))return!1}catch{}return!0}function d(E){return typeof E=="function"?E instanceof RegExp?E.toString():E():E}var p=function(){function E(f,R,B){this.msg=f,this.meta=R,this.finalString=B}return E}();function c(E){var f=d(E),R;switch(typeof f){case"string":return new p(f,null,f);case"number":return R=f.toString(),new p(R,null,R);case"boolean":return R=f.toString(),new p(R,null,R);case"undefined":return new p("undefined",null,"undefined");case"object":return f instanceof RegExp||f instanceof String||f instanceof Number||f instanceof Boolean?(R=f.toString(),new p(R,null,R)):(typeof n.serialize=="function"?R=n.serialize.call(this,f):R=JSON.stringify(f),new p("",f,R));default:return new p("unknown",null,"unknown")}}function l(E){return i("enabled",E,this),i("maxMessages",E,this),i("defaultAjaxUrl",E,this),i("clientIP",E,this),i("requestId",E,this),i("defaultBeforeSend",E,this),i("serialize",E,this),this}n.setOptions=l;function b(){return-2147483648}n.getAllLevel=b;function y(){return 1e3}n.getTraceLevel=y;function O(){return 2e3}n.getDebugLevel=O;function P(){return 3e3}n.getInfoLevel=P;function k(){return 4e3}n.getWarnLevel=k;function I(){return 5e3}n.getErrorLevel=I;function v(){return 6e3}n.getFatalLevel=v;function T(){return 2147483647}n.getOffLevel=T;function D(E){return E<=1e3?"trace":E<=2e3?"debug":E<=3e3?"info":E<=4e3?"warn":E<=5e3?"error":"fatal"}var C=function(){function E(f,R){this.inner=R,this.name="JL.Exception",this.message=c(f).finalString}return E}();n.Exception=C,C.prototype=new Error;var L=function(){function E(f,R,B,x,H){this.l=f,this.m=R,this.n=B,this.t=x,this.u=H}return E}();n.LogItem=L;function F(E,f,R){return n.entryId++,new L(E,f,R,n._getTime(),n.entryId)}function U(E){E.id&&(clearTimeout(E.id),E.id=null)}function u(E,f,R){var B=this;E.id||(E.id=setTimeout(function(){R.call(B)},f))}var a=function(){function E(f,R){this.appenderName=f,this.sendLogItems=R,this.level=n.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var B="Trying to create an appender without a name or with an empty name";if(f==null)throw B;if(n._appenderNames.indexOf(f)!=-1)throw f?"Multiple appenders use the same name "+f:B;n._appenderNames.push(f)}return E.prototype.addLogItemsToBuffer=function(f){if(this.batchBuffer.length>=this.maxBatchSize){this.nbrLogItemsSkipped+=f.length;return}if(n.maxMessages!=null){if(n.maxMessages<1)return;n.maxMessages-=f.length}this.batchBuffer=this.batchBuffer.concat(f);var R=this;u(this.batchTimeoutTimer,this.batchTimeout,function(){R.sendBatch.call(R)})},E.prototype.batchBufferHasOverdueMessages=function(){for(var f=0;f<this.batchBuffer.length;f++){var R=n._getTime()-this.batchBuffer[f].t;if(R>this.batchTimeout)return!0}return!1},E.prototype.batchBufferHasStrandedMessage=function(){return n.maxMessages!=null&&n.maxMessages<1&&this.batchBuffer.length>0},E.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},E.prototype.onSendingEnded=function(){U(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},E.prototype.setOptions=function(f){if(i("level",f,this),i("ipRegex",f,this),i("userAgentRegex",f,this),i("disallow",f,this),i("sendWithBufferLevel",f,this),i("storeInBufferLevel",f,this),i("bufferSize",f,this),i("batchSize",f,this),i("maxBatchSize",f,this),i("batchTimeout",f,this),i("sendTimeout",f,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new n.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},E.prototype.log=function(f,R,B,x,H,j,Z){var J;if(o(this)&&s(this,j)&&!(H<this.storeInBufferLevel)){if(J=F(H,j,Z),H<this.level){this.bufferSize>0&&(this.buffer.push(J),this.buffer.length>this.bufferSize&&this.buffer.shift());return}this.addLogItemsToBuffer([J]),H>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete()}},E.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)&&(U(this.batchTimeoutTimer),this.batchBuffer.length!=0)){this.nbrLogItemsBeingSent=this.batchBuffer.length;var f=this;u(this.sendTimeoutTimer,this.sendTimeout,function(){f.onSendingEnded.call(f)}),this.sendLogItems(this.batchBuffer,function(){f.batchBuffer.splice(0,f.nbrLogItemsBeingSent),f.nbrLogItemsSkipped>0&&(f.batchBuffer.push(F(k(),"Lost "+f.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",f.appenderName)),f.nbrLogItemsSkipped=0),f.onSendingEnded.call(f)})}},E}();n.Appender=a;var h=function(E){t(f,E);function f(R){return E.call(this,R,f.prototype.sendLogItemsAjax)||this}return f.prototype.setOptions=function(R){return i("url",R,this),i("beforeSend",R,this),E.prototype.setOptions.call(this,R),this},f.prototype.sendLogItemsAjax=function(R,B){try{if(!o(this))return;this.xhr&&this.xhr.readyState!=0&&this.xhr.readyState!=4&&this.xhr.abort(),this.xhr=n._createXMLHttpRequest();var x="/jsnlog.logger";n.defaultAjaxUrl!=null&&(x=n.defaultAjaxUrl),this.url&&(x=this.url),this.xhr.open("POST",x),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",n.requestId);var H=this;this.xhr.onreadystatechange=function(){H.xhr.readyState==4&&H.xhr.status>=200&&H.xhr.status<300&&B()};var j={r:n.requestId,lg:R};typeof this.beforeSend=="function"?this.beforeSend.call(this,this.xhr,j):typeof n.defaultBeforeSend=="function"&&n.defaultBeforeSend.call(this,this.xhr,j);var Z=JSON.stringify(j);this.xhr.send(Z)}catch{}},f}(a);n.AjaxAppender=h;var g=function(E){t(f,E);function f(R){return E.call(this,R,f.prototype.sendLogItemsConsole)||this}return f.prototype.clog=function(R){n._console.log(R)},f.prototype.cerror=function(R){n._console.error?n._console.error(R):this.clog(R)},f.prototype.cwarn=function(R){n._console.warn?n._console.warn(R):this.clog(R)},f.prototype.cinfo=function(R){n._console.info?n._console.info(R):this.clog(R)},f.prototype.cdebug=function(R){n._console.debug?n._console.debug(R):this.cinfo(R)},f.prototype.sendLogItemsConsole=function(R,B){try{if(!o(this)||!n._console)return;var x;for(x=0;x<R.length;++x){var H=R[x],j=H.n+": "+H.m;typeof window>"u"&&(j=new Date(H.t)+" | "+j),H.l<=n.getDebugLevel()?this.cdebug(j):H.l<=n.getInfoLevel()?this.cinfo(j):H.l<=n.getWarnLevel()?this.cwarn(j):this.cerror(j)}}catch{}B()},f}(a);n.ConsoleAppender=g;var m=function(){function E(f){this.loggerName=f,this.seenRegexes=[]}return E.prototype.setOptions=function(f){return i("level",f,this),i("userAgentRegex",f,this),i("disallow",f,this),i("ipRegex",f,this),i("appenders",f,this),i("onceOnly",f,this),this.seenRegexes=[],this},E.prototype.buildExceptionObject=function(f){var R={};return f.stack?R.stack=f.stack:R.e=f,f.message&&(R.message=f.message),f.name&&(R.name=f.name),f.data&&(R.data=f.data),f.inner&&(R.inner=this.buildExceptionObject(f.inner)),R},E.prototype.log=function(f,R,B){var x=0,H,j;if(!this.appenders)return this;if(f>=this.level&&o(this)&&(B?(j=this.buildExceptionObject(B),j.logData=d(R)):j=R,H=c(j),s(this,H.finalString))){if(this.onceOnly)for(x=this.onceOnly.length-1;x>=0;){if(new RegExp(this.onceOnly[x]).test(H.finalString)){if(this.seenRegexes[x])return this;this.seenRegexes[x]=!0}x--}for(H.meta=H.meta||{},x=this.appenders.length-1;x>=0;)this.appenders[x].log(D(f),H.msg,H.meta,function(){},f,H.finalString,this.loggerName),x--}return this},E.prototype.trace=function(f){return this.log(y(),f)},E.prototype.debug=function(f){return this.log(O(),f)},E.prototype.info=function(f){return this.log(P(),f)},E.prototype.warn=function(f){return this.log(k(),f)},E.prototype.error=function(f){return this.log(I(),f)},E.prototype.fatal=function(f){return this.log(v(),f)},E.prototype.fatalException=function(f,R){return this.log(v(),f,R)},E}();n.Logger=m;function S(E){return new h(E)}n.createAjaxAppender=S;function _(E){return new g(E)}n.createConsoleAppender=_;var M;typeof window<"u"?M=new h(""):M=new g(""),n.__=new n.Logger(""),n.__.setOptions({level:n.getDebugLevel(),appenders:[M]})})(e||(e={})),r.__esModule=!0,r.JL=e,typeof __jsnlog_configure=="function"&&__jsnlog_configure(e),typeof window<"u"&&!window.onerror&&(window.onerror=function(n,i,o,s,d){return e("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:n?n.message||n:"",url:i,"line number":o,column:s},d),!1}),typeof window<"u"&&!window.onunhandledrejection&&(window.onunhandledrejection=function(n){e("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:n.reason?n.reason.message:n.message||null},n.reason)})})(Xt);var Ot={},rt={},Yt={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.LocalRecorderState=void 0,function(t){t.READY="READY",t.RECORDING="RECORDING",t.PAUSED="PAUSED",t.FINISHED="FINISHED"}(r.LocalRecorderState||(r.LocalRecorderState={}))})(Yt);var oe={},_t={};Object.defineProperty(_t,"__esModule",{value:!0});_t.ConsoleLogger=void 0;var ci=function(){function r(t){this.logger=t,this.log=window.console.log,this.info=window.console.info,this.debug=window.console.debug,this.warn=window.console.warn,this.error=window.console.error}return r}();_t.ConsoleLogger=ci;var Qt={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.OpenViduLoggerConfiguration=void 0,function(t){t.disabled="disabled",t.debug="debug",t.debug_app="debug_app"}(r.OpenViduLoggerConfiguration||(r.OpenViduLoggerConfiguration={}))})(Qt);Object.defineProperty(oe,"__esModule",{value:!0});oe.OpenViduLogger=void 0;var Se=Xt,di=_t,Mt=Qt,ui=function(){function r(){this.JSNLOG_URL="/openvidu/elk/openvidu-browser-logs",this.MAX_JSNLOG_BATCH_LOG_MESSAGES=100,this.MAX_MSECONDS_BATCH_MESSAGES=5e3,this.MAX_LENGTH_STRING_JSON=1e3,this.defaultConsoleLogger=new di.ConsoleLogger(window.console),this.isProdMode=!1,this.isJSNLogSetup=!1}return r.configureJSNLog=function(t,e){var n=this;try{if(window.LOG_JSNLOG_RESULTS||this.instance&&t.isPro&&this.instance.isOpenViduBrowserLogsDebugActive(t)&&this.instance.canConfigureJSNLog(t,this.instance)){t.sendBrowserLogs===Mt.OpenViduLoggerConfiguration.debug_app&&this.instance.replaceWindowConsole(),this.instance.isJSNLogSetup=!1,this.instance.info("Configuring JSNLogs.");var i=t.finalUserId,o=t.session.sessionId,s=function(p){var c=p.onreadystatechange;p.onreadystatechange=function(){n.isInvalidResponse(p)&&(Object.defineProperty(p,"readyState",{value:4}),Object.defineProperty(p,"status",{value:200}),n.instance.disableLogger()),c()},p.setRequestHeader("Authorization","Basic "+btoa(i+"%/%"+o+":"+e)),p.setRequestHeader("X-Requested-With","XMLHttpRequest"),p.setRequestHeader("OV-Final-User-Id",i),p.setRequestHeader("OV-Session-Id",o),p.setRequestHeader("OV-Token",e)};this.instance.currentAppender=Se.JL.createAjaxAppender("appender-"+i+"-"+o),this.instance.currentAppender.setOptions({beforeSend:s,maxBatchSize:1e3,batchSize:this.instance.MAX_JSNLOG_BATCH_LOG_MESSAGES,batchTimeout:this.instance.MAX_MSECONDS_BATCH_MESSAGES});var d=function(p){var c=function(){var b=new WeakSet;return function(y,O){if(typeof O=="object"&&O!=null){if(b.has(O)||HTMLElement&&O instanceof HTMLElement)return;b.add(O)}return O}},l=JSON.stringify(p,c());return l.length>n.instance.MAX_LENGTH_STRING_JSON&&(l=l.substring(0,n.instance.MAX_LENGTH_STRING_JSON)+"..."),window.LOG_JSNLOG_RESULTS&&console.log(l),l};Se.JL.setOptions({defaultAjaxUrl:t.httpUri+this.instance.JSNLOG_URL,serialize:d,enabled:!0}),Se.JL().setOptions({appenders:[this.instance.currentAppender]}),this.instance.isJSNLogSetup=!0,this.instance.loggingSessionId=o,this.instance.info("JSNLog configured.")}}catch(p){console.error("Error configuring JSNLog: "),console.error(p),this.instance.disableLogger()}},r.getInstance=function(){return r.instance||(r.instance=new r),r.instance},r.isInvalidResponse=function(t){return t.status==401||t.status==403||t.status==404||t.status==0},r.prototype.canConfigureJSNLog=function(t,e){return t.session.sessionId!=e.loggingSessionId},r.prototype.isOpenViduBrowserLogsDebugActive=function(t){return t.sendBrowserLogs===Mt.OpenViduLoggerConfiguration.debug||t.sendBrowserLogs===Mt.OpenViduLoggerConfiguration.debug_app},r.prototype.getConsoleWithJSNLog=function(){return function(t){return{log:function(){t.defaultConsoleLogger.log.apply(t.defaultConsoleLogger.logger,arguments),t.isJSNLogSetup&&Se.JL().info(arguments)},info:function(){t.defaultConsoleLogger.info.apply(t.defaultConsoleLogger.logger,arguments),t.isJSNLogSetup&&Se.JL().info(arguments)},debug:function(){t.defaultConsoleLogger.debug.apply(t.defaultConsoleLogger.logger,arguments)},warn:function(){t.defaultConsoleLogger.warn.apply(t.defaultConsoleLogger.logger,arguments),t.isJSNLogSetup&&Se.JL().warn(arguments)},error:function(){t.defaultConsoleLogger.error.apply(t.defaultConsoleLogger.logger,arguments),t.isJSNLogSetup&&Se.JL().error(arguments)}}}(this)},r.prototype.replaceWindowConsole=function(){window.console=this.defaultConsoleLogger.logger,window.console.log=this.getConsoleWithJSNLog().log,window.console.info=this.getConsoleWithJSNLog().info,window.console.debug=this.getConsoleWithJSNLog().debug,window.console.warn=this.getConsoleWithJSNLog().warn,window.console.error=this.getConsoleWithJSNLog().error},r.prototype.disableLogger=function(){Se.JL.setOptions({enabled:!1}),this.isJSNLogSetup=!1,this.loggingSessionId=void 0,this.currentAppender=void 0,window.console=this.defaultConsoleLogger.logger,window.console.log=this.defaultConsoleLogger.log,window.console.info=this.defaultConsoleLogger.info,window.console.debug=this.defaultConsoleLogger.debug,window.console.warn=this.defaultConsoleLogger.warn,window.console.error=this.defaultConsoleLogger.error},r.prototype.log=function(){this.isProdMode||this.defaultConsoleLogger.log.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&Se.JL().info(arguments)},r.prototype.debug=function(){this.isProdMode||this.defaultConsoleLogger.debug.apply(this.defaultConsoleLogger.logger,arguments)},r.prototype.info=function(){this.isProdMode||this.defaultConsoleLogger.info.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&Se.JL().info(arguments)},r.prototype.warn=function(){this.isProdMode||this.defaultConsoleLogger.warn.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&Se.JL().warn(arguments)},r.prototype.error=function(){this.defaultConsoleLogger.error.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&Se.JL().error(arguments)},r.prototype.flush=function(){this.isJSNLogSetup&&this.currentAppender!=null&&this.currentAppender.sendBatch()},r.prototype.enableProdMode=function(){this.isProdMode=!0},r}();oe.OpenViduLogger=ui;var Ce={},St={exports:{}};/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */St.exports;(function(r,t){(function(){var e={function:!0,object:!0},n=e[typeof window]&&window||this,i=t,o=r&&!r.nodeType&&r,s=i&&o&&typeof W=="object"&&W;s&&(s.global===s||s.window===s||s.self===s)&&(n=s);var d=Math.pow(2,53)-1,p=/\bOpera/,c=Object.prototype,l=c.hasOwnProperty,b=c.toString;function y(u){return u=String(u),u.charAt(0).toUpperCase()+u.slice(1)}function O(u,a,h){var g={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return a&&h&&/^Win/i.test(u)&&!/^Windows Phone /i.test(u)&&(g=g[/[\d.]+$/.exec(u)])&&(u="Windows "+g),u=String(u),a&&h&&(u=u.replace(RegExp(a,"i"),h)),u=k(u.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),u}function P(u,a){var h=-1,g=u?u.length:0;if(typeof g=="number"&&g>-1&&g<=d)for(;++h<g;)a(u[h],h,u);else I(u,a)}function k(u){return u=L(u),/^(?:webOS|i(?:OS|P))/.test(u)?u:y(u)}function I(u,a){for(var h in u)l.call(u,h)&&a(u[h],h,u)}function v(u){return u==null?y(u):b.call(u).slice(8,-1)}function T(u,a){var h=u!=null?typeof u[a]:"number";return!/^(?:boolean|number|string|undefined)$/.test(h)&&(h=="object"?!!u[a]:!0)}function D(u){return String(u).replace(/([ -])(?!$)/g,"$1?")}function C(u,a){var h=null;return P(u,function(g,m){h=a(h,g,m,u)}),h}function L(u){return String(u).replace(/^ +| +$/g,"")}function F(u){var a=n,h=u&&typeof u=="object"&&v(u)!="String";h&&(a=u,u=null);var g=a.navigator||{},m=g.userAgent||"";u||(u=m);var S=h?!!g.likeChrome:/\bChrome\b/.test(u)&&!/internal|\n/i.test(b.toString()),_="Object",M=h?_:"ScriptBridgingProxyObject",E=h?_:"Environment",f=h&&a.java?"JavaPackage":v(a.java),R=h?_:"RuntimeObject",B=/\bJava/.test(f)&&a.java,x=B&&v(a.environment)==E,H=B?"a":"α",j=B?"b":"β",Z=a.document||{},J=a.operamini||a.opera,te=p.test(te=h&&J?J["[[Class]]"]:v(J))?te:J=null,w,re=u,$=[],Oe=null,ue=u==m,A=ue&&J&&typeof J.version=="function"&&J.version(),Ee,z=Yn([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),N=Kn(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),q=an([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),ie=Qn({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),V=Zn(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function Yn(fe){return C(fe,function(ne,Q){return ne||RegExp("\\b"+(Q.pattern||D(Q))+"\\b","i").exec(u)&&(Q.label||Q)})}function Qn(fe){return C(fe,function(ne,Q,ye){return ne||(Q[q]||Q[/^[a-z]+(?: +[a-z]+\b)*/i.exec(q)]||RegExp("\\b"+D(ye)+"(?:\\b|\\w*\\d)","i").exec(u))&&ye})}function Kn(fe){return C(fe,function(ne,Q){return ne||RegExp("\\b"+(Q.pattern||D(Q))+"\\b","i").exec(u)&&(Q.label||Q)})}function Zn(fe){return C(fe,function(ne,Q){var ye=Q.pattern||D(Q);return!ne&&(ne=RegExp("\\b"+ye+"(?:/[\\d.]+|[ \\w.]*)","i").exec(u))&&(ne=O(ne,ye,Q.label||Q)),ne})}function an(fe){return C(fe,function(ne,Q){var ye=Q.pattern||D(Q);return!ne&&(ne=RegExp("\\b"+ye+" *\\d+[.\\w_]*","i").exec(u)||RegExp("\\b"+ye+" *\\w+-[\\w]*","i").exec(u)||RegExp("\\b"+ye+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(u))&&((ne=String(Q.label&&!RegExp(ye,"i").test(Q.label)?Q.label:ne).split("/"))[1]&&!/[\d.]+/.test(ne[0])&&(ne[0]+=" "+ne[1]),Q=Q.label||Q,ne=k(ne[0].replace(RegExp(ye,"i"),Q).replace(RegExp("; *(?:"+Q+"[_-])?","i")," ").replace(RegExp("("+Q+")[-_.]?(\\w)","i"),"$1 $2"))),ne})}function cn(fe){return C(fe,function(ne,Q){return ne||(RegExp(Q+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(u)||0)[1]||null})}function ei(){return this.description||""}if(z&&(z=[z]),/\bAndroid\b/.test(V)&&!q&&(w=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(u))&&(q=L(w[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),ie&&!q?q=an([ie]):ie&&q&&(q=q.replace(RegExp("^("+D(ie)+")[-_.\\s]","i"),ie+" ").replace(RegExp("^("+D(ie)+")[-_.]?(\\w)","i"),ie+" $2")),(w=/\bGoogle TV\b/.exec(q))&&(q=w[0]),/\bSimulator\b/i.test(u)&&(q=(q?q+" ":"")+"Simulator"),N=="Opera Mini"&&/\bOPiOS\b/.test(u)&&$.push("running in Turbo/Uncompressed mode"),N=="IE"&&/\blike iPhone OS\b/.test(u)?(w=F(u.replace(/like iPhone OS/,"")),ie=w.manufacturer,q=w.product):/^iP/.test(q)?(N||(N="Safari"),V="iOS"+((w=/ OS ([\d_]+)/i.exec(u))?" "+w[1].replace(/_/g,"."):"")):N=="Konqueror"&&/^Linux\b/i.test(V)?V="Kubuntu":ie&&ie!="Google"&&(/Chrome/.test(N)&&!/\bMobile Safari\b/i.test(u)||/\bVita\b/.test(q))||/\bAndroid\b/.test(V)&&/^Chrome/.test(N)&&/\bVersion\//i.test(u)?(N="Android Browser",V=/\bAndroid\b/.test(V)?V:"Android"):N=="Silk"?(/\bMobi/i.test(u)||(V="Android",$.unshift("desktop mode")),/Accelerated *= *true/i.test(u)&&$.unshift("accelerated")):N=="UC Browser"&&/\bUCWEB\b/.test(u)?$.push("speed mode"):N=="PaleMoon"&&(w=/\bFirefox\/([\d.]+)\b/.exec(u))?$.push("identifying as Firefox "+w[1]):N=="Firefox"&&(w=/\b(Mobile|Tablet|TV)\b/i.exec(u))?(V||(V="Firefox OS"),q||(q=w[1])):!N||(w=!/\bMinefield\b/i.test(u)&&/\b(?:Firefox|Safari)\b/.exec(N))?(N&&!q&&/[\/,]|^[^(]+?\)/.test(u.slice(u.indexOf(w+"/")+8))&&(N=null),(w=q||ie||V)&&(q||ie||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(V))&&(N=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(V)?V:w)+" Browser")):N=="Electron"&&(w=(/\bChrome\/([\d.]+)\b/.exec(u)||0)[1])&&$.push("Chromium "+w),A||(A=cn(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",D(N),"(?:Firefox|Minefield|NetFront)"])),(w=z=="iCab"&&parseFloat(A)>3&&"WebKit"||/\bOpera\b/.test(N)&&(/\bOPR\b/.test(u)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(u)&&!/^(?:Trident|EdgeHTML)$/.test(z)&&"WebKit"||!z&&/\bMSIE\b/i.test(u)&&(V=="Mac OS"?"Tasman":"Trident")||z=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(N)&&"NetFront")&&(z=[w]),N=="IE"&&(w=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(u)||0)[1])?(N+=" Mobile",V="Windows Phone "+(/\+$/.test(w)?w:w+".x"),$.unshift("desktop mode")):/\bWPDesktop\b/i.test(u)?(N="IE Mobile",V="Windows Phone 8.x",$.unshift("desktop mode"),A||(A=(/\brv:([\d.]+)/.exec(u)||0)[1])):N!="IE"&&z=="Trident"&&(w=/\brv:([\d.]+)/.exec(u))&&(N&&$.push("identifying as "+N+(A?" "+A:"")),N="IE",A=w[1]),ue){if(T(a,"global"))if(B&&(w=B.lang.System,re=w.getProperty("os.arch"),V=V||w.getProperty("os.name")+" "+w.getProperty("os.version")),x){try{A=a.require("ringo/engine").version.join("."),N="RingoJS"}catch{(w=a.system)&&w.global.system==a.system&&(N="Narwhal",V||(V=w[0].os||null))}N||(N="Rhino")}else typeof a.process=="object"&&!a.process.browser&&(w=a.process)&&(typeof w.versions=="object"&&(typeof w.versions.electron=="string"?($.push("Node "+w.versions.node),N="Electron",A=w.versions.electron):typeof w.versions.nw=="string"&&($.push("Chromium "+A,"Node "+w.versions.node),N="NW.js",A=w.versions.nw)),N||(N="Node.js",re=w.arch,V=w.platform,A=/[\d.]+/.exec(w.version),A=A?A[0]:null));else v(w=a.runtime)==M?(N="Adobe AIR",V=w.flash.system.Capabilities.os):v(w=a.phantom)==R?(N="PhantomJS",A=(w=w.version||null)&&w.major+"."+w.minor+"."+w.patch):typeof Z.documentMode=="number"&&(w=/\bTrident\/(\d+)/i.exec(u))?(A=[A,Z.documentMode],(w=+w[1]+4)!=A[1]&&($.push("IE "+A[1]+" mode"),z&&(z[1]=""),A[1]=w),A=N=="IE"?String(A[1].toFixed(1)):A[0]):typeof Z.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(N)&&($.push("masking as "+N+" "+A),N="IE",A="11.0",z=["Trident"],V="Windows");V=V&&k(V)}if(A&&(w=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(A)||/(?:alpha|beta)(?: ?\d)?/i.exec(u+";"+(ue&&g.appMinorVersion))||/\bMinefield\b/i.test(u)&&"a")&&(Oe=/b/i.test(w)?"beta":"alpha",A=A.replace(RegExp(w+"\\+?$"),"")+(Oe=="beta"?j:H)+(/\d+\+?/.exec(w)||"")),N=="Fennec"||N=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(V))N="Firefox Mobile";else if(N=="Maxthon"&&A)A=A.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(q))q=="Xbox 360"&&(V=null),q=="Xbox 360"&&/\bIEMobile\b/.test(u)&&$.unshift("mobile mode");else if((/^(?:Chrome|IE|Opera)$/.test(N)||N&&!q&&!/Browser|Mobi/.test(N))&&(V=="Windows CE"||/Mobi/i.test(u)))N+=" Mobile";else if(N=="IE"&&ue)try{a.external===null&&$.unshift("platform preview")}catch{$.unshift("embedded")}else(/\bBlackBerry\b/.test(q)||/\bBB10\b/.test(u))&&(w=(RegExp(q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(u)||0)[1]||A)?(w=[w,/BB10/.test(u)],V=(w[1]?(q=null,ie="BlackBerry"):"Device Software")+" "+w[0],A=null):this!=I&&q!="Wii"&&(ue&&J||/Opera/.test(N)&&/\b(?:MSIE|Firefox)\b/i.test(u)||N=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(V)||N=="IE"&&(V&&!/^Win/.test(V)&&A>5.5||/\bWindows XP\b/.test(V)&&A>8||A==8&&!/\bTrident\b/.test(u)))&&!p.test(w=F.call(I,u.replace(p,"")+";"))&&w.name&&(w="ing as "+w.name+((w=w.version)?" "+w:""),p.test(N)?(/\bIE\b/.test(w)&&V=="Mac OS"&&(V=null),w="identify"+w):(w="mask"+w,te?N=k(te.replace(/([a-z])([A-Z])/g,"$1 $2")):N="Opera",/\bIE\b/.test(w)&&(V=null),ue||(A=null)),z=["Presto"],$.push(w));(w=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(u)||0)[1])&&(w=[parseFloat(w.replace(/\.(\d)$/,".0$1")),w],N=="Safari"&&w[1].slice(-1)=="+"?(N="WebKit Nightly",Oe="alpha",A=w[1].slice(0,-1)):(A==w[1]||A==(w[2]=(/\bSafari\/([\d.]+\+?)/i.exec(u)||0)[1]))&&(A=null),w[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(u)||0)[1],w[0]==537.36&&w[2]==537.36&&parseFloat(w[1])>=28&&z=="WebKit"&&(z=["Blink"]),!ue||!S&&!w[1]?(z&&(z[1]="like Safari"),w=(w=w[0],w<400?1:w<500?2:w<526?3:w<533?4:w<534?"4+":w<535?5:w<537?6:w<538?7:w<601?8:w<602?9:w<604?10:w<606?11:w<608?12:"12")):(z&&(z[1]="like Chrome"),w=w[1]||(w=w[0],w<530?1:w<532?2:w<532.05?3:w<533?4:w<534.03?5:w<534.07?6:w<534.1?7:w<534.13?8:w<534.16?9:w<534.24?10:w<534.3?11:w<535.01?12:w<535.02?"13+":w<535.07?15:w<535.11?16:w<535.19?17:w<536.05?18:w<536.1?19:w<537.01?20:w<537.11?"21+":w<537.13?23:w<537.18?24:w<537.24?25:w<537.36?26:z!="Blink"?"27":"28")),z&&(z[1]+=" "+(w+=typeof w=="number"?".x":/[.+]/.test(w)?"":"+")),N=="Safari"&&(!A||parseInt(A)>45)?A=w:N=="Chrome"&&/\bHeadlessChrome/i.test(u)&&$.unshift("headless")),N=="Opera"&&(w=/\bzbov|zvav$/.exec(V))?(N+=" ",$.unshift("desktop mode"),w=="zvav"?(N+="Mini",A=null):N+="Mobile",V=V.replace(RegExp(" *"+w+"$"),"")):N=="Safari"&&/\bChrome\b/.exec(z&&z[1])?($.unshift("desktop mode"),N="Chrome Mobile",A=null,/\bOS X\b/.test(V)?(ie="Apple",V="iOS 4.3+"):V=null):/\bSRWare Iron\b/.test(N)&&!A&&(A=cn("Chrome")),A&&A.indexOf(w=/[\d.]+$/.exec(V))==0&&u.indexOf("/"+w+"-")>-1&&(V=L(V.replace(w,""))),V&&V.indexOf(N)!=-1&&!RegExp(N+" OS").test(V)&&(V=V.replace(RegExp(" *"+D(N)+" *"),"")),z&&!/\b(?:Avant|Nook)\b/.test(N)&&(/Browser|Lunascape|Maxthon/.test(N)||N!="Safari"&&/^iOS/.test(V)&&/\bSafari\b/.test(z[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(N)&&z[1])&&(w=z[z.length-1])&&$.push(w),$.length&&($=["("+$.join("; ")+")"]),ie&&q&&q.indexOf(ie)<0&&$.push("on "+ie),q&&$.push((/^on /.test($[$.length-1])?"":"on ")+q),V&&(w=/ ([\d.+]+)$/.exec(V),Ee=w&&V.charAt(V.length-w[0].length-1)=="/",V={architecture:32,family:w&&!Ee?V.replace(w[0],""):V,version:w?w[1]:null,toString:function(){var fe=this.version;return this.family+(fe&&!Ee?" "+fe:"")+(this.architecture==64?" 64-bit":"")}}),(w=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(re))&&!/\bi686\b/i.test(re)?(V&&(V.architecture=64,V.family=V.family.replace(RegExp(" *"+w),"")),N&&(/\bWOW64\b/i.test(u)||ue&&/\w(?:86|32)$/.test(g.cpuClass||g.platform)&&!/\bWin64; x64\b/i.test(u))&&$.unshift("32-bit")):V&&/^OS X/.test(V.family)&&N=="Chrome"&&parseFloat(A)>=39&&(V.architecture=64),u||(u=null);var me={};return me.description=u,me.layout=z&&z[0],me.manufacturer=ie,me.name=N,me.prerelease=Oe,me.product=q,me.ua=u,me.version=N&&A,me.os=V||{architecture:null,family:null,version:null,toString:function(){return"null"}},me.parse=F,me.toString=ei,me.version&&$.unshift(A),me.name&&$.unshift(N),V&&N&&!(V==String(V).split(" ")[0]&&(V==N.split(" ")[0]||q))&&$.push(q?"("+V+")":"on "+V),$.length&&(me.description=$.join(" ")),me}var U=F();i&&o?I(U,function(u,a){i[a]=u}):n.platform=U}).call(W)})(St,St.exports);var fi=St.exports;Object.defineProperty(Ce,"__esModule",{value:!0});Ce.PlatformUtils=void 0;var G=fi,li=function(){function r(){}return r.getInstance=function(){return this.instance||(this.instance=new r),r.instance},r.prototype.isChromeBrowser=function(){return G.name==="Chrome"},r.prototype.isSafariBrowser=function(){return G.name==="Safari"},r.prototype.isChromeMobileBrowser=function(){return G.name==="Chrome Mobile"},r.prototype.isFirefoxBrowser=function(){return G.name==="Firefox"},r.prototype.isFirefoxMobileBrowser=function(){return G.name==="Firefox Mobile"||G.name==="Firefox for iOS"},r.prototype.isOperaBrowser=function(){return G.name==="Opera"},r.prototype.isOperaMobileBrowser=function(){return G.name==="Opera Mobile"},r.prototype.isEdgeBrowser=function(){var t=G!=null&&G.version?parseFloat(G.version):-1;return G.name==="Microsoft Edge"&&t>=80},r.prototype.isEdgeMobileBrowser=function(){var t,e,n=G!=null&&G.version?parseFloat(G.version):-1;return G.name==="Microsoft Edge"&&(((t=G.os)===null||t===void 0?void 0:t.family)==="Android"||((e=G.os)===null||e===void 0?void 0:e.family)==="iOS")&&n>45},r.prototype.isAndroidBrowser=function(){return G.name==="Android Browser"},r.prototype.isElectron=function(){return G.name==="Electron"},r.prototype.isSamsungBrowser=function(){return G.name==="Samsung Internet Mobile"||G.name==="Samsung Internet"},r.prototype.isIPhoneOrIPad=function(){var t=G.ua?G.ua:navigator.userAgent,e="ontouchend"in document,n=/\b(\w*Macintosh\w*)\b/.test(t)&&e,i=/\b(\w*iPhone\w*)\b/.test(t)&&/\b(\w*Mobile\w*)\b/.test(t)&&e;return n||i},r.prototype.isIOSWithSafari=function(){var t=G.ua?G.ua:navigator.userAgent;return this.isIPhoneOrIPad()&&/\b(\w*Apple\w*)\b/.test(navigator.vendor)&&/\b(\w*Safari\w*)\b/.test(t)&&!/\b(\w*CriOS\w*)\b/.test(t)&&!/\b(\w*FxiOS\w*)\b/.test(t)},r.prototype.isIonicIos=function(){return this.isIPhoneOrIPad()&&G.ua.indexOf("Safari")===-1},r.prototype.isIonicAndroid=function(){return G.os.family==="Android"&&G.name=="Android Browser"},r.prototype.isMobileDevice=function(){return G.os.family==="iOS"||G.os.family==="Android"},r.prototype.isReactNative=function(){return!1},r.prototype.isChromium=function(){return this.isChromeBrowser()||this.isChromeMobileBrowser()||this.isOperaBrowser()||this.isOperaMobileBrowser()||this.isEdgeBrowser()||this.isEdgeMobileBrowser()||this.isSamsungBrowser()||this.isIonicAndroid()||this.isIonicIos()||this.isElectron()},r.prototype.canScreenShare=function(){var t=G!=null&&G.version?parseFloat(G.version):-1;return this.isMobileDevice()?!1:this.isChromeBrowser()||this.isFirefoxBrowser()||this.isOperaBrowser()||this.isElectron()||this.isEdgeBrowser()||this.isSafariBrowser()&&t>=13},r.prototype.getName=function(){return G.name||""},r.prototype.getVersion=function(){return G.version||""},r.prototype.getFamily=function(){return G.os.family||""},r.prototype.getDescription=function(){return G.description||""},r}();Ce.PlatformUtils=li;Object.defineProperty(rt,"__esModule",{value:!0});rt.LocalRecorder=void 0;var se=Yt,hi=oe,pi=Ce,_e=hi.OpenViduLogger.getInstance(),un,vi=function(){function r(t){this.stream=t,this.chunks=[],un=pi.PlatformUtils.getInstance(),this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=se.LocalRecorderState.READY}return r.prototype.record=function(t){var e=this;return new Promise(function(n,i){try{if(typeof MediaRecorder>"u")throw _e.error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder"),Error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder");if(e.state!==se.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+e.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");_e.log("Starting local recording of stream '"+e.stream.streamId+"' of connection '"+e.connectionId+"'");var o={};typeof MediaRecorder.isTypeSupported=="function"?t?(MediaRecorder.isTypeSupported(t)||i(new Error('mimeType "'+t+'" is not supported')),o={mimeType:t}):_e.log("No mimeType parameter provided. Using default codecs"):_e.warn("MediaRecorder#isTypeSupported is not supported. Using default codecs"),e.mediaRecorder=new MediaRecorder(e.stream.getMediaStream(),o),e.mediaRecorder.start(10)}catch(s){i(s)}e.mediaRecorder.ondataavailable=function(s){e.chunks.push(s.data)},e.mediaRecorder.onerror=function(s){_e.error("MediaRecorder error: ",s)},e.mediaRecorder.onstart=function(){_e.log("MediaRecorder started (state="+e.mediaRecorder.state+")")},e.mediaRecorder.onstop=function(){e.onStopDefault()},e.mediaRecorder.onpause=function(){_e.log("MediaRecorder paused (state="+e.mediaRecorder.state+")")},e.mediaRecorder.onresume=function(){_e.log("MediaRecorder resumed (state="+e.mediaRecorder.state+")")},e.mediaRecorder.onwarning=function(s){_e.log("MediaRecorder warning: "+s)},e.state=se.LocalRecorderState.RECORDING,n()})},r.prototype.stop=function(){var t=this;return new Promise(function(e,n){try{if(t.state===se.LocalRecorderState.READY||t.state===se.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+t.state+"'). Call 'LocalRecorder.start()' before");t.mediaRecorder.onstop=function(){t.onStopDefault(),e()},t.mediaRecorder.stop()}catch(i){n(i)}})},r.prototype.pause=function(){var t=this;return new Promise(function(e,n){try{t.state!==se.LocalRecorderState.RECORDING&&n(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+t.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")),t.mediaRecorder.pause(),t.state=se.LocalRecorderState.PAUSED,e()}catch(i){n(i)}})},r.prototype.resume=function(){var t=this;return new Promise(function(e,n){try{if(t.state!==se.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+t.state+"'). Call 'LocalRecorder.pause()' before");t.mediaRecorder.resume(),t.state=se.LocalRecorderState.RECORDING,e()}catch(i){n(i)}})},r.prototype.preview=function(t){if(this.state!==se.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,un.isSafariBrowser()&&this.videoPreview.setAttribute("playsinline","true"),typeof t=="string"){var e=document.getElementById(t);e&&(this.videoPreview=e.appendChild(this.videoPreview))}else this.videoPreview=t.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},r.prototype.clean=function(){var t=this,e=function(){delete t.blob,t.chunks=[],delete t.mediaRecorder,t.state=se.LocalRecorderState.READY};this.state===se.LocalRecorderState.RECORDING||this.state===se.LocalRecorderState.PAUSED?this.stop().then(function(){return e()}).catch(function(){return e()}):e()},r.prototype.download=function(){if(this.state!==se.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var t=document.createElement("a");t.style.display="none",document.body.appendChild(t);var e=window.URL.createObjectURL(this.blob);t.href=e,t.download=this.id+".webm",t.click(),window.URL.revokeObjectURL(e),document.body.removeChild(t)},r.prototype.getBlob=function(){if(this.state!==se.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},r.prototype.uploadAsBinary=function(t,e){var n=this;return new Promise(function(i,o){if(n.state!==se.LocalRecorderState.FINISHED)o(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var s=new XMLHttpRequest;if(s.open("POST",t,!0),typeof e=="object")for(var d=0,p=Object.keys(e);d<p.length;d++){var c=p[d];s.setRequestHeader(c,e[c])}s.onreadystatechange=function(){s.readyState===4&&(s.status.toString().charAt(0)==="2"?i(s.responseText):o(s.status))},s.send(n.blob)}})},r.prototype.uploadAsMultipartfile=function(t,e){var n=this;return new Promise(function(i,o){if(n.state!==se.LocalRecorderState.FINISHED)o(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var s=new XMLHttpRequest;if(s.open("POST",t,!0),typeof e=="object")for(var d=0,p=Object.keys(e);d<p.length;d++){var c=p[d];s.setRequestHeader(c,e[c])}var l=new FormData;l.append("file",n.blob,n.id+".webm"),s.onreadystatechange=function(){s.readyState===4&&(s.status.toString().charAt(0)==="2"?i(s.responseText):o(s.status))},s.send(l)}})},r.prototype.onStopDefault=function(){_e.log("MediaRecorder stopped  (state="+this.mediaRecorder.state+")"),this.blob=new Blob(this.chunks,{type:"video/webm"}),this.chunks=[],this.videoPreviewSrc=window.URL.createObjectURL(this.blob),this.state=se.LocalRecorderState.FINISHED},r}();rt.LocalRecorder=vi;var tt={},nt={},ot={},qe={},Ge={},ke={},de={};Object.defineProperty(de,"__esModule",{value:!0});de.Event=void 0;var mi=function(){function r(t,e,n){this.hasBeenPrevented=!1,this.cancelable=t,this.target=e,this.type=n}return r.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},r.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},r}();de.Event=mi;var gi=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(ke,"__esModule",{value:!0});ke.StreamPropertyChangedEvent=void 0;var bi=de,Ei=function(r){gi(t,r);function t(e,n,i,o,s,d){var p=r.call(this,!1,e,"streamPropertyChanged")||this;return p.stream=n,p.changedProperty=i,p.newValue=o,p.oldValue=s,p.reason=d,p}return t.prototype.callDefaultBehavior=function(){},t}(bi.Event);ke.StreamPropertyChangedEvent=Ei;var xe={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.OpenViduError=r.OpenViduErrorName=void 0,function(e){e.BROWSER_NOT_SUPPORTED="BROWSER_NOT_SUPPORTED",e.DEVICE_ACCESS_DENIED="DEVICE_ACCESS_DENIED",e.DEVICE_ALREADY_IN_USE="DEVICE_ALREADY_IN_USE",e.SCREEN_CAPTURE_DENIED="SCREEN_CAPTURE_DENIED",e.SCREEN_SHARING_NOT_SUPPORTED="SCREEN_SHARING_NOT_SUPPORTED",e.SCREEN_EXTENSION_NOT_INSTALLED="SCREEN_EXTENSION_NOT_INSTALLED",e.SCREEN_EXTENSION_DISABLED="SCREEN_EXTENSION_DISABLED",e.INPUT_VIDEO_DEVICE_NOT_FOUND="INPUT_VIDEO_DEVICE_NOT_FOUND",e.INPUT_AUDIO_DEVICE_NOT_FOUND="INPUT_AUDIO_DEVICE_NOT_FOUND",e.INPUT_AUDIO_DEVICE_GENERIC_ERROR="INPUT_AUDIO_DEVICE_GENERIC_ERROR",e.NO_INPUT_SOURCE_SET="NO_INPUT_SOURCE_SET",e.PUBLISHER_PROPERTIES_ERROR="PUBLISHER_PROPERTIES_ERROR",e.OPENVIDU_PERMISSION_DENIED="OPENVIDU_PERMISSION_DENIED",e.OPENVIDU_NOT_CONNECTED="OPENVIDU_NOT_CONNECTED",e.GENERIC_ERROR="GENERIC_ERROR"}(r.OpenViduErrorName||(r.OpenViduErrorName={}));var t=function(){function e(n,i){this.name=n,this.message=i}return e}();r.OpenViduError=t})(xe);Object.defineProperty(Ge,"__esModule",{value:!0});Ge.Filter=void 0;var fn=ke,Be=xe,Si=oe,Re=Si.OpenViduLogger.getInstance(),yi=function(){function r(t,e){this.handlers=new Map,this.type=t,this.options=e}return r.prototype.execMethod=function(t,e){var n=this;return new Promise(function(i,o){Re.info("Executing filter method to stream "+n.stream.streamId);var s;if(typeof e!="string")try{s=JSON.stringify(e)}catch{var d="'params' property must be a JSON formatted object";Re.error(d),o(d)}else s=e;n.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:n.stream.streamId,method:t,params:s},function(p,c){if(p)Re.error("Error executing filter method for Stream "+n.stream.streamId,p),p.code===401?o(new Be.OpenViduError(Be.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):o(p);else{Re.info("Filter method successfully executed on Stream "+n.stream.streamId);var l=Object.assign({},n.stream.filter);n.stream.filter.lastExecMethod={method:t,params:JSON.parse(s)},n.stream.session.emitEvent("streamPropertyChanged",[new fn.StreamPropertyChangedEvent(n.stream.session,n.stream,"filter",n.stream.filter,l,"execFilterMethod")]),n.stream.streamManager.emitEvent("streamPropertyChanged",[new fn.StreamPropertyChangedEvent(n.stream.streamManager,n.stream,"filter",n.stream.filter,l,"execFilterMethod")]),i()}})})},r.prototype.addEventListener=function(t,e){var n=this;return new Promise(function(i,o){Re.info("Adding filter event listener to event "+t+" to stream "+n.stream.streamId),n.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:n.stream.streamId,eventType:t},function(s,d){s?(Re.error("Error adding filter event listener to event "+t+"for Stream "+n.stream.streamId,s),s.code===401?o(new Be.OpenViduError(Be.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):o(s)):(n.handlers.set(t,e),Re.info("Filter event listener to event "+t+" successfully applied on Stream "+n.stream.streamId),i())})})},r.prototype.removeEventListener=function(t){var e=this;return new Promise(function(n,i){Re.info("Removing filter event listener to event "+t+" to stream "+e.stream.streamId),e.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:e.stream.streamId,eventType:t},function(o,s){o?(Re.error("Error removing filter event listener to event "+t+"for Stream "+e.stream.streamId,o),o.code===401?i(new Be.OpenViduError(Be.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):i(o)):(e.handlers.delete(t),Re.info("Filter event listener to event "+t+" successfully removed on Stream "+e.stream.streamId),n())})})},r}();Ge.Filter=yi;var ze={},Je={},Xe={},Bn={exports:{}};/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */(function(r){(function(t){function e(){}var n=e.prototype,i=t.EventEmitter;function o(p,c){for(var l=p.length;l--;)if(p[l].listener===c)return l;return-1}function s(p){return function(){return this[p].apply(this,arguments)}}n.getListeners=function(c){var l=this._getEvents(),b,y;if(c instanceof RegExp){b={};for(y in l)l.hasOwnProperty(y)&&c.test(y)&&(b[y]=l[y])}else b=l[c]||(l[c]=[]);return b},n.flattenListeners=function(c){var l=[],b;for(b=0;b<c.length;b+=1)l.push(c[b].listener);return l},n.getListenersAsObject=function(c){var l=this.getListeners(c),b;return l instanceof Array&&(b={},b[c]=l),b||l};function d(p){return typeof p=="function"||p instanceof RegExp?!0:p&&typeof p=="object"?d(p.listener):!1}n.addListener=function(c,l){if(!d(l))throw new TypeError("listener must be a function");var b=this.getListenersAsObject(c),y=typeof l=="object",O;for(O in b)b.hasOwnProperty(O)&&o(b[O],l)===-1&&b[O].push(y?l:{listener:l,once:!1});return this},n.on=s("addListener"),n.addOnceListener=function(c,l){return this.addListener(c,{listener:l,once:!0})},n.once=s("addOnceListener"),n.defineEvent=function(c){return this.getListeners(c),this},n.defineEvents=function(c){for(var l=0;l<c.length;l+=1)this.defineEvent(c[l]);return this},n.removeListener=function(c,l){var b=this.getListenersAsObject(c),y,O;for(O in b)b.hasOwnProperty(O)&&(y=o(b[O],l),y!==-1&&b[O].splice(y,1));return this},n.off=s("removeListener"),n.addListeners=function(c,l){return this.manipulateListeners(!1,c,l)},n.removeListeners=function(c,l){return this.manipulateListeners(!0,c,l)},n.manipulateListeners=function(c,l,b){var y,O,P=c?this.removeListener:this.addListener,k=c?this.removeListeners:this.addListeners;if(typeof l=="object"&&!(l instanceof RegExp))for(y in l)l.hasOwnProperty(y)&&(O=l[y])&&(typeof O=="function"?P.call(this,y,O):k.call(this,y,O));else for(y=b.length;y--;)P.call(this,l,b[y]);return this},n.removeEvent=function(c){var l=typeof c,b=this._getEvents(),y;if(l==="string")delete b[c];else if(c instanceof RegExp)for(y in b)b.hasOwnProperty(y)&&c.test(y)&&delete b[y];else delete this._events;return this},n.removeAllListeners=s("removeEvent"),n.emitEvent=function(c,l){var b=this.getListenersAsObject(c),y,O,P,k,I;for(k in b)if(b.hasOwnProperty(k))for(y=b[k].slice(0),P=0;P<y.length;P++)O=y[P],O.once===!0&&this.removeListener(c,O.listener),I=O.listener.apply(this,l||[]),I===this._getOnceReturnValue()&&this.removeListener(c,O.listener);return this},n.trigger=s("emitEvent"),n.emit=function(c){var l=Array.prototype.slice.call(arguments,1);return this.emitEvent(c,l)},n.setOnceReturnValue=function(c){return this._onceReturnValue=c,this},n._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},n._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return t.EventEmitter=i,e},r.exports?r.exports=e:t.EventEmitter=e})(typeof window<"u"?window:W||{})})(Bn);var Kt=Bn.exports;Object.defineProperty(Xe,"__esModule",{value:!0});Xe.EventDispatcher=void 0;var wi=Kt,Ci=oe,pt=Ci.OpenViduLogger.getInstance(),Oi=function(){function r(){this.userHandlerArrowHandler=new WeakMap,this.ee=new wi}return r.prototype.off=function(t,e){if(!e)this.ee.removeAllListeners(t);else{var n=this.userHandlerArrowHandler.get(e);n&&this.ee.off(t,n),this.userHandlerArrowHandler.delete(e)}return this},r.prototype.onAux=function(t,e,n){var i=function(o){o?pt.info(e,o):pt.info(e),n(o)};return this.userHandlerArrowHandler.set(n,i),this.ee.on(t,i),this},r.prototype.onceAux=function(t,e,n){var i=this,o=function(s){s?pt.info(e,s):pt.info(e),n(s),i.userHandlerArrowHandler.delete(n)};return this.userHandlerArrowHandler.set(n,o),this.ee.once(t,o),this},r}();Xe.EventDispatcher=Oi;var Ye={},_i=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Ye,"__esModule",{value:!0});Ye.StreamManagerEvent=void 0;var Ri=de,Ii=function(r){_i(t,r);function t(e,n,i){var o=r.call(this,!1,e,n)||this;return o.value=i,o}return t.prototype.callDefaultBehavior=function(){},t}(Ri.Event);Ye.StreamManagerEvent=Ii;var Qe={},Pi=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Qe,"__esModule",{value:!0});Qe.VideoElementEvent=void 0;var ki=de,Ti=function(r){Pi(t,r);function t(e,n,i){var o=r.call(this,!1,n,i)||this;return o.element=e,o}return t.prototype.callDefaultBehavior=function(){},t}(ki.Event);Qe.VideoElementEvent=Ti;var st={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.VideoInsertMode=void 0,function(t){t.AFTER="AFTER",t.APPEND="APPEND",t.BEFORE="BEFORE",t.PREPEND="PREPEND",t.REPLACE="REPLACE"}(r.VideoInsertMode||(r.VideoInsertMode={}))})(st);var Ke={};(function(r){var t=W&&W.__extends||function(){var i=function(o,s){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,p){d.__proto__=p}||function(d,p){for(var c in p)Object.prototype.hasOwnProperty.call(p,c)&&(d[c]=p[c])},i(o,s)};return function(o,s){i(o,s);function d(){this.constructor=o}o.prototype=s===null?Object.create(s):(d.prototype=s.prototype,new d)}}();Object.defineProperty(r,"__esModule",{value:!0}),r.ExceptionEvent=r.ExceptionEventName=void 0;var e=de;(function(i){i.ICE_CANDIDATE_ERROR="ICE_CANDIDATE_ERROR",i.ICE_CONNECTION_FAILED="ICE_CONNECTION_FAILED",i.ICE_CONNECTION_DISCONNECTED="ICE_CONNECTION_DISCONNECTED",i.NO_STREAM_PLAYING_EVENT="NO_STREAM_PLAYING_EVENT"})(r.ExceptionEventName||(r.ExceptionEventName={}));var n=function(i){t(o,i);function o(s,d,p,c,l){var b=i.call(this,!1,s,"exception")||this;return b.name=d,b.origin=p,b.message=c,b.data=l,b}return o.prototype.callDefaultBehavior=function(){},o}(e.Event);r.ExceptionEvent=n})(Ke);var Ni=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Je,"__esModule",{value:!0});Je.StreamManager=void 0;var Mi=Xe,Dt=Ye,Pe=Qe,Ae=st,Di=oe,Ai=Ce,ln=Ke,We=Di.OpenViduLogger.getInstance(),ge,Li=function(r){Ni(t,r);function t(e,n){var i=r.call(this)||this;if(i.videos=[],i.lazyLaunchVideoElementCreatedEvent=!1,ge=Ai.PlatformUtils.getInstance(),i.stream=e,i.stream.streamManager=i,i.remote=!i.stream.isLocal(),n){var o=void 0;typeof n=="string"?o=document.getElementById(n):n instanceof HTMLElement&&(o=n),o&&(i.firstVideoElement={targetElement:o,video:document.createElement("video"),id:"",canplayListenerAdded:!1},(ge.isSafariBrowser()||ge.isIPhoneOrIPad()&&(ge.isChromeMobileBrowser()||ge.isEdgeMobileBrowser()||ge.isOperaMobileBrowser()||ge.isFirefoxMobileBrowser()))&&i.firstVideoElement.video.setAttribute("playsinline","true"),i.targetElement=o,i.element=o)}return i.canPlayListener=function(){i.deactivateStreamPlayingEventExceptionTimeout(),i.remote?(We.info("Remote 'Stream' with id ["+i.stream.streamId+"] video is now playing"),i.ee.emitEvent("videoPlaying",[new Pe.VideoElementEvent(i.videos[0].video,i,"videoPlaying")])):i.stream.displayMyRemote()?(We.info("Your own remote 'Stream' with id ["+i.stream.streamId+"] video is now playing"),i.ee.emitEvent("remoteVideoPlaying",[new Pe.VideoElementEvent(i.videos[0].video,i,"remoteVideoPlaying")])):(We.info("Your local 'Stream' with id ["+i.stream.streamId+"] video is now playing"),i.ee.emitEvent("videoPlaying",[new Pe.VideoElementEvent(i.videos[0].video,i,"videoPlaying")])),i.ee.emitEvent("streamPlaying",[new Dt.StreamManagerEvent(i,"streamPlaying",void 0)])},i}return t.prototype.on=function(e,n){return r.prototype.onAux.call(this,e,"Event '"+e+"' triggered by '"+(this.remote?"Subscriber":"Publisher")+"'",n),e==="videoElementCreated"&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new Pe.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),(e==="streamPlaying"||e==="videoPlaying")&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&(this.ee.emitEvent("streamPlaying",[new Dt.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new Pe.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),this.stream.hasAudio&&(e==="publisherStartSpeaking"&&this.stream.enableHarkSpeakingEvent(),e==="publisherStopSpeaking"&&this.stream.enableHarkStoppedSpeakingEvent(),e==="streamAudioVolumeChange"&&this.stream.enableHarkVolumeChangeEvent(!1)),this},t.prototype.once=function(e,n){return r.prototype.onceAux.call(this,e,"Event '"+e+"' triggered once by '"+(this.remote?"Subscriber":"Publisher")+"'",n),e==="videoElementCreated"&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new Pe.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),(e==="streamPlaying"||e==="videoPlaying")&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&(this.ee.emitEvent("streamPlaying",[new Dt.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new Pe.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),this.stream.hasAudio&&(e==="publisherStartSpeaking"&&this.stream.enableOnceHarkSpeakingEvent(),e==="publisherStopSpeaking"&&this.stream.enableOnceHarkStoppedSpeakingEvent(),e==="streamAudioVolumeChange"&&this.stream.enableOnceHarkVolumeChangeEvent(!1)),this},t.prototype.off=function(e,n){if(r.prototype.off.call(this,e,n),e==="publisherStartSpeaking"){var i=this.ee.getListeners(e).length+this.stream.session.ee.getListeners(e).length;i===0&&this.stream.disableHarkSpeakingEvent(!1)}if(e==="publisherStopSpeaking"){var o=this.ee.getListeners(e).length+this.stream.session.ee.getListeners(e).length;o===0&&this.stream.disableHarkStoppedSpeakingEvent(!1)}if(e==="streamAudioVolumeChange"){var s=this.ee.getListeners(e).length;s===0&&this.stream.disableHarkVolumeChangeEvent(!1)}return this},t.prototype.addVideoElement=function(e){this.initializeVideoProperties(e),!this.remote&&this.stream.displayMyRemote()&&e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream());for(var n=0,i=this.videos;n<i.length;n++){var o=i[n];if(o.video===e)return 0}for(var s=1,d=0,p=this.stream.session.streamManagers;d<p.length;d++){var c=p[d];if(c.disassociateVideo(e)){s=-1;break}}return this.stream.session.streamManagers.forEach(function(l){l.disassociateVideo(e)}),this.pushNewStreamManagerVideo({video:e,id:e.id,canplayListenerAdded:!1}),We.info("New video element associated to ",this),s},t.prototype.createVideoElement=function(e,n){var i;if(typeof e=="string"){if(i=document.getElementById(e),!i)throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e)}else if(e instanceof HTMLElement)i=e;else throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e);var o=this.createVideo();this.initializeVideoProperties(o);var s=n||Ae.VideoInsertMode.APPEND;switch(s){case Ae.VideoInsertMode.AFTER:i.parentNode.insertBefore(o,i.nextSibling);break;case Ae.VideoInsertMode.APPEND:i.appendChild(o);break;case Ae.VideoInsertMode.BEFORE:i.parentNode.insertBefore(o,i);break;case Ae.VideoInsertMode.PREPEND:i.insertBefore(o,i.childNodes[0]);break;case Ae.VideoInsertMode.REPLACE:i.parentNode.replaceChild(o,i);break;default:s=Ae.VideoInsertMode.APPEND,i.appendChild(o);break}var d={targetElement:i,video:o,insertMode:s,id:o.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(d),this.ee.emitEvent("videoElementCreated",[new Pe.VideoElementEvent(d.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,o},t.prototype.updatePublisherSpeakingEventsOptions=function(e){var n=this.stream.harkOptions?this.stream.harkOptions:this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{},i=typeof e.interval=="number"?e.interval:typeof n.interval=="number"?n.interval:100,o=typeof e.threshold=="number"?e.threshold:typeof n.threshold=="number"?n.threshold:-50;this.stream.harkOptions={interval:i,threshold:o},this.stream.speechEvent&&(this.stream.speechEvent.setInterval(i),this.stream.speechEvent.setThreshold(o))},t.prototype.initializeVideoProperties=function(e){!this.remote&&this.stream.displayMyRemote()||e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream()),e.autoplay=!0,e.controls=!1,(ge.isSafariBrowser()||ge.isIPhoneOrIPad()&&(ge.isChromeMobileBrowser()||ge.isEdgeMobileBrowser()||ge.isOperaMobileBrowser()||ge.isFirefoxMobileBrowser()))&&e.setAttribute("playsinline","true"),e.id||(e.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=e.id)),!this.remote&&!this.stream.displayMyRemote()&&(e.muted=!0,e.style.transform==="rotateY(180deg)"&&!this.stream.outboundStreamOpts.publisherProperties.mirror?this.removeMirrorVideo(e):this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(e))},t.prototype.removeAllVideos=function(){for(var e=this,n=this.stream.session.streamManagers.length-1;n>=0;--n)this.stream.session.streamManagers[n]===this&&this.stream.session.streamManagers.splice(n,1);this.videos.forEach(function(i){i.video&&i.video.removeEventListener&&i.video.removeEventListener("canplay",e.canPlayListener),i.canplayListenerAdded=!1,i.targetElement&&(i.video.parentNode.removeChild(i.video),e.ee.emitEvent("videoElementDestroyed",[new Pe.VideoElementEvent(i.video,e,"videoElementDestroyed")])),e.removeSrcObject(i),e.videos.filter(function(o){return!o.targetElement})})},t.prototype.disassociateVideo=function(e){for(var n=!1,i=0;i<this.videos.length;i++)if(this.videos[i].video===e){this.videos[i].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(i,1),n=!0,We.info("Video element disassociated from ",this);break}return n},t.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.activateStreamPlayingEventExceptionTimeout(),this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},t.prototype.updateMediaStream=function(e){this.videos.forEach(function(n){if(n.video.srcObject=e,ge.isIonicIos()){var i=n.video.parentElement,o=n.video;i.replaceChild(o,n.video),n.video=o}})},t.prototype.emitEvent=function(e,n){this.ee.emitEvent(e,n)},t.prototype.createVideo=function(){return document.createElement("video")},t.prototype.removeSrcObject=function(e){e.video.srcObject=null,this.deactivateStreamPlayingEventExceptionTimeout()},t.prototype.pushNewStreamManagerVideo=function(e){this.videos.push(e),this.addPlayEventToFirstVideo(),this.stream.session.streamManagers.indexOf(this)===-1&&this.stream.session.streamManagers.push(this)},t.prototype.mirrorVideo=function(e){ge.isIonicIos()||(e.style.transform="rotateY(180deg)",e.style.webkitTransform="rotateY(180deg)")},t.prototype.removeMirrorVideo=function(e){e.style.transform="unset",e.style.webkitTransform="unset"},t.prototype.activateStreamPlayingEventExceptionTimeout=function(){var e=this;if(this.remote&&this.streamPlayingEventExceptionTimeout==null){var n=this.stream.session.openvidu.advancedConfiguration.noStreamPlayingEventExceptionTimeout||4e3;this.streamPlayingEventExceptionTimeout=setTimeout(function(){var i="StreamManager of Stream "+e.stream.streamId+" ("+(e.remote?"Subscriber":"Publisher")+') did not trigger "streamPlaying" event in '+n+" ms";We.warn(i),e.stream.session.emitEvent("exception",[new ln.ExceptionEvent(e.stream.session,ln.ExceptionEventName.NO_STREAM_PLAYING_EVENT,e,i)]),delete e.streamPlayingEventExceptionTimeout},n)}},t.prototype.deactivateStreamPlayingEventExceptionTimeout=function(){clearTimeout(this.streamPlayingEventExceptionTimeout),delete this.streamPlayingEventExceptionTimeout},t}(Mi.EventDispatcher);Je.StreamManager=Li;var Vi=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(ze,"__esModule",{value:!0});ze.Subscriber=void 0;var xi=Je,Bi=oe,hn=Bi.OpenViduLogger.getInstance(),Wi=function(r){Vi(t,r);function t(e,n,i){var o=r.call(this,e,n)||this;return o.element=o.targetElement,o.stream=e,o.properties=i,o}return t.prototype.subscribeToAudio=function(e){return this.stream.getMediaStream().getAudioTracks().forEach(function(n){n.enabled=e}),this.stream.audioActive=e,hn.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its audio stream"),this},t.prototype.subscribeToVideo=function(e){return this.stream.getMediaStream().getVideoTracks().forEach(function(n){n.enabled=e}),this.stream.videoActive=e,hn.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its video stream"),this},t}(xi.StreamManager);ze.Subscriber=Wi;var Ie={},pn=["stun:","turn:"],Fi=function(r){var t=(r||{}).url||r,e,n,i={};return typeof t!="string"&&!(t instanceof String)||(t=t.trim(),e=pn[pn.indexOf(t.slice(0,5))],!e)?r:(t=t.slice(5),n=t.split("@"),i.username=r.username,i.credential=r.credential,n.length>1&&(t=n[1],n=n[0].split(":"),i.username=n[0],i.credential=(r||{}).credential||n[1]||""),i.url=e+t,i.urls=[i.url],i)};const ji=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"],Ui=[];var Hi=Fi,$i=function(r){var t={stun:(r||{}).stun||ji,turn:(r||{}).turn||Ui},e=(r||{}).stunCount||2,n=(r||{}).turnCount||0,i;function o(s,d){for(var p=[],c=[].concat(t[s]),l;c.length&&p.length<d;)l=Math.random()*c.length|0,p=p.concat(c.splice(l,1));return p.map(function(b){return typeof b!="string"&&!(b instanceof String)?b:Hi(s+":"+b)})}return i=[].concat(o("stun",e)),n&&(i=i.concat(o("turn",n))),i},qi=$i,vt,Gi=new Uint8Array(16);function Wn(){if(!vt&&(vt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!vt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vt(Gi)}const zi=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Rt(r){return typeof r=="string"&&zi.test(r)}var ce=[];for(var At=0;At<256;++At)ce.push((At+256).toString(16).substr(1));function It(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=(ce[r[t+0]]+ce[r[t+1]]+ce[r[t+2]]+ce[r[t+3]]+"-"+ce[r[t+4]]+ce[r[t+5]]+"-"+ce[r[t+6]]+ce[r[t+7]]+"-"+ce[r[t+8]]+ce[r[t+9]]+"-"+ce[r[t+10]]+ce[r[t+11]]+ce[r[t+12]]+ce[r[t+13]]+ce[r[t+14]]+ce[r[t+15]]).toLowerCase();if(!Rt(e))throw TypeError("Stringified UUID is invalid");return e}var vn,Lt,Vt=0,xt=0;function Ji(r,t,e){var n=t&&e||0,i=t||new Array(16);r=r||{};var o=r.node||vn,s=r.clockseq!==void 0?r.clockseq:Lt;if(o==null||s==null){var d=r.random||(r.rng||Wn)();o==null&&(o=vn=[d[0]|1,d[1],d[2],d[3],d[4],d[5]]),s==null&&(s=Lt=(d[6]<<8|d[7])&16383)}var p=r.msecs!==void 0?r.msecs:Date.now(),c=r.nsecs!==void 0?r.nsecs:xt+1,l=p-Vt+(c-xt)/1e4;if(l<0&&r.clockseq===void 0&&(s=s+1&16383),(l<0||p>Vt)&&r.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Vt=p,xt=c,Lt=s,p+=122192928e5;var b=((p&268435455)*1e4+c)%4294967296;i[n++]=b>>>24&255,i[n++]=b>>>16&255,i[n++]=b>>>8&255,i[n++]=b&255;var y=p/4294967296*1e4&268435455;i[n++]=y>>>8&255,i[n++]=y&255,i[n++]=y>>>24&15|16,i[n++]=y>>>16&255,i[n++]=s>>>8|128,i[n++]=s&255;for(var O=0;O<6;++O)i[n+O]=o[O];return t||It(i)}function Fn(r){if(!Rt(r))throw TypeError("Invalid UUID");var t,e=new Uint8Array(16);return e[0]=(t=parseInt(r.slice(0,8),16))>>>24,e[1]=t>>>16&255,e[2]=t>>>8&255,e[3]=t&255,e[4]=(t=parseInt(r.slice(9,13),16))>>>8,e[5]=t&255,e[6]=(t=parseInt(r.slice(14,18),16))>>>8,e[7]=t&255,e[8]=(t=parseInt(r.slice(19,23),16))>>>8,e[9]=t&255,e[10]=(t=parseInt(r.slice(24,36),16))/1099511627776&255,e[11]=t/4294967296&255,e[12]=t>>>24&255,e[13]=t>>>16&255,e[14]=t>>>8&255,e[15]=t&255,e}function Xi(r){r=unescape(encodeURIComponent(r));for(var t=[],e=0;e<r.length;++e)t.push(r.charCodeAt(e));return t}var Yi="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Qi="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function jn(r,t,e){function n(i,o,s,d){if(typeof i=="string"&&(i=Xi(i)),typeof o=="string"&&(o=Fn(o)),o.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var p=new Uint8Array(16+i.length);if(p.set(o),p.set(i,o.length),p=e(p),p[6]=p[6]&15|t,p[8]=p[8]&63|128,s){d=d||0;for(var c=0;c<16;++c)s[d+c]=p[c];return s}return It(p)}try{n.name=r}catch{}return n.DNS=Yi,n.URL=Qi,n}function Ki(r){if(typeof r=="string"){var t=unescape(encodeURIComponent(r));r=new Uint8Array(t.length);for(var e=0;e<t.length;++e)r[e]=t.charCodeAt(e)}return Zi(er(tr(r),r.length*8))}function Zi(r){for(var t=[],e=r.length*32,n="0123456789abcdef",i=0;i<e;i+=8){var o=r[i>>5]>>>i%32&255,s=parseInt(n.charAt(o>>>4&15)+n.charAt(o&15),16);t.push(s)}return t}function Un(r){return(r+64>>>9<<4)+14+1}function er(r,t){r[t>>5]|=128<<t%32,r[Un(t)-1]=t;for(var e=1732584193,n=-271733879,i=-1732584194,o=271733878,s=0;s<r.length;s+=16){var d=e,p=n,c=i,l=o;e=le(e,n,i,o,r[s],7,-680876936),o=le(o,e,n,i,r[s+1],12,-389564586),i=le(i,o,e,n,r[s+2],17,606105819),n=le(n,i,o,e,r[s+3],22,-1044525330),e=le(e,n,i,o,r[s+4],7,-176418897),o=le(o,e,n,i,r[s+5],12,1200080426),i=le(i,o,e,n,r[s+6],17,-1473231341),n=le(n,i,o,e,r[s+7],22,-45705983),e=le(e,n,i,o,r[s+8],7,1770035416),o=le(o,e,n,i,r[s+9],12,-1958414417),i=le(i,o,e,n,r[s+10],17,-42063),n=le(n,i,o,e,r[s+11],22,-1990404162),e=le(e,n,i,o,r[s+12],7,1804603682),o=le(o,e,n,i,r[s+13],12,-40341101),i=le(i,o,e,n,r[s+14],17,-1502002290),n=le(n,i,o,e,r[s+15],22,1236535329),e=he(e,n,i,o,r[s+1],5,-165796510),o=he(o,e,n,i,r[s+6],9,-1069501632),i=he(i,o,e,n,r[s+11],14,643717713),n=he(n,i,o,e,r[s],20,-373897302),e=he(e,n,i,o,r[s+5],5,-701558691),o=he(o,e,n,i,r[s+10],9,38016083),i=he(i,o,e,n,r[s+15],14,-660478335),n=he(n,i,o,e,r[s+4],20,-405537848),e=he(e,n,i,o,r[s+9],5,568446438),o=he(o,e,n,i,r[s+14],9,-1019803690),i=he(i,o,e,n,r[s+3],14,-187363961),n=he(n,i,o,e,r[s+8],20,1163531501),e=he(e,n,i,o,r[s+13],5,-1444681467),o=he(o,e,n,i,r[s+2],9,-51403784),i=he(i,o,e,n,r[s+7],14,1735328473),n=he(n,i,o,e,r[s+12],20,-1926607734),e=pe(e,n,i,o,r[s+5],4,-378558),o=pe(o,e,n,i,r[s+8],11,-2022574463),i=pe(i,o,e,n,r[s+11],16,1839030562),n=pe(n,i,o,e,r[s+14],23,-35309556),e=pe(e,n,i,o,r[s+1],4,-1530992060),o=pe(o,e,n,i,r[s+4],11,1272893353),i=pe(i,o,e,n,r[s+7],16,-155497632),n=pe(n,i,o,e,r[s+10],23,-1094730640),e=pe(e,n,i,o,r[s+13],4,681279174),o=pe(o,e,n,i,r[s],11,-358537222),i=pe(i,o,e,n,r[s+3],16,-722521979),n=pe(n,i,o,e,r[s+6],23,76029189),e=pe(e,n,i,o,r[s+9],4,-640364487),o=pe(o,e,n,i,r[s+12],11,-421815835),i=pe(i,o,e,n,r[s+15],16,530742520),n=pe(n,i,o,e,r[s+2],23,-995338651),e=ve(e,n,i,o,r[s],6,-198630844),o=ve(o,e,n,i,r[s+7],10,1126891415),i=ve(i,o,e,n,r[s+14],15,-1416354905),n=ve(n,i,o,e,r[s+5],21,-57434055),e=ve(e,n,i,o,r[s+12],6,1700485571),o=ve(o,e,n,i,r[s+3],10,-1894986606),i=ve(i,o,e,n,r[s+10],15,-1051523),n=ve(n,i,o,e,r[s+1],21,-2054922799),e=ve(e,n,i,o,r[s+8],6,1873313359),o=ve(o,e,n,i,r[s+15],10,-30611744),i=ve(i,o,e,n,r[s+6],15,-1560198380),n=ve(n,i,o,e,r[s+13],21,1309151649),e=ve(e,n,i,o,r[s+4],6,-145523070),o=ve(o,e,n,i,r[s+11],10,-1120210379),i=ve(i,o,e,n,r[s+2],15,718787259),n=ve(n,i,o,e,r[s+9],21,-343485551),e=Ne(e,d),n=Ne(n,p),i=Ne(i,c),o=Ne(o,l)}return[e,n,i,o]}function tr(r){if(r.length===0)return[];for(var t=r.length*8,e=new Uint32Array(Un(t)),n=0;n<t;n+=8)e[n>>5]|=(r[n/8]&255)<<n%32;return e}function Ne(r,t){var e=(r&65535)+(t&65535),n=(r>>16)+(t>>16)+(e>>16);return n<<16|e&65535}function nr(r,t){return r<<t|r>>>32-t}function Pt(r,t,e,n,i,o){return Ne(nr(Ne(Ne(t,r),Ne(n,o)),i),e)}function le(r,t,e,n,i,o,s){return Pt(t&e|~t&n,r,t,i,o,s)}function he(r,t,e,n,i,o,s){return Pt(t&n|e&~n,r,t,i,o,s)}function pe(r,t,e,n,i,o,s){return Pt(t^e^n,r,t,i,o,s)}function ve(r,t,e,n,i,o,s){return Pt(e^(t|~n),r,t,i,o,s)}var ir=jn("v3",48,Ki);const rr=ir;function or(r,t,e){r=r||{};var n=r.random||(r.rng||Wn)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){e=e||0;for(var i=0;i<16;++i)t[e+i]=n[i];return t}return It(n)}function sr(r,t,e,n){switch(r){case 0:return t&e^~t&n;case 1:return t^e^n;case 2:return t&e^t&n^e&n;case 3:return t^e^n}}function Bt(r,t){return r<<t|r>>>32-t}function ar(r){var t=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var i=0;i<n.length;++i)r.push(n.charCodeAt(i))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var o=r.length/4+2,s=Math.ceil(o/16),d=new Array(s),p=0;p<s;++p){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=r[p*64+l*4]<<24|r[p*64+l*4+1]<<16|r[p*64+l*4+2]<<8|r[p*64+l*4+3];d[p]=c}d[s-1][14]=(r.length-1)*8/Math.pow(2,32),d[s-1][14]=Math.floor(d[s-1][14]),d[s-1][15]=(r.length-1)*8&4294967295;for(var b=0;b<s;++b){for(var y=new Uint32Array(80),O=0;O<16;++O)y[O]=d[b][O];for(var P=16;P<80;++P)y[P]=Bt(y[P-3]^y[P-8]^y[P-14]^y[P-16],1);for(var k=e[0],I=e[1],v=e[2],T=e[3],D=e[4],C=0;C<80;++C){var L=Math.floor(C/20),F=Bt(k,5)+sr(L,I,v,T)+D+t[L]+y[C]>>>0;D=T,T=v,v=Bt(I,30)>>>0,I=k,k=F}e[0]=e[0]+k>>>0,e[1]=e[1]+I>>>0,e[2]=e[2]+v>>>0,e[3]=e[3]+T>>>0,e[4]=e[4]+D>>>0}return[e[0]>>24&255,e[0]>>16&255,e[0]>>8&255,e[0]&255,e[1]>>24&255,e[1]>>16&255,e[1]>>8&255,e[1]&255,e[2]>>24&255,e[2]>>16&255,e[2]>>8&255,e[2]&255,e[3]>>24&255,e[3]>>16&255,e[3]>>8&255,e[3]&255,e[4]>>24&255,e[4]>>16&255,e[4]>>8&255,e[4]&255]}var cr=jn("v5",80,ar);const dr=cr,ur="00000000-0000-0000-0000-000000000000";function fr(r){if(!Rt(r))throw TypeError("Invalid UUID");return parseInt(r.substr(14,1),16)}const lr=Object.freeze(Object.defineProperty({__proto__:null,NIL:ur,parse:Fn,stringify:It,v1:Ji,v3:rr,v4:or,v5:dr,validate:Rt,version:fr},Symbol.toStringTag,{value:"Module"})),hr=Ln(lr);var Zt=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),yt=W&&W.__assign||function(){return yt=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},yt.apply(this,arguments)},mn=W&&W.__awaiter||function(r,t,e,n){function i(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(l){try{c(n.next(l))}catch(b){s(b)}}function p(l){try{c(n.throw(l))}catch(b){s(b)}}function c(l){l.done?o(l.value):i(l.value).then(d,p)}c((n=n.apply(r,t||[])).next())})},gn=W&&W.__generator||function(r,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function d(c){return function(l){return p([c,l])}}function p(c){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,i=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){e.label=c[1];break}if(c[0]===6&&e.label<o[1]){e.label=o[1],o=c;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(c);break}o[2]&&e.ops.pop(),e.trys.pop();continue}c=t.call(r,e)}catch(l){c=[6,l],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.WebRtcPeerSendrecv=Ie.WebRtcPeerSendonly=Ie.WebRtcPeerRecvonly=Ie.WebRtcPeer=void 0;var pr=qi,vr=hr,bn=Ke,mr=oe,gr=Ce,ae=mr.OpenViduLogger.getInstance(),br=[{rid:"r0",scaleResolutionDownBy:4},{rid:"r1",scaleResolutionDownBy:2},{rid:"r2",scaleResolutionDownBy:1}],kt=function(){function r(t){var e=this;this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],this.candidategatheringdone=!1,gr.PlatformUtils.getInstance(),this.configuration=yt(yt({},t),{iceServers:t.iceServers&&t.iceServers.length>0?t.iceServers:pr(),mediaStream:t.mediaStream!==void 0?t.mediaStream:null,mode:t.mode?t.mode:"sendrecv",id:t.id?t.id:this.generateUniqueId()}),this.pc=new RTCPeerConnection({iceServers:this.configuration.iceServers}),this.pc.addEventListener("icecandidate",function(n){if(n.candidate!=null){var i=n.candidate;e.configuration.onIceCandidate(i),i.candidate!==""&&e.localCandidatesQueue.push({candidate:i.candidate})}}),this.pc.addEventListener("signalingstatechange",function(){if(e.pc.signalingState==="stable")for(;e.iceCandidateList.length>0;){var n=e.iceCandidateList.shift();e.pc.addIceCandidate(n)}})}return r.prototype.getId=function(){return this.configuration.id},r.prototype.dispose=function(){if(ae.debug("Disposing WebRtcPeer"),this.pc){if(this.pc.signalingState==="closed")return;this.pc.close(),this.remoteCandidatesQueue=[],this.localCandidatesQueue=[]}},r.prototype.createOffer=function(){var t=this;return new Promise(function(e,n){return mn(t,void 0,void 0,function(){var i,o,s,d,p,c,l,b,y,O,P,k;return gn(this,function(I){switch(I.label){case 0:if(!("addTransceiver"in this.pc))return[3,7];if(ae.debug("[createOffer] Method RTCPeerConnection.addTransceiver() is available; using it"),this.configuration.mode==="recvonly")return[3,5];if(!this.configuration.mediaStream)return n(new Error(this.configuration.mode+" direction requested, but no stream was configured to be sent")),[2];i=0,o=this.configuration.mediaStream.getTracks(),I.label=1;case 1:return i<o.length?(s=o[i],d={direction:this.configuration.mode,streams:[this.configuration.mediaStream]},this.configuration.simulcast&&s.kind==="video"&&(d.sendEncodings=br),p=this.pc.addTransceiver(s,d),this.configuration.simulcast&&s.kind==="video"?(c=p.sender.getParameters(),!("encodings"in c)||c.encodings.length!==d.sendEncodings.length?(c.encodings=d.sendEncodings,[4,p.sender.setParameters(c)]):[3,3]):[3,3]):[3,4];case 2:I.sent(),I.label=3;case 3:return i++,[3,1];case 4:return[3,6];case 5:for(l=0,b=["audio","video"];l<b.length;l++)y=b[l],this.configuration.mediaConstraints[y]&&(this.configuration.mediaStream=new MediaStream,this.pc.addTransceiver(y,{direction:this.configuration.mode,streams:[this.configuration.mediaStream]}));I.label=6;case 6:return this.pc.createOffer().then(function(v){return e(v)}).catch(function(v){return n(v)}),[3,8];case 7:ae.warn("[createOffer] Method RTCPeerConnection.addTransceiver() is NOT available; using LEGACY offerToReceive{Audio,Video}"),this.configuration.mediaStream&&this.deprecatedPeerConnectionTrackApi(),O=this.configuration.mediaConstraints.audio,P=this.configuration.mediaConstraints.video,k={offerToReceiveAudio:this.configuration.mode!=="sendonly"&&O,offerToReceiveVideo:this.configuration.mode!=="sendonly"&&P},ae.debug("RTCPeerConnection.createOffer() options:",JSON.stringify(k)),this.pc.createOffer(k).then(function(v){return e(v)}).catch(function(v){return n(v)}),I.label=8;case 8:return[2]}})})})},r.prototype.deprecatedPeerConnectionTrackApi=function(){for(var t=0,e=this.configuration.mediaStream.getTracks();t<e.length;t++){var n=e[t];this.pc.addTrack(n,this.configuration.mediaStream)}},r.prototype.createAnswer=function(){var t=this;return new Promise(function(e,n){if("getTransceivers"in t.pc){ae.debug("[createAnswer] Method RTCPeerConnection.getTransceivers() is available; using it");for(var i=function(b){if(!t.configuration.mediaConstraints[b])return"continue";var y=t.pc.getTransceivers().find(function(O){return O.receiver.track.kind===b});y?y.direction=t.configuration.mode:n(new Error(b+" requested, but no transceiver was created from remote description"))},o=0,s=["audio","video"];o<s.length;o++){var d=s[o];i(d)}t.pc.createAnswer().then(function(b){return e(b)}).catch(function(b){return n(b)})}else{var p=void 0,c=!0;if(t.configuration.mediaConstraints){p=typeof t.configuration.mediaConstraints.audio=="boolean"?t.configuration.mediaConstraints.audio:!0,c=typeof t.configuration.mediaConstraints.video=="boolean"?t.configuration.mediaConstraints.video:!0;var l={offerToReceiveAudio:p,offerToReceiveVideo:c};t.pc.createAnswer(l).then(function(b){e(b)}).catch(function(b){n(b)})}}})},r.prototype.processLocalOffer=function(t){var e=this;return new Promise(function(n,i){e.pc.setLocalDescription(t).then(function(){var o=e.pc.localDescription;o?(ae.debug("Local description set",o.sdp),n()):i("Local description is not defined")}).catch(function(o){i(o)})})},r.prototype.processRemoteOffer=function(t){var e=this;return new Promise(function(n,i){var o={type:"offer",sdp:t};ae.debug("SDP offer received, setting remote description",o),e.pc.signalingState==="closed"&&i("RTCPeerConnection is closed when trying to set remote description"),e.setRemoteDescription(o).then(function(){n()}).catch(function(s){i(s)})})},r.prototype.processLocalAnswer=function(t){var e=this;return new Promise(function(n,i){ae.debug("SDP answer created, setting local description"),e.pc.signalingState==="closed"&&i("RTCPeerConnection is closed when trying to set local description"),e.pc.setLocalDescription(t).then(function(){return n()}).catch(function(o){return i(o)})})},r.prototype.processRemoteAnswer=function(t){var e=this;return new Promise(function(n,i){var o={type:"answer",sdp:t};ae.debug("SDP answer received, setting remote description"),e.pc.signalingState==="closed"&&i("RTCPeerConnection is closed when trying to set remote description"),e.setRemoteDescription(o).then(function(){return n()}).catch(function(s){return i(s)})})},r.prototype.setRemoteDescription=function(t){return mn(this,void 0,void 0,function(){return gn(this,function(e){return[2,this.pc.setRemoteDescription(t)]})})},r.prototype.addIceCandidate=function(t){var e=this;return new Promise(function(n,i){switch(ae.debug("Remote ICE candidate received",t),e.remoteCandidatesQueue.push(t),e.pc.signalingState){case"closed":i(new Error("PeerConnection object is closed"));break;case"stable":e.pc.remoteDescription?e.pc.addIceCandidate(t).then(function(){return n()}).catch(function(o){return i(o)}):(e.iceCandidateList.push(t),n());break;default:e.iceCandidateList.push(t),n()}})},r.prototype.addIceConnectionStateChangeListener=function(t){var e=this;this.pc.addEventListener("iceconnectionstatechange",function(){var n=e.pc.iceConnectionState;switch(n){case"disconnected":var i="IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "disconnected". Possible network disconnection';ae.warn(i),e.configuration.onIceConnectionStateException(bn.ExceptionEventName.ICE_CONNECTION_DISCONNECTED,i);break;case"failed":var o="IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') to "failed"';ae.error(o),e.configuration.onIceConnectionStateException(bn.ExceptionEventName.ICE_CONNECTION_FAILED,o);break;case"closed":ae.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "closed"');break;case"new":ae.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "new"');break;case"checking":ae.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "checking"');break;case"connected":ae.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "connected"');break;case"completed":ae.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "completed"');break}})},r.prototype.generateUniqueId=function(){return vr.v4()},r}();Ie.WebRtcPeer=kt;var Er=function(r){Zt(t,r);function t(e){var n=this;return e.mode="recvonly",n=r.call(this,e)||this,n}return t}(kt);Ie.WebRtcPeerRecvonly=Er;var Sr=function(r){Zt(t,r);function t(e){var n=this;return e.mode="sendonly",n=r.call(this,e)||this,n}return t}(kt);Ie.WebRtcPeerSendonly=Sr;var yr=function(r){Zt(t,r);function t(e){var n=this;return e.mode="sendrecv",n=r.call(this,e)||this,n}return t}(kt);Ie.WebRtcPeerSendrecv=yr;var Tt={},Fe=W&&W.__awaiter||function(r,t,e,n){function i(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(l){try{c(n.next(l))}catch(b){s(b)}}function p(l){try{c(n.throw(l))}catch(b){s(b)}}function c(l){l.done?o(l.value):i(l.value).then(d,p)}c((n=n.apply(r,t||[])).next())})},je=W&&W.__generator||function(r,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function d(c){return function(l){return p([c,l])}}function p(c){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,i=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){e.label=c[1];break}if(c[0]===6&&e.label<o[1]){e.label=o[1],o=c;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(c);break}o[2]&&e.ops.pop(),e.trys.pop();continue}c=t.call(r,e)}catch(l){c=[6,l],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.WebRtcStats=void 0;var wr=oe,Cr=Ce,Le=wr.OpenViduLogger.getInstance(),Ue,Or=function(){function r(t){this.stream=t,this.STATS_ITEM_NAME="webrtc-stats-config",this.webRtcStatsEnabled=!1,this.statsInterval=1,Ue=Cr.PlatformUtils.getInstance()}return r.prototype.isEnabled=function(){return this.webRtcStatsEnabled},r.prototype.initWebRtcStats=function(){var t=this,e=localStorage.getItem(this.STATS_ITEM_NAME);if(e){this.webRtcStatsEnabled=!0;var n=JSON.parse(e);Le.warn("WebRtc stats enabled for stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId),Le.warn("localStorage item: "+JSON.stringify(n)),this.POST_URL=n.httpEndpoint,this.statsInterval=n.interval,this.webRtcStatsIntervalId=setInterval(function(){return Fe(t,void 0,void 0,function(){return je(this,function(i){switch(i.label){case 0:return[4,this.sendStatsToHttpEndpoint()];case 1:return i.sent(),[2]}})})},this.statsInterval*1e3)}else Le.debug("WebRtc stats not enabled")},r.prototype.getSelectedIceCandidateInfo=function(){var t=this;return new Promise(function(e,n){return Fe(t,void 0,void 0,function(){var i,o,s,d,p,c,l,b,y,O,P,k,I,v,L,F,T,D,a,C,L,F,U,u,a;return je(this,function(h){switch(h.label){case 0:return[4,this.stream.getRTCPeerConnection().getStats()];case 1:if(i=h.sent(),s=new Map,d=new Map,p=new Map,i.forEach(function(g){switch(g.type==="transport"&&(Ue.isChromium()||Ue.isSafariBrowser()||Ue.isReactNative())&&(o=g),g.type){case"candidate-pair":s.set(g.id,g);break;case"local-candidate":d.set(g.id,g);break;case"remote-candidate":p.set(g.id,g);break}}),o!=null)l=o.selectedCandidatePairId,c=s.get(l);else for(b=s.size,y=s.values(),O=0;O<b;O++)if(P=y.next().value,P.selected){c=P;break}if(k=c.localCandidateId,I=c.remoteCandidateId,v=d.get(k),v)for(L=this.stream.getLocalIceCandidateList(),F=L.filter(function(g){return!!g.candidate&&(g.candidate.indexOf(v.ip)>=0||g.candidate.indexOf(v.address)>=0)&&g.candidate.indexOf(v.port)>=0}),v.raw=[],T=0,D=F;T<D.length;T++)a=D[T],v.raw.push(a.candidate);else v="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";if(C=p.get(I),C)for(L=this.stream.getRemoteIceCandidateList(),F=L.filter(function(g){return!!g.candidate&&(g.candidate.indexOf(C.ip)>=0||g.candidate.indexOf(C.address)>=0)&&g.candidate.indexOf(C.port)>=0}),C.raw=[],U=0,u=F;U<u.length;U++)a=u[U],C.raw.push(a.candidate);else C="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used";return e({localCandidate:v,remoteCandidate:C}),[2]}})})})},r.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&(clearInterval(this.webRtcStatsIntervalId),Le.warn("WebRtc stats stopped for disposed stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId))},r.prototype.sendStats=function(t,e){return Fe(this,void 0,void 0,function(){var n,i;return je(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n={headers:{"Content-type":"application/json"},body:JSON.stringify(e),method:"POST"},[4,fetch(t,n)];case 1:return o.sent(),[3,3];case 2:return i=o.sent(),Le.error("sendStats error: "+JSON.stringify(i)),[3,3];case 3:return[2]}})})},r.prototype.sendStatsToHttpEndpoint=function(){return Fe(this,void 0,void 0,function(){var t,e,n;return je(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.getCommonStats()];case 1:return t=i.sent(),e=this.generateJSONStatsResponse(t),[4,this.sendStats(this.POST_URL,e)];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),Le.log(n),[3,4];case 4:return[2]}})})},r.prototype.getCommonStats=function(){return Fe(this,void 0,void 0,function(){var t=this;return je(this,function(e){return[2,new Promise(function(n,i){return Fe(t,void 0,void 0,function(){var o,s,d,p,c,l=this;return je(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,this.stream.getRTCPeerConnection().getStats()];case 1:return o=b.sent(),s=this.getWebRtcStatsResponseOutline(),d=["framesReceived","framesDropped","framesSent","frameHeight","frameWidth"],p=["availableOutgoingBitrate","currentRoundTripTime"],o.forEach(function(y){var O=y.mediaType!=null?y.mediaType:y.kind,P=function(k,I){y[I]!=null&&s[k]!=null&&(!O&&d.indexOf(I)>-1&&(O="video"),k!=null&&O!=null&&I!=null&&s[k][O]!=null?s[k][O][I]=Number(y[I]):k!=null&&I!=null&&p.includes(I)&&(s[k][I]=Number(y[I])))};switch(y.type){case"outbound-rtp":P("outbound","bytesSent"),P("outbound","packetsSent"),P("outbound","framesEncoded"),P("outbound","nackCount"),P("outbound","firCount"),P("outbound","pliCount"),P("outbound","qpSum");break;case"inbound-rtp":P("inbound","bytesReceived"),P("inbound","packetsReceived"),P("inbound","packetsLost"),P("inbound","jitter"),P("inbound","framesDecoded"),P("inbound","nackCount"),P("inbound","firCount"),P("inbound","pliCount");break;case"track":P("inbound","jitterBufferDelay"),P("inbound","framesReceived"),P("outbound","framesDropped"),P("outbound","framesSent"),P(l.stream.isLocal()?"outbound":"inbound","frameHeight"),P(l.stream.isLocal()?"outbound":"inbound","frameWidth");break;case"candidate-pair":P("candidatepair","currentRoundTripTime"),P("candidatepair","availableOutgoingBitrate");break}}),(!(s!=null&&s.candidatepair)||Object.keys(s.candidatepair).length===0)&&delete s.candidatepair,[2,n(s)];case 2:return c=b.sent(),Le.error("Error getting common stats: ",c),[2,i(c)];case 3:return[2]}})})})]})})},r.prototype.generateJSONStatsResponse=function(t){return{"@timestamp":new Date().toISOString(),participant_id:this.stream.connection.data,session_id:this.stream.session.sessionId,platform:Ue.getName(),platform_description:Ue.getDescription(),stream:"webRTC",webrtc_stats:t}},r.prototype.getWebRtcStatsResponseOutline=function(){return this.stream.isLocal()?{outbound:{audio:{},video:{}},candidatepair:{}}:{inbound:{audio:{},video:{}}}},r}();Tt.WebRtcStats=Or;var at={},_r=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(at,"__esModule",{value:!0});at.PublisherSpeakingEvent=void 0;var Rr=de,Ir=function(r){_r(t,r);function t(e,n,i,o){var s=r.call(this,!1,e,n)||this;return s.type=n,s.connection=i,s.streamId=o,s}return t.prototype.callDefaultBehavior=function(){},t}(Rr.Event);at.PublisherSpeakingEvent=Ir;var Pr=wt;function wt(){}wt.mixin=function(r){var t=r.prototype||r;t.isWildEmitter=!0,t.on=function(e,n,i){this.callbacks=this.callbacks||{};var o=arguments.length===3,s=o?arguments[1]:void 0,d=o?arguments[2]:arguments[1];return d._groupName=s,(this.callbacks[e]=this.callbacks[e]||[]).push(d),this},t.once=function(e,n,i){var o=this,s=arguments.length===3,d=s?arguments[1]:void 0,p=s?arguments[2]:arguments[1];function c(){o.off(e,c),p.apply(this,arguments)}return this.on(e,d,c),this},t.releaseGroup=function(e){this.callbacks=this.callbacks||{};var n,i,o,s;for(n in this.callbacks)for(s=this.callbacks[n],i=0,o=s.length;i<o;i++)s[i]._groupName===e&&(s.splice(i,1),i--,o--);return this},t.off=function(e,n){this.callbacks=this.callbacks||{};var i=this.callbacks[e],o;return i?arguments.length===1?(delete this.callbacks[e],this):(o=i.indexOf(n),o!==-1&&(i.splice(o,1),i.length===0&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var n=[].slice.call(arguments,1),i=this.callbacks[e],o=this.getWildcardCallbacks(e),s,d,p;if(i)for(p=i.slice(),s=0,d=p.length;s<d&&p[s];++s)p[s].apply(this,n);if(o)for(d=o.length,p=o.slice(),s=0,d=p.length;s<d&&p[s];++s)p[s].apply(this,[e].concat(n));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var n,i,o=[];for(n in this.callbacks)i=n.split("*"),(n==="*"||i.length===2&&e.slice(0,i[0].length)===i[0])&&(o=o.concat(this.callbacks[n]));return o}};wt.mixin(wt);var kr=Pr;function Tr(r,t){var e=-1/0;r.getFloatFrequencyData(t);for(var n=4,i=t.length;n<i;n++)t[n]>e&&t[n]<0&&(e=t[n]);return e}var Gt;typeof window<"u"&&(Gt=window.AudioContext||window.webkitAudioContext);var we=null,Nr=function(r,n){var e=new kr;if(!Gt)return e;var n=n||{},i=n.smoothing||.1,o=n.interval||50,s=n.threshold,d=n.play,p=n.history||10,c=!0;we=n.audioContext||we||new Gt;var l,b,y;y=we.createAnalyser(),y.fftSize=512,y.smoothingTimeConstant=i,b=new Float32Array(y.frequencyBinCount),r.jquery&&(r=r[0]),r instanceof HTMLAudioElement||r instanceof HTMLVideoElement?(l=we.createMediaElementSource(r),typeof d>"u"&&(d=!0),s=s||-50):(l=we.createMediaStreamSource(r),s=s||-50),l.connect(y),d&&y.connect(we.destination),e.speaking=!1,e.suspend=function(){return we.suspend()},e.resume=function(){return we.resume()},Object.defineProperty(e,"state",{get:function(){return we.state}}),we.onstatechange=function(){e.emit("state_change",we.state)},e.setThreshold=function(k){s=k},e.setInterval=function(k){o=k},e.stop=function(){c=!1,e.emit("volume_change",-100,s),e.speaking&&(e.speaking=!1,e.emit("stopped_speaking")),y.disconnect(),l.disconnect()},e.speakingHistory=[];for(var O=0;O<p;O++)e.speakingHistory.push(0);var P=function(){setTimeout(function(){if(c){var k=Tr(y,b);e.emit("volume_change",k,s);var I=0;if(k>s&&!e.speaking){for(var v=e.speakingHistory.length-3;v<e.speakingHistory.length;v++)I+=e.speakingHistory[v];I>=2&&(e.speaking=!0,e.emit("speaking"))}else if(k<s&&e.speaking){for(var v=0;v<e.speakingHistory.length;v++)I+=e.speakingHistory[v];I==0&&(e.speaking=!1,e.emit("stopped_speaking"))}e.speakingHistory.shift(),e.speakingHistory.push(0+(k>s)),P()}},o)};return P(),e},mt=W&&W.__awaiter||function(r,t,e,n){function i(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(l){try{c(n.next(l))}catch(b){s(b)}}function p(l){try{c(n.throw(l))}catch(b){s(b)}}function c(l){l.done?o(l.value):i(l.value).then(d,p)}c((n=n.apply(r,t||[])).next())})},gt=W&&W.__generator||function(r,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function d(c){return function(l){return p([c,l])}}function p(c){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,i=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){e.label=c[1];break}if(c[0]===6&&e.label<o[1]){e.label=o[1],o=c;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(c);break}o[2]&&e.ops.pop(),e.trys.pop();continue}c=t.call(r,e)}catch(l){c=[6,l],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(qe,"__esModule",{value:!0});qe.Stream=void 0;var Mr=Ge,Dr=ze,Wt=Ie,Ar=Tt,Ve=Ke,Te=at,En=Ye,bt=ke,He=xe,Lr=oe,Vr=Ce,xr=Nr,Sn=Kt,K=Lr.OpenViduLogger.getInstance(),yn,Br=function(){function r(t,e){var n=this;this.isSubscribeToRemote=!1,this.isLocalStreamReadyToPublish=!1,this.isLocalStreamPublished=!1,this.publishedOnce=!1,this.harkSpeakingEnabled=!1,this.harkSpeakingEnabledOnce=!1,this.harkStoppedSpeakingEnabled=!1,this.harkStoppedSpeakingEnabledOnce=!1,this.harkVolumeChangeEnabled=!1,this.harkVolumeChangeEnabledOnce=!1,this.ee=new Sn,yn=Vr.PlatformUtils.getInstance(),this.session=t,e.hasOwnProperty("id")?(this.inboundStreamOpts=e,this.streamId=this.inboundStreamOpts.id,this.creationTime=this.inboundStreamOpts.createdAt,this.hasAudio=this.inboundStreamOpts.hasAudio,this.hasVideo=this.inboundStreamOpts.hasVideo,this.hasAudio&&(this.audioActive=this.inboundStreamOpts.audioActive),this.hasVideo&&(this.videoActive=this.inboundStreamOpts.videoActive,this.typeOfVideo=this.inboundStreamOpts.typeOfVideo?this.inboundStreamOpts.typeOfVideo:void 0,this.frameRate=this.inboundStreamOpts.frameRate===-1?void 0:this.inboundStreamOpts.frameRate,this.videoDimensions=this.inboundStreamOpts.videoDimensions),this.inboundStreamOpts.filter&&Object.keys(this.inboundStreamOpts.filter).length>0&&(this.inboundStreamOpts.filter.lastExecMethod&&Object.keys(this.inboundStreamOpts.filter.lastExecMethod).length===0&&delete this.inboundStreamOpts.filter.lastExecMethod,this.filter=this.inboundStreamOpts.filter)):(this.outboundStreamOpts=e,this.hasAudio=this.isSendAudio(),this.hasVideo=this.isSendVideo(),this.hasAudio&&(this.audioActive=!!this.outboundStreamOpts.publisherProperties.publishAudio),this.hasVideo&&(this.videoActive=!!this.outboundStreamOpts.publisherProperties.publishVideo,this.frameRate=this.outboundStreamOpts.publisherProperties.frameRate,typeof MediaStreamTrack<"u"&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?this.typeOfVideo="CUSTOM":this.typeOfVideo=this.isSendScreen()?"SCREEN":"CAMERA"),this.outboundStreamOpts.publisherProperties.filter&&(this.filter=this.outboundStreamOpts.publisherProperties.filter)),this.ee.on("mediastream-updated",function(){n.streamManager.updateMediaStream(n.mediaStream),K.debug("Video srcObject ["+n.mediaStream+"] updated in stream ["+n.streamId+"]")})}return r.prototype.reconnect=function(){return this.reconnectStream("API")},r.prototype.applyFilter=function(t,e){var n=this;return new Promise(function(i,o){n.session.sessionConnected()||o(n.session.notConnectedError()),K.info("Applying filter to stream "+n.streamId),e=e??{};var s=e;typeof s!="string"&&(s=JSON.stringify(s)),n.session.openvidu.sendRequest("applyFilter",{streamId:n.streamId,type:t,options:s},function(d,p){if(d)K.error("Error applying filter for Stream "+n.streamId,d),d.code===401?o(new He.OpenViduError(He.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):o(d);else{K.info("Filter successfully applied on Stream "+n.streamId);var c=n.filter;n.filter=new Mr.Filter(t,e),n.filter.stream=n,n.session.emitEvent("streamPropertyChanged",[new bt.StreamPropertyChangedEvent(n.session,n,"filter",n.filter,c,"applyFilter")]),n.streamManager.emitEvent("streamPropertyChanged",[new bt.StreamPropertyChangedEvent(n.streamManager,n,"filter",n.filter,c,"applyFilter")]),i(n.filter)}})})},r.prototype.removeFilter=function(){var t=this;return new Promise(function(e,n){t.session.sessionConnected()||n(t.session.notConnectedError()),K.info("Removing filter of stream "+t.streamId),t.session.openvidu.sendRequest("removeFilter",{streamId:t.streamId},function(i,o){if(i)K.error("Error removing filter for Stream "+t.streamId,i),i.code===401?n(new He.OpenViduError(He.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):n(i);else{K.info("Filter successfully removed from Stream "+t.streamId);var s=t.filter;delete t.filter,t.session.emitEvent("streamPropertyChanged",[new bt.StreamPropertyChangedEvent(t.session,t,"filter",t.filter,s,"applyFilter")]),t.streamManager.emitEvent("streamPropertyChanged",[new bt.StreamPropertyChangedEvent(t.streamManager,t,"filter",t.filter,s,"applyFilter")]),e()}})})},r.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},r.prototype.getMediaStream=function(){return this.mediaStream},r.prototype.setMediaStream=function(t){this.mediaStream=t},r.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},r.prototype.getWebRtcPeer=function(){return this.webRtcPeer},r.prototype.subscribeToMyRemote=function(t){this.isSubscribeToRemote=t},r.prototype.setOutboundStreamOptions=function(t){this.outboundStreamOpts=t},r.prototype.subscribe=function(){var t=this;return new Promise(function(e,n){t.initWebRtcPeerReceive(!1).then(function(){e()}).catch(function(i){n(i)})})},r.prototype.publish=function(){var t=this;return new Promise(function(e,n){t.isLocalStreamReadyToPublish?t.initWebRtcPeerSend(!1).then(function(){e()}).catch(function(i){n(i)}):t.ee.once("stream-ready-to-publish",function(){t.publish().then(function(){e()}).catch(function(i){n(i)})})})},r.prototype.disposeWebRtcPeer=function(){var t;this.webRtcPeer&&(this.webRtcPeer.dispose(),t=this.webRtcPeer.getId()),this.stopWebRtcStats(),K.info((this.outboundStreamOpts?"Outbound ":"Inbound ")+"RTCPeerConnection with id ["+t+"] from 'Stream' with id ["+this.streamId+"] is now closed")},r.prototype.disposeMediaStream=function(){this.mediaStream&&(this.mediaStream.getAudioTracks().forEach(function(t){t.stop()}),this.mediaStream.getVideoTracks().forEach(function(t){t.stop()}),delete this.mediaStream),this.localMediaStreamWhenSubscribedToRemote&&(this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach(function(t){t.stop()}),this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach(function(t){t.stop()}),delete this.localMediaStreamWhenSubscribedToRemote),this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),K.info((this.outboundStreamOpts?"Local ":"Remote ")+"MediaStream from 'Stream' with id ["+this.streamId+"] is now disposed")},r.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},r.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&this.outboundStreamOpts.publisherProperties.audioSource!==null&&this.outboundStreamOpts.publisherProperties.audioSource!==!1},r.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&this.outboundStreamOpts.publisherProperties.videoSource!==null&&this.outboundStreamOpts.publisherProperties.videoSource!==!1},r.prototype.isSendScreen=function(){var t=this.outboundStreamOpts.publisherProperties.videoSource==="screen";return yn.isElectron()&&(t=typeof this.outboundStreamOpts.publisherProperties.videoSource=="string"&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),!!this.outboundStreamOpts&&t},r.prototype.enableHarkSpeakingEvent=function(){var t=this;this.setHarkListenerIfNotExists(),this.harkSpeakingEnabled||(this.harkSpeakingEnabled=!0,this.speechEvent.on("speaking",function(){t.session.emitEvent("publisherStartSpeaking",[new Te.PublisherSpeakingEvent(t.session,"publisherStartSpeaking",t.connection,t.streamId)]),t.streamManager.emitEvent("publisherStartSpeaking",[new Te.PublisherSpeakingEvent(t.streamManager,"publisherStartSpeaking",t.connection,t.streamId)]),t.harkSpeakingEnabledOnce=!1}))},r.prototype.enableOnceHarkSpeakingEvent=function(){var t=this;this.setHarkListenerIfNotExists(),this.harkSpeakingEnabledOnce||(this.harkSpeakingEnabledOnce=!0,this.speechEvent.once("speaking",function(){t.harkSpeakingEnabledOnce&&(t.session.emitEvent("publisherStartSpeaking",[new Te.PublisherSpeakingEvent(t.session,"publisherStartSpeaking",t.connection,t.streamId)]),t.streamManager.emitEvent("publisherStartSpeaking",[new Te.PublisherSpeakingEvent(t.streamManager,"publisherStartSpeaking",t.connection,t.streamId)])),t.disableHarkSpeakingEvent(!0)}))},r.prototype.disableHarkSpeakingEvent=function(t){if(this.speechEvent){if(this.harkSpeakingEnabledOnce=!1,t){if(this.harkSpeakingEnabled)return}else this.harkSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},r.prototype.enableHarkStoppedSpeakingEvent=function(){var t=this;this.setHarkListenerIfNotExists(),this.harkStoppedSpeakingEnabled||(this.harkStoppedSpeakingEnabled=!0,this.speechEvent.on("stopped_speaking",function(){t.session.emitEvent("publisherStopSpeaking",[new Te.PublisherSpeakingEvent(t.session,"publisherStopSpeaking",t.connection,t.streamId)]),t.streamManager.emitEvent("publisherStopSpeaking",[new Te.PublisherSpeakingEvent(t.streamManager,"publisherStopSpeaking",t.connection,t.streamId)]),t.harkStoppedSpeakingEnabledOnce=!1}))},r.prototype.enableOnceHarkStoppedSpeakingEvent=function(){var t=this;this.setHarkListenerIfNotExists(),this.harkStoppedSpeakingEnabledOnce||(this.harkStoppedSpeakingEnabledOnce=!0,this.speechEvent.once("stopped_speaking",function(){t.harkStoppedSpeakingEnabledOnce&&(t.session.emitEvent("publisherStopSpeaking",[new Te.PublisherSpeakingEvent(t.session,"publisherStopSpeaking",t.connection,t.streamId)]),t.streamManager.emitEvent("publisherStopSpeaking",[new Te.PublisherSpeakingEvent(t.streamManager,"publisherStopSpeaking",t.connection,t.streamId)])),t.disableHarkStoppedSpeakingEvent(!0)}))},r.prototype.disableHarkStoppedSpeakingEvent=function(t){if(this.speechEvent){if(this.harkStoppedSpeakingEnabledOnce=!1,t){if(this.harkStoppedSpeakingEnabled)return}else this.harkStoppedSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce?this.speechEvent.off("stopped_speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},r.prototype.enableHarkVolumeChangeEvent=function(t){var e=this;this.setHarkListenerIfNotExists()?(!this.harkVolumeChangeEnabled||t)&&(this.harkVolumeChangeEnabled=!0,this.speechEvent.on("volume_change",function(n){var i=e.speechEvent.oldVolumeValue,o={newValue:n,oldValue:i};e.speechEvent.oldVolumeValue=n,e.streamManager.emitEvent("streamAudioVolumeChange",[new En.StreamManagerEvent(e.streamManager,"streamAudioVolumeChange",o)])})):this.harkVolumeChangeEnabled=!0},r.prototype.enableOnceHarkVolumeChangeEvent=function(t){var e=this;this.setHarkListenerIfNotExists()?(!this.harkVolumeChangeEnabledOnce||t)&&(this.harkVolumeChangeEnabledOnce=!0,this.speechEvent.once("volume_change",function(n){var i=e.speechEvent.oldVolumeValue,o={newValue:n,oldValue:i};e.speechEvent.oldVolumeValue=n,e.disableHarkVolumeChangeEvent(!0),e.streamManager.emitEvent("streamAudioVolumeChange",[new En.StreamManagerEvent(e.streamManager,"streamAudioVolumeChange",o)])})):this.harkVolumeChangeEnabledOnce=!0},r.prototype.disableHarkVolumeChangeEvent=function(t){if(this.speechEvent){if(this.harkVolumeChangeEnabledOnce=!1,t){if(this.harkVolumeChangeEnabled)return}else this.harkVolumeChangeEnabled=!1;this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)}},r.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},r.prototype.getSelectedIceCandidate=function(){var t=this;return new Promise(function(e,n){t.webRtcStats.getSelectedIceCandidateInfo().then(function(i){return e(i)}).catch(function(i){return n(i)})})},r.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},r.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},r.prototype.streamIceConnectionStateBroken=function(){if(!this.getWebRtcPeer()||!this.getRTCPeerConnection())return!1;if(this.isLocal()&&this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop)return K.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Stream '+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") will force a reconnection"),!0;var t=this.getRTCPeerConnection().iceConnectionState;return t!=="connected"&&t!=="completed"},r.prototype.setHarkListenerIfNotExists=function(){if(this.mediaStream){if(!this.speechEvent){var t=this.harkOptions?this.harkOptions:this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};t.interval=typeof t.interval=="number"?t.interval:100,t.threshold=typeof t.threshold=="number"?t.threshold:-50,this.speechEvent=xr(this.mediaStream,t)}return!0}return!1},r.prototype.setupReconnectionEventEmitter=function(t,e){return this.reconnectionEventEmitter==null?(this.reconnectionEventEmitter=new Sn,!1):(console.warn("Trying to reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") but an ongoing reconnection process is active. Waiting for response..."),this.reconnectionEventEmitter.once("success",function(){t()}),this.reconnectionEventEmitter.once("error",function(n){e(n)}),!0)},r.prototype.initWebRtcPeerSend=function(t){var e=this;return new Promise(function(n,i){if(t){if(e.setupReconnectionEventEmitter(n,i))return}else e.initHarkEvents();var o=function(){var c;t&&((c=e.reconnectionEventEmitter)===null||c===void 0||c.emitEvent("success"),delete e.reconnectionEventEmitter),n()},s=function(c){var l;t&&((l=e.reconnectionEventEmitter)===null||l===void 0||l.emitEvent("error",[c]),delete e.reconnectionEventEmitter),i(c)},d=function(c){K.debug("Sending SDP offer to publish as "+e.streamId,c);var l=t?"reconnectStream":"publishVideo",b;if(t)b={stream:e.streamId,sdpString:c};else{var y="";e.isSendVideo()&&(y=typeof MediaStreamTrack<"u"&&e.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?"CUSTOM":e.isSendScreen()?"SCREEN":"CAMERA"),b={doLoopback:e.displayMyRemote()||!1,hasAudio:e.isSendAudio(),hasVideo:e.isSendVideo(),audioActive:e.audioActive,videoActive:e.videoActive,typeOfVideo:y,frameRate:e.frameRate?e.frameRate:-1,videoDimensions:JSON.stringify(e.videoDimensions),filter:e.outboundStreamOpts.publisherProperties.filter,sdpOffer:c}}e.session.openvidu.sendRequest(l,b,function(O,P){O?O.code===401?s(new He.OpenViduError(He.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):s("Error on publishVideo: "+JSON.stringify(O)):e.webRtcPeer.processRemoteAnswer(P.sdpAnswer).then(function(){e.streamId=P.id,e.creationTime=P.createdAt,e.isLocalStreamPublished=!0,e.publishedOnce=!0,e.displayMyRemote()&&(e.localMediaStreamWhenSubscribedToRemote=e.mediaStream,e.remotePeerSuccessfullyEstablished(t)),t?e.ee.emitEvent("stream-reconnected-by-publisher",[]):e.ee.emitEvent("stream-created-by-publisher",[]),e.initWebRtcStats(),K.info("'Publisher' ("+e.streamId+") successfully "+(t?"reconnected":"published")+" to session"),o()}).catch(function(k){s(k)})})},p={mediaConstraints:{audio:e.hasAudio,video:e.hasVideo},simulcast:e.session.openvidu.advancedConfiguration.enableSimulcastExperimental||!1,onIceCandidate:e.connection.sendIceCandidate.bind(e.connection),onIceConnectionStateException:function(c,l,b){e.session.emitEvent("exception",[new Ve.ExceptionEvent(e.session,c,e,l,b)])},iceServers:e.getIceServersConf(),mediaStream:e.mediaStream,mediaServer:e.session.openvidu.mediaServer};t&&e.disposeWebRtcPeer(),e.displayMyRemote()?e.webRtcPeer=new Wt.WebRtcPeerSendrecv(p):e.webRtcPeer=new Wt.WebRtcPeerSendonly(p),e.webRtcPeer.addIceConnectionStateChangeListener("publisher of "+e.connection.connectionId),e.webRtcPeer.createOffer().then(function(c){e.webRtcPeer.processLocalOffer(c).then(function(){d(c.sdp)}).catch(function(l){s(new Error("(publish) SDP process local offer error: "+JSON.stringify(l)))})}).catch(function(c){s(new Error("(publish) SDP create offer error: "+JSON.stringify(c)))})})},r.prototype.finalResolveForSubscription=function(t,e){var n;K.info("'Subscriber' ("+this.streamId+") successfully "+(t?"reconnected":"subscribed")),this.remotePeerSuccessfullyEstablished(t),this.initWebRtcStats(),t&&((n=this.reconnectionEventEmitter)===null||n===void 0||n.emitEvent("success"),delete this.reconnectionEventEmitter),e()},r.prototype.finalRejectForSubscription=function(t,e,n){var i;K.error("Error for 'Subscriber' ("+this.streamId+") while trying to "+(t?"reconnect":"subscribe")+": "+e.toString()),t&&((i=this.reconnectionEventEmitter)===null||i===void 0||i.emitEvent("error",[e]),delete this.reconnectionEventEmitter),n(e)},r.prototype.initWebRtcPeerReceive=function(t){var e=this;return new Promise(function(n,i){t&&e.setupReconnectionEventEmitter(n,i)||(e.session.openvidu.mediaServer==="mediasoup"?e.initWebRtcPeerReceiveFromServer(t).then(function(){return e.finalResolveForSubscription(t,n)}).catch(function(o){return e.finalRejectForSubscription(t,o,i)}):e.initWebRtcPeerReceiveFromClient(t).then(function(){return e.finalResolveForSubscription(t,n)}).catch(function(o){return e.finalRejectForSubscription(t,o,i)}))})},r.prototype.initWebRtcPeerReceiveFromClient=function(t){var e=this;return new Promise(function(n,i){e.completeWebRtcPeerReceive(t,!1).then(function(o){e.webRtcPeer.processRemoteAnswer(o.sdpAnswer).then(function(){return n()}).catch(function(s){return i(s)})}).catch(function(o){return i(o)})})},r.prototype.initWebRtcPeerReceiveFromServer=function(t){var e=this;return new Promise(function(n,i){e.session.openvidu.sendRequest("prepareReceiveVideoFrom",{sender:e.streamId,reconnect:t},function(o,s){o?i(new Error("Error on prepareReceiveVideoFrom: "+JSON.stringify(o))):e.completeWebRtcPeerReceive(t,!1,s.sdpOffer).then(function(){return n()}).catch(function(d){return i(d)})})})},r.prototype.completeWebRtcPeerReceive=function(t,e,n){var i=this;return new Promise(function(o,s){K.debug("'Session.subscribe(Stream)' called");var d=function(c){K.debug("Sending local SDP "+(n?"answer":"offer")+" to subscribe to "+i.streamId,c);var l=t?"reconnectStream":"receiveVideoFrom",b={};b[t?"stream":"sender"]=i.streamId,n?b[t?"sdpString":"sdpAnswer"]=c:b.sdpOffer=c,t&&(b.forciblyReconnect=e),i.session.openvidu.sendRequest(l,b,function(y,O){y?s(new Error("Error on "+l+" : "+JSON.stringify(y))):o(O)})},p={mediaConstraints:{audio:i.hasAudio,video:i.hasVideo},simulcast:!1,onIceCandidate:i.connection.sendIceCandidate.bind(i.connection),onIceConnectionStateException:function(c,l,b){i.session.emitEvent("exception",[new Ve.ExceptionEvent(i.session,c,i,l,b)])},iceServers:i.getIceServersConf(),mediaServer:i.session.openvidu.mediaServer};t&&i.disposeWebRtcPeer(),i.webRtcPeer=new Wt.WebRtcPeerRecvonly(p),i.webRtcPeer.addIceConnectionStateChangeListener(i.streamId),n?i.webRtcPeer.processRemoteOffer(n).then(function(){i.webRtcPeer.createAnswer().then(function(c){i.webRtcPeer.processLocalAnswer(c).then(function(){d(c.sdp)}).catch(function(l){s(new Error("(subscribe) SDP process local answer error: "+JSON.stringify(l)))})}).catch(function(c){s(new Error("(subscribe) SDP create answer error: "+JSON.stringify(c)))})}).catch(function(c){s(new Error("(subscribe) SDP process remote offer error: "+JSON.stringify(c)))}):i.webRtcPeer.createOffer().then(function(c){i.webRtcPeer.processLocalOffer(c).then(function(){d(c.sdp)}).catch(function(l){s(new Error("(subscribe) SDP process local offer error: "+JSON.stringify(l)))})}).catch(function(c){s(new Error("(subscribe) SDP create offer error: "+JSON.stringify(c)))})})},r.prototype.remotePeerSuccessfullyEstablished=function(t){t&&this.mediaStream!=null&&this.disposeMediaStream(),this.mediaStream=new MediaStream;for(var e,n=0,i=this.webRtcPeer.pc.getReceivers();n<i.length;n++)e=i[n],e.track&&this.mediaStream.addTrack(e.track);if(K.debug("Peer remote stream",this.mediaStream),this.mediaStream){if(this.streamManager instanceof Dr.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var o=t?this.audioActive:!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=o}if(this.mediaStream.getVideoTracks()[0]){var o=t?this.videoActive:!!this.streamManager.properties.subscribeToVideo;this.mediaStream.getVideoTracks()[0].enabled=o}}this.updateMediaStreamInVideos(),this.initHarkEvents()}},r.prototype.initHarkEvents=function(){this.mediaStream.getAudioTracks()[0]&&(this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!0,this.streamManager)&&this.enableOnceHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.streamManager)&&this.enableHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!0,this.streamManager)&&this.enableOnceHarkStoppedSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.streamManager)&&this.enableHarkStoppedSpeakingEvent(),this.harkVolumeChangeEnabledOnce&&this.enableOnceHarkVolumeChangeEvent(!0),this.harkVolumeChangeEnabled&&this.enableHarkVolumeChangeEvent(!0))},r.prototype.onIceConnectionStateExceptionHandler=function(t,e,n){switch(t){case Ve.ExceptionEventName.ICE_CONNECTION_FAILED:this.onIceConnectionFailed();break;case Ve.ExceptionEventName.ICE_CONNECTION_DISCONNECTED:this.onIceConnectionDisconnected();break}this.session.emitEvent("exception",[new Ve.ExceptionEvent(this.session,t,this,e,n)])},r.prototype.onIceConnectionFailed=function(){K.log("[ICE_CONNECTION_FAILED] Handling ICE_CONNECTION_FAILED event. Reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+")"),this.reconnectStreamAndLogResultingIceConnectionState(Ve.ExceptionEventName.ICE_CONNECTION_FAILED)},r.prototype.onIceConnectionDisconnected=function(){var t=this;K.log("[ICE_CONNECTION_DISCONNECTED] Handling ICE_CONNECTION_DISCONNECTED event. Waiting for ICE to be restored and reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") if not possible");var e=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3;this.awaitWebRtcPeerConnectionState(e).then(function(n){switch(n){case"failed":K.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream "+t.streamId+" ("+(t.isLocal()?"Publisher":"Subscriber")+") is now failed after ICE_CONNECTION_DISCONNECTED");break;case"connected":case"completed":K.log("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream "+t.streamId+" ("+(t.isLocal()?"Publisher":"Subscriber")+") automatically restored after ICE_CONNECTION_DISCONNECTED. Current ICE connection state: "+n);break;case"closed":case"checking":case"new":case"disconnected":K.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream "+t.streamId+" ("+(t.isLocal()?"Publisher":"Subscriber")+") couldn't be restored after ICE_CONNECTION_DISCONNECTED event. Current ICE connection state after "+e+" ms: "+n),t.reconnectStreamAndLogResultingIceConnectionState(Ve.ExceptionEventName.ICE_CONNECTION_DISCONNECTED);break}})},r.prototype.reconnectStreamAndLogResultingIceConnectionState=function(t){return mt(this,void 0,void 0,function(){var e,n;return gt(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.reconnectStreamAndReturnIceConnectionState(t)];case 1:switch(e=i.sent(),e){case"connected":case"completed":K.log("["+t+"] Stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") successfully reconnected after "+t+". Current ICE connection state: "+e);break;default:K.error("["+t+"] Stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") failed to reconnect after "+t+". Current ICE connection state: "+e);break}return[3,3];case 2:return n=i.sent(),K.error("["+t+"] Error reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") after "+t+": "+n),[3,3];case 3:return[2]}})})},r.prototype.reconnectStreamAndReturnIceConnectionState=function(t){return mt(this,void 0,void 0,function(){var e,n;return gt(this,function(i){switch(i.label){case 0:K.log("["+t+"] Reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") after event "+t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.reconnectStream(t)];case 2:return i.sent(),e=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3,[2,this.awaitWebRtcPeerConnectionState(e)];case 3:return n=i.sent(),K.warn("["+t+"] Error reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+"). Reason: "+n),[2,this.awaitWebRtcPeerConnectionState(1)];case 4:return[2]}})})},r.prototype.reconnectStream=function(t){return mt(this,void 0,void 0,function(){var e,n;return gt(this,function(i){switch(i.label){case 0:return[4,this.isWebsocketConnected(t,3e3)];case 1:if(e=i.sent(),e)return K.log("["+t+"] Trying to reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") and the websocket is opened"),this.isLocal()?[2,this.initWebRtcPeerSend(!0)]:[2,this.initWebRtcPeerReceive(!0)];throw n="["+t+"] Trying to reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") but the websocket wasn't opened",K.error(n),Error(n)}})})},r.prototype.isWebsocketConnected=function(t,e){var n=this;return new Promise(function(i,o){var s=n.session.openvidu.getWsReadyState();if(s===1){var d=setTimeout(function(){console.warn("["+t+"] Websocket timeout of "+e+"ms"),i(!1)},e);n.session.openvidu.sendRequest("echo",{},function(p,c){clearTimeout(d),p?(console.warn("["+t+"] Websocket 'echo' returned error: "+p),i(!1)):i(!0)})}else console.warn("["+t+"] Websocket readyState is "+s),i(!1)})},r.prototype.awaitWebRtcPeerConnectionState=function(t){return mt(this,void 0,void 0,function(){var e,n,i,o;return gt(this,function(s){switch(s.label){case 0:e=this.getRTCPeerConnection().iceConnectionState,n=150,i=Math.ceil(t/n),o=0,s.label=1;case 1:return o<i?(e=this.getRTCPeerConnection().iceConnectionState,e==="connected"||e==="completed"?[3,4]:[4,new Promise(function(d){return setTimeout(d,n)})]):[3,4];case 2:s.sent(),s.label=3;case 3:return o++,[3,1];case 4:return[2,e]}})})},r.prototype.initWebRtcStats=function(){this.webRtcStats=new Ar.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},r.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},r.prototype.getIceServersConf=function(){var t;return this.session.openvidu.advancedConfiguration.iceServers?t=this.session.openvidu.advancedConfiguration.iceServers==="freeice"?void 0:this.session.openvidu.advancedConfiguration.iceServers:this.session.openvidu.iceServers?t=this.session.openvidu.iceServers:t=void 0,t},r.prototype.gatherStatsForPeer=function(){var t=this;return new Promise(function(e,n){t.isLocal()?t.getRTCPeerConnection().getSenders().forEach(function(i){return i.getStats().then(function(o){o.forEach(function(s){if(t.isReportWanted(s)){var d={};d.type=s.type,d.timestamp=s.timestamp,d.id=s.id,s.type==="outbound-rtp"&&(d.ssrc=s.ssrc,d.firCount=s.firCount,d.pliCount=s.pliCount,d.nackCount=s.nackCount,d.qpSum=s.qpSum,s.kind?d.mediaType=s.kind:s.mediaType?d.mediaType=s.mediaType:d.mediaType=s.id.indexOf("VideoStream")!==-1?"video":"audio",d.mediaType==="video"&&(d.framesEncoded=s.framesEncoded),d.packetsSent=s.packetsSent,d.bytesSent=s.bytesSent),s.type==="candidate-pair"&&s.totalRoundTripTime!==void 0&&(d.availableOutgoingBitrate=s.availableOutgoingBitrate,d.rtt=s.currentRoundTripTime,d.averageRtt=s.totalRoundTripTime/s.responsesReceived),s.type==="remote-inbound-rtp"||s.type,K.log(d)}})})}):t.getRTCPeerConnection().getReceivers().forEach(function(i){return i.getStats().then(function(o){o.forEach(function(s){if(t.isReportWanted(s)){var d={};d.type=s.type,d.timestamp=s.timestamp,d.id=s.id,s.type==="inbound-rtp"&&(d.ssrc=s.ssrc,d.firCount=s.firCount,d.pliCount=s.pliCount,d.nackCount=s.nackCount,d.qpSum=s.qpSum,s.kind?d.mediaType=s.kind:s.mediaType?d.mediaType=s.mediaType:d.mediaType=s.id.indexOf("VideoStream")!==-1?"video":"audio",d.mediaType==="video"&&(d.framesDecoded=s.framesDecoded),d.packetsReceived=s.packetsReceived,d.packetsLost=s.packetsLost,d.jitter=s.jitter,d.bytesReceived=s.bytesReceived),s.type==="candidate-pair"&&s.totalRoundTripTime!==void 0&&(d.availableIncomingBitrate=s.availableIncomingBitrate,d.rtt=s.currentRoundTripTime,d.averageRtt=s.totalRoundTripTime/s.responsesReceived),s.type==="remote-inbound-rtp"||s.type,K.log(d)}})})})})},r.prototype.isReportWanted=function(t){return t.type==="inbound-rtp"&&!this.isLocal()||t.type==="outbound-rtp"&&this.isLocal()||t.type==="candidate-pair"&&t.nominated&&t.bytesSent>0},r}();qe.Stream=Br;Object.defineProperty(ot,"__esModule",{value:!0});ot.Connection=void 0;var Wr=qe,Fr=oe,wn=Ke,Et=Fr.OpenViduLogger.getInstance(),jr=function(){function r(t,e){this.session=t,this.disposed=!1;var n="'Connection' created ";e.role?(this.localOptions=e,this.connectionId=this.localOptions.id,this.creationTime=this.localOptions.createdAt,this.data=this.localOptions.metadata,this.rpcSessionId=this.localOptions.sessionId,this.role=this.localOptions.role,this.record=this.localOptions.record,n+="(local)"):(this.remoteOptions=e,this.connectionId=this.remoteOptions.id,this.creationTime=this.remoteOptions.createdAt,this.remoteOptions.metadata&&(this.data=this.remoteOptions.metadata),this.remoteOptions.streams&&this.initRemoteStreams(this.remoteOptions.streams),n+="(remote) with 'connectionId' ["+this.remoteOptions.id+"]"),Et.info(n)}return r.prototype.sendIceCandidate=function(t){var e=this;Et.debug((this.stream.outboundStreamOpts?"Local":"Remote")+"candidate for"+this.connectionId,t),this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:t.candidate,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex},function(n,i){n&&(Et.error("Error sending ICE candidate: "+JSON.stringify(n)),e.session.emitEvent("exception",[new wn.ExceptionEvent(e.session,wn.ExceptionEventName.ICE_CANDIDATE_ERROR,e.session,"There was an unexpected error on the server-side processing an ICE candidate generated and sent by the client-side",n)]))})},r.prototype.initRemoteStreams=function(t){var e=this;t.forEach(function(n){var i={id:n.id,createdAt:n.createdAt,connection:e,hasAudio:n.hasAudio,hasVideo:n.hasVideo,audioActive:n.audioActive,videoActive:n.videoActive,typeOfVideo:n.typeOfVideo,frameRate:n.frameRate,videoDimensions:n.videoDimensions?JSON.parse(n.videoDimensions):void 0,filter:n.filter?n.filter:void 0},o=new Wr.Stream(e.session,i);e.addStream(o)}),Et.info("Remote 'Connection' with 'connectionId' ["+this.connectionId+"] is now configured for receiving Streams with options: ",this.stream.inboundStreamOpts)},r.prototype.addStream=function(t){t.connection=this,this.stream=t},r.prototype.removeStream=function(t){delete this.stream},r.prototype.dispose=function(){this.stream&&delete this.stream,this.disposed=!0},r}();ot.Connection=jr;var ct={},Ur=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(ct,"__esModule",{value:!0});ct.ConnectionEvent=void 0;var Hr=de,$r=function(r){Ur(t,r);function t(e,n,i,o,s){var d=r.call(this,e,n,i)||this;return d.connection=o,d.reason=s,d}return t.prototype.callDefaultBehavior=function(){},t}(Hr.Event);ct.ConnectionEvent=$r;var dt={},qr=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(dt,"__esModule",{value:!0});dt.FilterEvent=void 0;var Gr=de,zr=function(r){qr(t,r);function t(e,n,i){var o=r.call(this,!1,e,n)||this;return o.data=i,o}return t.prototype.callDefaultBehavior=function(){},t}(Gr.Event);dt.FilterEvent=zr;var ut={},Jr=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(ut,"__esModule",{value:!0});ut.RecordingEvent=void 0;var Xr=de,Yr=function(r){Jr(t,r);function t(e,n,i,o,s){var d=r.call(this,!1,e,n)||this;return d.id=i,o!==i&&(d.name=o),d.reason=s,d}return t.prototype.callDefaultBehavior=function(){},t}(Xr.Event);ut.RecordingEvent=Yr;var Ze={},Qr=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Ze,"__esModule",{value:!0});Ze.SessionDisconnectedEvent=void 0;var Kr=de,Zr=oe,eo=Zr.OpenViduLogger.getInstance(),to=function(r){Qr(t,r);function t(e,n){var i=r.call(this,!0,e,"sessionDisconnected")||this;return i.reason=n,i}return t.prototype.callDefaultBehavior=function(){eo.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'");var e=this.target;e.remoteConnections.forEach(function(n){var i,o,s,d,p,c,l,b,y=n.connectionId;if(!((i=e.remoteConnections.get(y))===null||i===void 0)&&i.stream){(o=e.remoteConnections.get(y))===null||o===void 0||o.stream.disposeWebRtcPeer(),(s=e.remoteConnections.get(y))===null||s===void 0||s.stream.disposeMediaStream(),!((d=e.remoteConnections.get(y))===null||d===void 0)&&d.stream.streamManager&&((p=e.remoteConnections.get(y))===null||p===void 0||p.stream.streamManager.removeAllVideos());var O=(l=(c=e.remoteConnections.get(y))===null||c===void 0?void 0:c.stream)===null||l===void 0?void 0:l.streamId;O&&e.remoteStreamsCreated.delete(O),(b=e.remoteConnections.get(y))===null||b===void 0||b.dispose()}e.remoteConnections.delete(y)})},t}(Kr.Event);Ze.SessionDisconnectedEvent=to;var ft={},no=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(ft,"__esModule",{value:!0});ft.SignalEvent=void 0;var io=de,ro=function(r){no(t,r);function t(e,n,i,o){var s=r.call(this,!1,e,"signal")||this;return n&&(s.type="signal:"+n),s.data=i,s.from=o,s}return t.prototype.callDefaultBehavior=function(){},t}(io.Event);ft.SignalEvent=ro;var it={},Cn;function en(){if(Cn)return it;Cn=1;var r=W&&W.__extends||function(){var d=function(p,c){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,b){l.__proto__=b}||function(l,b){for(var y in b)Object.prototype.hasOwnProperty.call(b,y)&&(l[y]=b[y])},d(p,c)};return function(p,c){d(p,c);function l(){this.constructor=p}p.prototype=c===null?Object.create(c):(l.prototype=c.prototype,new l)}}();Object.defineProperty(it,"__esModule",{value:!0}),it.StreamEvent=void 0;var t=de,e=tn(),n=Nt(),i=oe,o=i.OpenViduLogger.getInstance(),s=function(d){r(p,d);function p(c,l,b,y,O){var P=d.call(this,c,l,b)||this;return P.stream=y,P.reason=O,P}return p.prototype.callDefaultBehavior=function(){if(this.type==="streamDestroyed"){if(this.target instanceof n.Session)o.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'"),this.stream.disposeWebRtcPeer();else if(this.target instanceof e.Publisher){o.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Publisher'"),clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var c=this.target.openvidu.publishers,l=0;l<c.length;l++)if(c[l]===this.target){c.splice(l,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),this.stream.session.remoteStreamsCreated.delete(this.stream.streamId);var b=this.stream.session.remoteConnections.get(this.stream.connection.connectionId);if(b&&b.remoteOptions)for(var y=b.remoteOptions.streams,l=y.length-1;l>=0;--l)y[l].id===this.stream.streamId&&y.splice(l,1)}},p}(t.Event);return it.StreamEvent=s,it}var lt={},oo=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(lt,"__esModule",{value:!0});lt.ConnectionPropertyChangedEvent=void 0;var so=de,ao=function(r){oo(t,r);function t(e,n,i,o,s){var d=r.call(this,!1,e,"connectionPropertyChanged")||this;return d.connection=n,d.changedProperty=i,d.newValue=o,d.oldValue=s,d}return t.prototype.callDefaultBehavior=function(){},t}(so.Event);lt.ConnectionPropertyChangedEvent=ao;var ht={},co=W&&W.__extends||function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(ht,"__esModule",{value:!0});ht.NetworkQualityLevelChangedEvent=void 0;var uo=de,fo=function(r){co(t,r);function t(e,n,i,o){var s=r.call(this,!1,e,"networkQualityLevelChanged")||this;return s.newValue=n,s.oldValue=i,s.connection=o,s}return t.prototype.callDefaultBehavior=function(){},t}(uo.Event);ht.NetworkQualityLevelChangedEvent=fo;var On;function Nt(){if(On)return nt;On=1;var r=W&&W.__extends||function(){var U=function(u,a){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var m in g)Object.prototype.hasOwnProperty.call(g,m)&&(h[m]=g[m])},U(u,a)};return function(u,a){U(u,a);function h(){this.constructor=u}u.prototype=a===null?Object.create(a):(h.prototype=a.prototype,new h)}}(),t=W&&W.__awaiter||function(U,u,a,h){function g(m){return m instanceof a?m:new a(function(S){S(m)})}return new(a||(a=Promise))(function(m,S){function _(f){try{E(h.next(f))}catch(R){S(R)}}function M(f){try{E(h.throw(f))}catch(R){S(R)}}function E(f){f.done?m(f.value):g(f.value).then(_,M)}E((h=h.apply(U,u||[])).next())})},e=W&&W.__generator||function(U,u){var a={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},h,g,m,S;return S={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(S[Symbol.iterator]=function(){return this}),S;function _(E){return function(f){return M([E,f])}}function M(E){if(h)throw new TypeError("Generator is already executing.");for(;a;)try{if(h=1,g&&(m=E[0]&2?g.return:E[0]?g.throw||((m=g.return)&&m.call(g),0):g.next)&&!(m=m.call(g,E[1])).done)return m;switch(g=0,m&&(E=[E[0]&2,m.value]),E[0]){case 0:case 1:m=E;break;case 4:return a.label++,{value:E[1],done:!1};case 5:a.label++,g=E[1],E=[0];continue;case 7:E=a.ops.pop(),a.trys.pop();continue;default:if(m=a.trys,!(m=m.length>0&&m[m.length-1])&&(E[0]===6||E[0]===2)){a=0;continue}if(E[0]===3&&(!m||E[1]>m[0]&&E[1]<m[3])){a.label=E[1];break}if(E[0]===6&&a.label<m[1]){a.label=m[1],m=E;break}if(m&&a.label<m[2]){a.label=m[2],a.ops.push(E);break}m[2]&&a.ops.pop(),a.trys.pop();continue}E=u.call(U,a)}catch(f){E=[6,f],g=0}finally{h=m=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}};Object.defineProperty(nt,"__esModule",{value:!0}),nt.Session=void 0;var n=ot,i=Ge,o=ze,s=Xe,d=ct,p=dt,c=ut,l=Ze,b=ft,y=en(),O=ke,P=lt,k=ht,I=xe,v=st,T=oe,D=Ce,C=T.OpenViduLogger.getInstance(),L,F=function(U){r(u,U);function u(a){var h=U.call(this)||this;return h.streamManagers=[],h.remoteStreamsCreated=new Map,h.remoteConnections=new Map,L=D.PlatformUtils.getInstance(),h.openvidu=a,h}return u.prototype.connect=function(a,h){var g=this;return new Promise(function(m,S){g.processToken(a),g.openvidu.checkSystemRequirements()?(g.options={sessionId:g.sessionId,participantId:a,metadata:h?g.stringClientMetadata(h):""},g.connectAux(a).then(function(){m()}).catch(function(_){S(_)})):S(new I.OpenViduError(I.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+L.getName()+" (version "+L.getVersion()+") for "+L.getFamily()+" is not supported in OpenVidu"))})},u.prototype.disconnect=function(){this.leave(!1,"disconnect")},u.prototype.subscribe=function(a,h,g,m){var S={};g&&typeof g!="function"?S={insertMode:typeof g.insertMode<"u"?typeof g.insertMode=="string"?v.VideoInsertMode[g.insertMode]:S.insertMode:v.VideoInsertMode.APPEND,subscribeToAudio:typeof g.subscribeToAudio<"u"?g.subscribeToAudio:!0,subscribeToVideo:typeof g.subscribeToVideo<"u"?g.subscribeToVideo:!0}:S={insertMode:v.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0};var _=void 0;if(g&&typeof g=="function"?_=g:m&&(_=m),!this.sessionConnected())throw _!==void 0&&_(this.notConnectedError()),this.notConnectedError();C.info("Subscribing to "+a.connection.connectionId),a.subscribe().then(function(){C.info("Subscribed correctly to "+a.connection.connectionId),_!==void 0&&_(void 0)}).catch(function(E){_!==void 0&&_(E)});var M=new o.Subscriber(a,h,S);return M.targetElement&&a.streamManager.createVideoElement(M.targetElement,S.insertMode),M},u.prototype.subscribeAsync=function(a,h,g){var m=this;return new Promise(function(S,_){m.sessionConnected()||_(m.notConnectedError());var M,E=function(f){f?_(f):S(M)};g?M=m.subscribe(a,h,g,E):M=m.subscribe(a,h,E)})},u.prototype.unsubscribe=function(a){var h=this;return new Promise(function(g,m){if(!h.sessionConnected())m(h.notConnectedError());else{var S=a.stream.connection.connectionId;C.info("Unsubscribing from "+S),h.openvidu.sendRequest("unsubscribeFromVideo",{sender:a.stream.connection.connectionId},function(_,M){_?(C.error("Error unsubscribing from "+S),m(_)):(C.info("Unsubscribed correctly from "+S),a.stream.streamManager.removeAllVideos(),a.stream.disposeWebRtcPeer(),a.stream.disposeMediaStream(),g())})}})},u.prototype.publish=function(a){var h=this;return new Promise(function(g,m){h.sessionConnected()||m(h.notConnectedError()),a.session=h,a.stream.session=h,a.stream.publishedOnce?a.initialize().then(function(){h.connection.addStream(a.stream),a.reestablishStreamPlayingEvent(),a.stream.publish().then(function(){h.sendVideoData(a,8,!0,5),g()}).catch(function(S){m(S)})}).catch(function(S){m(S)}):(h.connection.addStream(a.stream),a.stream.publish().then(function(){h.sendVideoData(a,8,!0,5),g()}).catch(function(S){m(S)}))})},u.prototype.unpublish=function(a){var h=this;return new Promise(function(g,m){if(!h.sessionConnected())throw h.notConnectedError();var S=a.stream;S.connection?S.connection!==h.connection?m(new Error("The associated Connection object of this Publisher is not your local Connection.Only moderators can force unpublish on remote Streams via 'forceUnpublish' method")):(C.info("Unpublishing local media ("+S.connection.connectionId+")"),h.openvidu.sendRequest("unpublishVideo",function(_,M){if(_)m(_);else{C.info("Media unpublished correctly"),S.disposeWebRtcPeer(),S.connection.stream==S&&delete S.connection.stream;var E=new y.StreamEvent(!0,a,"streamDestroyed",a.stream,"unpublish");a.emitEvent("streamDestroyed",[E]),E.callDefaultBehavior(),g()}})):m(new Error("The associated Connection object of this Publisher is null"))})},u.prototype.forceDisconnect=function(a){var h=this;return new Promise(function(g,m){h.sessionConnected()||m(h.notConnectedError()),C.info("Forcing disconnect for connection "+a.connectionId),h.openvidu.sendRequest("forceDisconnect",{connectionId:a.connectionId},function(S,_){S?(C.error("Error forcing disconnect for Connection "+a.connectionId,S),S.code===401?m(new I.OpenViduError(I.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):m(S)):(C.info("Forcing disconnect correctly for Connection "+a.connectionId),g())})})},u.prototype.forceUnpublish=function(a){var h=this;return new Promise(function(g,m){h.sessionConnected()||m(h.notConnectedError()),C.info("Forcing unpublish for stream "+a.streamId),h.openvidu.sendRequest("forceUnpublish",{streamId:a.streamId},function(S,_){S?(C.error("Error forcing unpublish for Stream "+a.streamId,S),S.code===401?m(new I.OpenViduError(I.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):m(S)):(C.info("Forcing unpublish correctly for Stream "+a.streamId),g())})})},u.prototype.signal=function(a){var h=this;return new Promise(function(g,m){h.sessionConnected()||m(h.notConnectedError());var S={};if(a.to&&a.to.length>0){var _=[];a.to.forEach(function(E){E.connectionId&&_.push(E.connectionId)}),S.to=_}else S.to=[];S.data=a.data?a.data:"";var M=a.type?a.type:"signal";M&&M.substring(0,7)!=="signal:"&&(M="signal:"+M),S.type=M,h.openvidu.sendRequest("sendMessage",{message:JSON.stringify(S)},function(E,f){E?m(E):g()})})},u.prototype.on=function(a,h){var g,m,S,_;return U.prototype.onAux.call(this,a,"Event '"+a+"' triggered by 'Session'",h),a==="publisherStartSpeaking"&&(this.remoteConnections.forEach(function(M){var E;!((E=M.stream)===null||E===void 0)&&E.hasAudio&&M.stream.enableHarkSpeakingEvent()}),!((m=(g=this.connection)===null||g===void 0?void 0:g.stream)===null||m===void 0)&&m.hasAudio&&this.connection.stream.enableHarkSpeakingEvent()),a==="publisherStopSpeaking"&&(this.remoteConnections.forEach(function(M){var E;!((E=M.stream)===null||E===void 0)&&E.hasAudio&&M.stream.enableHarkStoppedSpeakingEvent()}),!((_=(S=this.connection)===null||S===void 0?void 0:S.stream)===null||_===void 0)&&_.hasAudio&&this.connection.stream.enableHarkStoppedSpeakingEvent()),this},u.prototype.once=function(a,h){var g,m,S,_;return U.prototype.onceAux.call(this,a,"Event '"+a+"' triggered once by 'Session'",h),a==="publisherStartSpeaking"&&(this.remoteConnections.forEach(function(M){var E;!((E=M.stream)===null||E===void 0)&&E.hasAudio&&M.stream.enableOnceHarkSpeakingEvent()}),!((m=(g=this.connection)===null||g===void 0?void 0:g.stream)===null||m===void 0)&&m.hasAudio&&this.connection.stream.enableOnceHarkSpeakingEvent()),a==="publisherStopSpeaking"&&(this.remoteConnections.forEach(function(M){var E;!((E=M.stream)===null||E===void 0)&&E.hasAudio&&M.stream.enableOnceHarkStoppedSpeakingEvent()}),!((_=(S=this.connection)===null||S===void 0?void 0:S.stream)===null||_===void 0)&&_.hasAudio&&this.connection.stream.enableOnceHarkStoppedSpeakingEvent()),this},u.prototype.off=function(a,h){var g=this,m,S,_,M;return U.prototype.off.call(this,a,h),a==="publisherStartSpeaking"&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1)||(this.remoteConnections.forEach(function(E){var f;!((f=E.stream)===null||f===void 0)&&f.streamManager&&(g.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,E.stream.streamManager)||E.stream.disableHarkSpeakingEvent(!1))}),!((S=(m=this.connection)===null||m===void 0?void 0:m.stream)===null||S===void 0)&&S.streamManager&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkSpeakingEvent(!1)))),a==="publisherStopSpeaking"&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1)||(this.remoteConnections.forEach(function(E){var f;!((f=E.stream)===null||f===void 0)&&f.streamManager&&(g.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,E.stream.streamManager)||E.stream.disableHarkStoppedSpeakingEvent(!1))}),!((M=(_=this.connection)===null||_===void 0?void 0:_.stream)===null||M===void 0)&&M.streamManager&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkStoppedSpeakingEvent(!1)))),this},u.prototype.onParticipantJoined=function(a){var h=this;this.getConnection(a.id,"").then(function(g){C.warn("Connection "+g.connectionId+" already exists in connections list")}).catch(function(g){var m=new n.Connection(h,a);h.remoteConnections.set(a.id,m),h.ee.emitEvent("connectionCreated",[new d.ConnectionEvent(!1,h,"connectionCreated",m,"")])})},u.prototype.onParticipantLeft=function(a){var h=this;this.getRemoteConnection(a.connectionId,"onParticipantLeft").then(function(g){if(g.stream){var m=g.stream,S=new y.StreamEvent(!0,h,"streamDestroyed",m,a.reason);h.ee.emitEvent("streamDestroyed",[S]),S.callDefaultBehavior(),h.remoteStreamsCreated.delete(m.streamId)}h.remoteConnections.delete(g.connectionId),h.ee.emitEvent("connectionDestroyed",[new d.ConnectionEvent(!1,h,"connectionDestroyed",g,a.reason)])}).catch(function(g){C.error(g)})},u.prototype.onParticipantPublished=function(a){var h=this,g=function(S){h.remoteConnections.set(S.connectionId,S),h.remoteStreamsCreated.get(S.stream.streamId)||h.ee.emitEvent("streamCreated",[new y.StreamEvent(!1,h,"streamCreated",S.stream,"")]),h.remoteStreamsCreated.set(S.stream.streamId,!0)},m;this.getRemoteConnection(a.id,"onParticipantPublished").then(function(S){m=S,a.metadata=S.data,m.remoteOptions=a,m.initRemoteStreams(a.streams),g(m)}).catch(function(S){m=new n.Connection(h,a),g(m)})},u.prototype.onParticipantUnpublished=function(a){var h=this;a.connectionId===this.connection.connectionId?this.stopPublisherStream(a.reason):this.getRemoteConnection(a.connectionId,"onParticipantUnpublished").then(function(g){var m=new y.StreamEvent(!0,h,"streamDestroyed",g.stream,a.reason);h.ee.emitEvent("streamDestroyed",[m]),m.callDefaultBehavior();var S=g.stream.streamId;h.remoteStreamsCreated.delete(S),g.removeStream(S)}).catch(function(g){C.error(g)})},u.prototype.onParticipantEvicted=function(a){a.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,a.reason)},u.prototype.onNewMessage=function(a){var h=this;C.info("New signal: "+JSON.stringify(a));var g=a.type?a.type.replace(/^(signal:)/,""):void 0;a.from?this.getConnection(a.from,"Connection '"+a.from+"' unknown when 'onNewMessage'. Existing remote connections: "+JSON.stringify(this.remoteConnections.keys())+". Existing local connection: "+this.connection.connectionId).then(function(m){h.ee.emitEvent("signal",[new b.SignalEvent(h,g,a.data,m)]),a.type&&a.type!=="signal"&&h.ee.emitEvent(a.type,[new b.SignalEvent(h,g,a.data,m)])}).catch(function(m){C.error(m)}):(this.ee.emitEvent("signal",[new b.SignalEvent(this,g,a.data,void 0)]),a.type&&a.type!=="signal"&&this.ee.emitEvent(a.type,[new b.SignalEvent(this,g,a.data,void 0)]))},u.prototype.onStreamPropertyChanged=function(a){var h=this,g=function(m){if(m.stream&&m.stream.streamId===a.streamId){var S=m.stream,_=void 0;switch(a.property){case"audioActive":_=S.audioActive,a.newValue=a.newValue==="true",S.audioActive=a.newValue;break;case"videoActive":_=S.videoActive,a.newValue=a.newValue==="true",S.videoActive=a.newValue;break;case"videoDimensions":_=S.videoDimensions,a.newValue=JSON.parse(JSON.parse(a.newValue)),S.videoDimensions=a.newValue;break;case"filter":_=S.filter,a.newValue=Object.keys(a.newValue).length>0?a.newValue:void 0,a.newValue!==void 0?(S.filter=new i.Filter(a.newValue.type,a.newValue.options),S.filter.stream=S,a.newValue.lastExecMethod&&(S.filter.lastExecMethod=a.newValue.lastExecMethod)):delete S.filter,a.newValue=S.filter;break}h.ee.emitEvent("streamPropertyChanged",[new O.StreamPropertyChangedEvent(h,S,a.property,a.newValue,_,a.reason)]),S.streamManager&&S.streamManager.emitEvent("streamPropertyChanged",[new O.StreamPropertyChangedEvent(S.streamManager,S,a.property,a.newValue,_,a.reason)])}else C.error("No stream with streamId '"+a.streamId+"' found for connection '"+a.connectionId+"' on 'streamPropertyChanged' event")};a.connectionId===this.connection.connectionId?g(this.connection):this.getRemoteConnection(a.connectionId,"onStreamPropertyChanged").then(function(m){g(m)}).catch(function(m){C.error(m)})},u.prototype.onConnectionPropertyChanged=function(a){var h;switch(a.property){case"role":h=this.connection.role.slice(),this.connection.role=a.newValue,this.connection.localOptions.role=a.newValue;break;case"record":h=this.connection.record,a.newValue=a.newValue==="true",this.connection.record=a.newValue,this.connection.localOptions.record=a.newValue;break}this.ee.emitEvent("connectionPropertyChanged",[new P.ConnectionPropertyChangedEvent(this,this.connection,a.property,a.newValue,h)])},u.prototype.onNetworkQualityLevelChangedChanged=function(a){var h=this;a.connectionId===this.connection.connectionId?this.ee.emitEvent("networkQualityLevelChanged",[new k.NetworkQualityLevelChangedEvent(this,a.newValue,a.oldValue,this.connection)]):this.getConnection(a.connectionId,"Connection not found for connectionId "+a.connectionId).then(function(g){h.ee.emitEvent("networkQualityLevelChanged",[new k.NetworkQualityLevelChangedEvent(h,a.newValue,a.oldValue,g)])}).catch(function(g){C.error(g)})},u.prototype.recvIceCandidate=function(a){var h={candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,component:null,foundation:null,port:null,priority:null,protocol:null,relatedAddress:null,relatedPort:null,tcpType:null,usernameFragment:null,type:null,toJSON:function(){return{candidate:a.candidate}}};this.getConnection(a.senderConnectionId,"Connection not found for connectionId "+a.senderConnectionId+" owning endpoint "+a.endpointName+". Ice candidate will be ignored: "+h).then(function(g){var m=g.stream;m.getWebRtcPeer().addIceCandidate(h).catch(function(S){C.error("Error adding candidate for "+m.streamId+" stream of endpoint "+a.endpointName+": "+S)})}).catch(function(g){C.error(g)})},u.prototype.onSessionClosed=function(a){C.info("Session closed: "+JSON.stringify(a));var h=a.sessionId;h!==void 0?this.ee.emitEvent("session-closed",[{session:h}]):C.warn("Session undefined on session closed",a)},u.prototype.onLostConnection=function(a){C.warn("Lost connection in Session "+this.sessionId),this.sessionId&&this.connection&&!this.connection.disposed&&this.leave(!0,a)},u.prototype.onRecoveredConnection=function(){C.info("Recovered connection in Session "+this.sessionId),this.reconnectBrokenStreams(),this.ee.emitEvent("reconnected",[])},u.prototype.onMediaError=function(a){C.error("Media error: "+JSON.stringify(a));var h=a.error;h?this.ee.emitEvent("error-media",[{error:h}]):C.warn("Received undefined media error:",a)},u.prototype.onRecordingStarted=function(a){this.ee.emitEvent("recordingStarted",[new c.RecordingEvent(this,"recordingStarted",a.id,a.name)])},u.prototype.onRecordingStopped=function(a){this.ee.emitEvent("recordingStopped",[new c.RecordingEvent(this,"recordingStopped",a.id,a.name,a.reason)])},u.prototype.onFilterEventDispatched=function(a){var h=this,g=a.connectionId;this.getConnection(g,"No connection found for connectionId "+g).then(function(m){var S;C.info("Filter event dispatched");var _=m.stream;(S=_.filter.handlers.get(a.eventType))===null||S===void 0||S.call(h,new p.FilterEvent(_.filter,a.eventType,a.data))})},u.prototype.onForciblyReconnectSubscriber=function(a){var h=this;return new Promise(function(g,m){h.getRemoteConnection(a.connectionId,"onForciblyReconnectSubscriber").then(function(S){if(S.stream&&S.stream.streamId===a.streamId){var _=S.stream;if(_.setupReconnectionEventEmitter(g,m)){if(_.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent!=null)_.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=a,m("Ongoing forced subscriber reconnection");else{_.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=a;var M=function(){var f=_.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent;delete _.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent,h.onForciblyReconnectSubscriber(f)};_.reconnectionEventEmitter.once("success",function(){M()}),_.reconnectionEventEmitter.once("error",function(){M()})}return}_.completeWebRtcPeerReceive(!0,!0,a.sdpOffer).then(function(){return _.finalResolveForSubscription(!0,g)}).catch(function(f){return _.finalRejectForSubscription(!0,"Error while forcibly reconnecting remote stream "+a.streamId+": "+f.toString(),m)})}else{var E="No stream with streamId '"+a.streamId+"' found for connection '"+a.connectionId+"' on 'streamPropertyChanged' event";C.error(E),m(E)}}).catch(function(S){C.error(S),m(S)})})},u.prototype.reconnectBrokenStreams=function(){C.info("Re-establishing media connections...");var a=!1;this.connection.stream&&this.connection.stream.streamIceConnectionStateBroken()&&(C.warn("Re-establishing Publisher "+this.connection.stream.streamId),this.connection.stream.initWebRtcPeerSend(!0),a=!0),this.remoteConnections.forEach(function(h){h.stream&&h.stream.streamIceConnectionStateBroken()&&(C.warn("Re-establishing Subscriber "+h.stream.streamId),h.stream.initWebRtcPeerReceive(!0),a=!0)}),a||C.info("There were no media streams in need of a reconnection")},u.prototype.emitEvent=function(a,h){this.ee.emitEvent(a,h)},u.prototype.leave=function(a,h){var g=this;if(a=!!a,C.info("Leaving Session (forced="+a+")"),this.stopVideoDataIntervals(),this.connection){if(!this.connection.disposed&&!a?this.openvidu.sendRequest("leaveRoom",function(S,_){S&&C.error("leaveRoom error: "+JSON.stringify(S)),g.openvidu.closeWs()}):this.openvidu.closeWs(),this.stopPublisherStream(h),!this.connection.disposed){var m=new l.SessionDisconnectedEvent(this,h);this.ee.emitEvent("sessionDisconnected",[m]),m.callDefaultBehavior()}}else C.warn("You were not connected to the session "+this.sessionId);C.flush()},u.prototype.initializeParams=function(a){var h={token:a||"",session:this.sessionId,platform:L.getDescription()?L.getDescription():"unknown",metadata:this.options.metadata?this.options.metadata:"",secret:this.openvidu.getSecret(),recorder:this.openvidu.getRecorder()};return h},u.prototype.sendVideoData=function(a,h,g,m){var S=this,_,M;if(h===void 0&&(h=1),g===void 0&&(g=!1),m===void 0&&(m=1),L.isChromeBrowser()||L.isChromeMobileBrowser()||L.isOperaBrowser()||L.isOperaMobileBrowser()||L.isEdgeBrowser()||L.isEdgeMobileBrowser()||L.isElectron()||L.isSafariBrowser()&&!L.isIonicIos()||L.isAndroidBrowser()||L.isSamsungBrowser()||L.isIonicAndroid()||L.isIOSWithSafari()){var E=function(){return t(S,void 0,void 0,function(){var R,B,x;return e(this,function(H){switch(H.label){case 0:return R=a.stream.getRTCPeerConnection(),R.connectionState!=="connected"?[3,2]:[4,R.getStats()];case 1:B=H.sent(),x=[],B.forEach(function(j){"frameWidth"in j&&"frameHeight"in j&&x.length===0&&x.push(j)}),x.length>0&&this.openvidu.sendRequest("videoData",{height:x[0].frameHeight,width:x[0].frameWidth,videoActive:a.stream.videoActive!=null?a.stream.videoActive:!1,audioActive:a.stream.audioActive!=null?a.stream.audioActive:!1},function(j,Z){j&&C.error("Error sending 'videoData' event",j)}),H.label=2;case 2:return[2]}})})};if(g){var f=1;this.videoDataInterval=setInterval(function(){f<m?(f++,E()):clearInterval(S.videoDataInterval)},h*1e3)}else this.videoDataTimeout=setTimeout(E,h*1e3)}else L.isFirefoxBrowser()||L.isFirefoxMobileBrowser()||L.isIonicIos()||L.isReactNative()?this.openvidu.sendRequest("videoData",{height:((_=a.stream.videoDimensions)===null||_===void 0?void 0:_.height)||0,width:((M=a.stream.videoDimensions)===null||M===void 0?void 0:M.width)||0,videoActive:a.stream.videoActive!=null?a.stream.videoActive:!1,audioActive:a.stream.audioActive!=null?a.stream.audioActive:!1},function(R,B){R&&C.error("Error sending 'videoData' event",R)}):C.error("Browser "+L.getName()+" (version "+L.getVersion()+") for "+L.getFamily()+" is not supported in OpenVidu for Network Quality")},u.prototype.sessionConnected=function(){return this.connection!=null},u.prototype.notConnectedError=function(){return new I.OpenViduError(I.OpenViduErrorName.OPENVIDU_NOT_CONNECTED,"There is no connection to the session. Method 'Session.connect' must be successfully completed first")},u.prototype.anySpeechEventListenerEnabled=function(a,h,g){var m=this.ee.getListeners(a);h&&(m=m.filter(function(E){return E.once}));var S=m.length;if(S>0)return!0;var _=0;if(g){var M=g.ee.getListeners(a);h&&(M=M.filter(function(E){return E.once})),_=M.length}return _>0},u.prototype.connectAux=function(a){var h=this;return new Promise(function(g,m){h.openvidu.startWs(function(S){if(S)m(S);else{var _=h.initializeParams(a);h.openvidu.sendRequest("joinRoom",_,function(M,E){if(M)m(M);else{h.processJoinRoomResponse(E),T.OpenViduLogger.configureJSNLog(h.openvidu,a),h.connection=new n.Connection(h,E);var f={connections:new Array,streams:new Array},R=E.value;R.forEach(function(B){var x=new n.Connection(h,B);h.remoteConnections.set(x.connectionId,x),f.connections.push(x),x.stream&&(h.remoteStreamsCreated.set(x.stream.streamId,!0),f.streams.push(x.stream))}),h.ee.emitEvent("connectionCreated",[new d.ConnectionEvent(!1,h,"connectionCreated",h.connection,"")]),f.connections.forEach(function(B){h.ee.emitEvent("connectionCreated",[new d.ConnectionEvent(!1,h,"connectionCreated",B,"")])}),f.streams.forEach(function(B){h.ee.emitEvent("streamCreated",[new y.StreamEvent(!1,h,"streamCreated",B,"")])}),g()}})}})})},u.prototype.stopPublisherStream=function(a){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[a]))},u.prototype.stopVideoDataIntervals=function(){clearInterval(this.videoDataInterval),clearTimeout(this.videoDataTimeout)},u.prototype.stringClientMetadata=function(a){return typeof a!="string"?JSON.stringify(a):a},u.prototype.getConnection=function(a,h){var g=this;return new Promise(function(m,S){var _=g.remoteConnections.get(a);_?m(_):g.connection.connectionId===a?m(g.connection):S(new I.OpenViduError(I.OpenViduErrorName.GENERIC_ERROR,h))})},u.prototype.getRemoteConnection=function(a,h){var g=this;return new Promise(function(m,S){var _=g.remoteConnections.get(a);if(_)m(_);else{var M="Remote connection "+a+" unknown when '"+h+"'. Existing remote connections: "+JSON.stringify(g.remoteConnections.keys());S(new I.OpenViduError(I.OpenViduErrorName.GENERIC_ERROR,M))}})},u.prototype.processToken=function(a){var h=a.match(/^(wss?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(h){var g={protocol:h[1],host:h[2],hostname:h[3],port:h[4],pathname:h[5],search:h[6],hash:h[7]},m=a.split("?"),S=decodeURI(m[1]).split("&").map(function(R){return R.split("=")}).reduce(function(R,B){var x=B[0],H=B[1];return R[x]=H,R},{});this.sessionId=S.sessionId;var _=S.secret,M=S.recorder,E=S.webrtcStatsInterval,f=S.sendBrowserLogs;_&&(this.openvidu.secret=_),M&&(this.openvidu.recorder=!0),E&&(this.openvidu.webrtcStatsInterval=+E),f&&(this.openvidu.sendBrowserLogs=f),this.openvidu.isPro=!!E&&!!f,this.openvidu.wsUri="wss://"+g.host+"/openvidu",this.openvidu.httpUri="https://"+g.host}else C.error('Token "'+a+'" is not valid')},u.prototype.processJoinRoomResponse=function(a){if(this.sessionId=a.session,a.coturnIp!=null&&a.turnUsername!=null&&a.turnCredential!=null){var h="turn:"+a.coturnIp+":3478";this.openvidu.iceServers=[{urls:[h],username:a.turnUsername,credential:a.turnCredential}],C.log("STUN/TURN server IP: "+a.coturnIp),C.log("TURN temp credentials ["+a.turnUsername+":"+a.turnCredential+"]")}this.openvidu.role=a.role,this.openvidu.finalUserId=a.finalUserId,this.openvidu.mediaServer=a.mediaServer,this.capabilities={subscribe:!0,publish:this.openvidu.role!=="SUBSCRIBER",forceUnpublish:this.openvidu.role==="MODERATOR",forceDisconnect:this.openvidu.role==="MODERATOR"},C.info("openvidu-server version: "+a.version),a.life!=null&&(this.openvidu.life=a.life),a.version!==this.openvidu.libraryVersion&&C.warn("OpenVidu Server ("+a.version+") and OpenVidu Browser ("+this.openvidu.libraryVersion+") versions do NOT match. There may be incompatibilities")},u}(s.EventDispatcher);return nt.Session=F,nt}var _n;function tn(){if(_n)return tt;_n=1;var r=W&&W.__extends||function(){var k=function(I,v){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,D){T.__proto__=D}||function(T,D){for(var C in D)Object.prototype.hasOwnProperty.call(D,C)&&(T[C]=D[C])},k(I,v)};return function(I,v){k(I,v);function T(){this.constructor=I}I.prototype=v===null?Object.create(v):(T.prototype=v.prototype,new T)}}(),t=W&&W.__awaiter||function(k,I,v,T){function D(C){return C instanceof v?C:new v(function(L){L(C)})}return new(v||(v=Promise))(function(C,L){function F(a){try{u(T.next(a))}catch(h){L(h)}}function U(a){try{u(T.throw(a))}catch(h){L(h)}}function u(a){a.done?C(a.value):D(a.value).then(F,U)}u((T=T.apply(k,I||[])).next())})},e=W&&W.__generator||function(k,I){var v={label:0,sent:function(){if(C[0]&1)throw C[1];return C[1]},trys:[],ops:[]},T,D,C,L;return L={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function F(u){return function(a){return U([u,a])}}function U(u){if(T)throw new TypeError("Generator is already executing.");for(;v;)try{if(T=1,D&&(C=u[0]&2?D.return:u[0]?D.throw||((C=D.return)&&C.call(D),0):D.next)&&!(C=C.call(D,u[1])).done)return C;switch(D=0,C&&(u=[u[0]&2,C.value]),u[0]){case 0:case 1:C=u;break;case 4:return v.label++,{value:u[1],done:!1};case 5:v.label++,D=u[1],u=[0];continue;case 7:u=v.ops.pop(),v.trys.pop();continue;default:if(C=v.trys,!(C=C.length>0&&C[C.length-1])&&(u[0]===6||u[0]===2)){v=0;continue}if(u[0]===3&&(!C||u[1]>C[0]&&u[1]<C[3])){v.label=u[1];break}if(u[0]===6&&v.label<C[1]){v.label=C[1],C=u;break}if(C&&v.label<C[2]){v.label=C[2],v.ops.push(u);break}C[2]&&v.ops.pop(),v.trys.pop();continue}u=I.call(k,v)}catch(a){u=[6,a],D=0}finally{T=C=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(tt,"__esModule",{value:!0}),tt.Publisher=void 0;var n=Nt(),i=qe,o=Je,s=en(),d=ke,p=Qe,c=xe,l=oe,b=Ce,y=l.OpenViduLogger.getInstance(),O,P=function(k){r(I,k);function I(v,T,D){var C=k.call(this,new i.Stream(D.session?D.session:new n.Session(D),{publisherProperties:T,mediaConstraints:{}}),v)||this;return C.accessAllowed=!1,C.isSubscribedToRemote=!1,C.accessDenied=!1,O=b.PlatformUtils.getInstance(),C.properties=T,C.openvidu=D,C.stream.ee.on("local-stream-destroyed",function(L){C.stream.isLocalStreamPublished=!1;var F=new s.StreamEvent(!0,C,"streamDestroyed",C.stream,L);C.emitEvent("streamDestroyed",[F]),F.callDefaultBehavior()}),C}return I.prototype.publishAudio=function(v){var T=this;if(this.stream.audioActive!==v){var D=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream();D.getAudioTracks().forEach(function(C){C.enabled=v}),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:v,reason:"publishAudio"},function(C,L){C?y.error("Error sending 'streamPropertyChanged' event",C):(T.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(T.session,T.stream,"audioActive",v,!v,"publishAudio")]),T.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(T,T.stream,"audioActive",v,!v,"publishAudio")]),T.session.sendVideoData(T.stream.streamManager))}),this.stream.audioActive=v,y.info("'Publisher' has "+(v?"published":"unpublished")+" its audio stream")}},I.prototype.publishVideo=function(v){var T=this;if(this.stream.videoActive!==v){var D=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream();D.getVideoTracks().forEach(function(C){C.enabled=v}),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:v,reason:"publishVideo"},function(C,L){C?y.error("Error sending 'streamPropertyChanged' event",C):(T.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(T.session,T.stream,"videoActive",v,!v,"publishVideo")]),T.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(T,T.stream,"videoActive",v,!v,"publishVideo")]),T.session.sendVideoData(T.stream.streamManager))}),this.stream.videoActive=v,y.info("'Publisher' has "+(v?"published":"unpublished")+" its video stream")}},I.prototype.subscribeToRemote=function(v){v=v!==void 0?v:!0,this.isSubscribedToRemote=v,this.stream.subscribeToMyRemote(v)},I.prototype.on=function(v,T){var D=this;return k.prototype.on.call(this,v,T),v==="streamCreated"&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new s.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",function(){D.emitEvent("streamCreated",[new s.StreamEvent(!1,D,"streamCreated",D.stream,"")])})),v==="remoteVideoPlaying"&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&this.emitEvent("remoteVideoPlaying",[new p.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),v==="accessAllowed"&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),v==="accessDenied"&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},I.prototype.once=function(v,T){var D=this;return k.prototype.once.call(this,v,T),v==="streamCreated"&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new s.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",function(){D.emitEvent("streamCreated",[new s.StreamEvent(!1,D,"streamCreated",D.stream,"")])})),v==="remoteVideoPlaying"&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&this.emitEvent("remoteVideoPlaying",[new p.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),v==="accessAllowed"&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),v==="accessDenied"&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},I.prototype.replaceTrack=function(v){return t(this,void 0,void 0,function(){var T,D,C,L,F=this;return e(this,function(U){switch(U.label){case 0:T=function(){return new Promise(function(u,a){var h=F.stream.displayMyRemote()?F.stream.localMediaStreamWhenSubscribedToRemote:F.stream.getMediaStream(),g;v.kind==="video"?g=h.getVideoTracks()[0]:g=h.getAudioTracks()[0],h.removeTrack(g),g.stop(),h.addTrack(v),v.kind==="video"&&F.stream.isLocalStreamPublished&&(F.openvidu.sendNewVideoDimensionsIfRequired(F,"trackReplaced",50,30),F.session.sendVideoData(F.stream.streamManager,5,!0,5)),u()})},D=function(){return new Promise(function(u,a){var h=F.stream.getRTCPeerConnection().getSenders(),g;if(v.kind==="video"){if(g=h.find(function(m){return!!m.track&&m.track.kind==="video"}),!g){a(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object"));return}}else if(v.kind==="audio"){if(g=h.find(function(m){return!!m.track&&m.track.kind==="audio"}),!g){a(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object"));return}}else{a(new Error("Unknown track kind "+v.kind));return}g.replaceTrack(v).then(function(){u()}).catch(function(m){a(m)})})},C=v.enabled,v.kind==="video"?v.enabled=this.stream.videoActive:v.kind==="audio"&&(v.enabled=this.stream.audioActive),U.label=1;case 1:return U.trys.push([1,7,,8]),this.stream.isLocalStreamPublished?[4,D()]:[3,4];case 2:return U.sent(),[4,T()];case 3:return[2,U.sent()];case 4:return[4,T()];case 5:return[2,U.sent()];case 6:return[3,8];case 7:throw L=U.sent(),v.enabled=C,L;case 8:return[2]}})})},I.prototype.initialize=function(){var v=this;return new Promise(function(T,D){var C={},L={},F=1500,U,u=function(m){v.accessDenied=!0,v.accessAllowed=!1,y.error("Publisher initialization failed. "+m.name+": "+m.message),D(m)},a=function(m){if(v.accessAllowed=!0,v.accessDenied=!1,typeof MediaStreamTrack<"u"&&v.properties.audioSource instanceof MediaStreamTrack&&(m.removeTrack(m.getAudioTracks()[0]),m.addTrack(v.properties.audioSource)),typeof MediaStreamTrack<"u"&&v.properties.videoSource instanceof MediaStreamTrack&&(m.removeTrack(m.getVideoTracks()[0]),m.addTrack(v.properties.videoSource)),m.getAudioTracks()[0]){var S=v.stream.audioActive!==void 0&&v.stream.audioActive!==null?v.stream.audioActive:!!v.stream.outboundStreamOpts.publisherProperties.publishAudio;m.getAudioTracks()[0].enabled=S}if(m.getVideoTracks()[0]){var S=v.stream.videoActive!==void 0&&v.stream.videoActive!==null?v.stream.videoActive:!!v.stream.outboundStreamOpts.publisherProperties.publishVideo;m.getVideoTracks()[0].enabled=S}v.initializeVideoReference(m),v.stream.displayMyRemote()||v.stream.updateMediaStreamInVideos(),delete v.firstVideoElement,v.stream.isSendVideo()?v.getVideoDimensions(m).then(function(_){v.stream.videoDimensions={width:_.width,height:_.height},v.stream.isSendScreen()&&(v.screenShareResizeInterval=setInterval(function(){var M=m.getVideoTracks()[0].getSettings(),E=M.width,f=M.height;v.stream.isLocalStreamPublished&&(E!==v.stream.videoDimensions.width||f!==v.stream.videoDimensions.height)&&v.openvidu.sendVideoDimensionsChangedEvent(v,"screenResized",v.stream.videoDimensions.width,v.stream.videoDimensions.height,E||0,f||0)},650)),v.stream.isLocalStreamReadyToPublish=!0,v.stream.ee.emitEvent("stream-ready-to-publish",[])}):(v.stream.isLocalStreamReadyToPublish=!0,v.stream.ee.emitEvent("stream-ready-to-publish",[])),T()},h=function(m,S){v.clearPermissionDialogTimer(U,F),v.stream.isSendScreen()&&v.stream.isSendAudio()?(L.audio=S,L.video=!1,U=Date.now(),v.setPermissionDialogTimer(F),navigator.mediaDevices.getUserMedia(L).then(function(_){v.clearPermissionDialogTimer(U,F),m.addTrack(_.getAudioTracks()[0]),a(m)}).catch(function(_){v.clearPermissionDialogTimer(U,F),m.getAudioTracks().forEach(function(M){M.stop()}),m.getVideoTracks().forEach(function(M){M.stop()}),u(v.openvidu.generateAudioDeviceError(_,C))})):a(m)},g=function(m){y.error("getMediaError: "+m.toString()),v.clearPermissionDialogTimer(U,F),m.name==="Error"&&(m.name=m.constructor.name);var S,_;switch(m.name.toLowerCase()){case"notfounderror":navigator.mediaDevices.getUserMedia({audio:!1,video:C.video}).then(function(M){M.getVideoTracks().forEach(function(E){E.stop()}),S=c.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,_=m.toString(),u(new c.OpenViduError(S,_))}).catch(function(M){S=c.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,_=m.toString(),u(new c.OpenViduError(S,_))});break;case"notallowederror":S=v.stream.isSendScreen()?c.OpenViduErrorName.SCREEN_CAPTURE_DENIED:c.OpenViduErrorName.DEVICE_ACCESS_DENIED,_=m.toString(),u(new c.OpenViduError(S,_));break;case"overconstrainederror":navigator.mediaDevices.getUserMedia({audio:!1,video:C.video}).then(function(M){M.getVideoTracks().forEach(function(E){E.stop()}),m.constraint.toLowerCase()==="deviceid"?(S=c.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,_="Audio input device with deviceId '"+C.audio.deviceId.exact+"' not found"):(S=c.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,_="Audio input device doesn't support the value passed for constraint '"+m.constraint+"'"),u(new c.OpenViduError(S,_))}).catch(function(M){m.constraint.toLowerCase()==="deviceid"?(S=c.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,_="Video input device with deviceId '"+C.video.deviceId.exact+"' not found"):(S=c.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,_="Video input device doesn't support the value passed for constraint '"+m.constraint+"'"),u(new c.OpenViduError(S,_))});break;case"aborterror":case"notreadableerror":S=c.OpenViduErrorName.DEVICE_ALREADY_IN_USE,_=m.toString(),u(new c.OpenViduError(S,_));break;default:S=c.OpenViduErrorName.GENERIC_ERROR,_=m.toString(),u(new c.OpenViduError(S,_));break}};v.openvidu.generateMediaConstraints(v.properties).then(function(m){var S,_;if(m.videoTrack&&m.audioTrack||m.audioTrack&&((S=m.constraints)===null||S===void 0?void 0:S.video)===!1||m.videoTrack&&((_=m.constraints)===null||_===void 0?void 0:_.audio)===!1){a(v.openvidu.addAlreadyProvidedTracks(m,new MediaStream));return}C=m.constraints;var M={mediaConstraints:C,publisherProperties:v.properties};v.stream.setOutboundStreamOptions(M);var E=C.audio===void 0?!0:C.audio;L.audio=v.stream.isSendScreen()?!1:E,L.video=C.video,U=Date.now(),v.setPermissionDialogTimer(F),v.stream.isSendScreen()&&navigator.mediaDevices.getDisplayMedia&&!O.isElectron()?navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(f){v.openvidu.addAlreadyProvidedTracks(m,f),h(f,E)}).catch(function(f){g(f)}):navigator.mediaDevices.getUserMedia(L).then(function(f){v.openvidu.addAlreadyProvidedTracks(m,f),h(f,E)}).catch(function(f){g(f)})}).catch(function(m){u(m)})})},I.prototype.getVideoDimensions=function(v){var T=this;return new Promise(function(D,C){var L=O.isIonicIos()||O.isIOSWithSafari(),F,U=function(){var u,a;if(typeof T.stream.getMediaStream().getVideoTracks()[0].getSettings=="function"){var h=T.stream.getMediaStream().getVideoTracks()[0].getSettings();u=h.width||T.videoReference.videoWidth,a=h.height||T.videoReference.videoHeight}else y.warn("MediaStreamTrack does not have getSettings method on "+O.getDescription()),u=T.videoReference.videoWidth,a=T.videoReference.videoHeight;F!=null&&T.videoReference.removeEventListener("loadedmetadata",F),L&&document.body.removeChild(T.videoReference),D({width:u,height:a})};T.videoReference.readyState>=1?U():(F=function(){if(T.videoReference.videoWidth)U();else var u=setInterval(function(){T.videoReference.videoWidth&&(clearInterval(u),U())},40)},T.videoReference.addEventListener("loadedmetadata",F),L&&document.body.appendChild(T.videoReference))})},I.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},I.prototype.initializeVideoReference=function(v){this.videoReference=document.createElement("video"),this.videoReference.setAttribute("muted","true"),this.videoReference.style.display="none",(O.isSafariBrowser()||O.isIPhoneOrIPad()&&(O.isChromeMobileBrowser()||O.isEdgeMobileBrowser()||O.isOperaMobileBrowser()||O.isFirefoxMobileBrowser()))&&this.videoReference.setAttribute("playsinline","true"),this.stream.setMediaStream(v),this.firstVideoElement&&this.createVideoElement(this.firstVideoElement.targetElement,this.properties.insertMode),this.videoReference.srcObject=v},I.prototype.setPermissionDialogTimer=function(v){var T=this;this.permissionDialogTimeout=setTimeout(function(){T.emitEvent("accessDialogOpened",[])},v)},I.prototype.clearPermissionDialogTimer=function(v,T){clearTimeout(this.permissionDialogTimeout),Date.now()-v>T&&this.emitEvent("accessDialogClosed",[])},I}(o.StreamManager);return tt.Publisher=P,tt}var Hn={};window.getScreenId=function(r,t,e){if(navigator.userAgent.indexOf("Edge")!==-1&&(navigator.msSaveOrOpenBlob||navigator.msSaveBlob)){t({video:!0});return}if(navigator.mozGetUserMedia){t(null,"firefox",{video:{mozMediaSource:r,mediaSource:r}});return}window.addEventListener("message",n);function n(i){i.data&&(i.data.chromeMediaSourceId&&(i.data.chromeMediaSourceId==="PermissionDeniedError"?t("permission-denied"):t(null,i.data.chromeMediaSourceId,Rn(null,i.data.chromeMediaSourceId,i.data.canRequestAudioTrack)),window.removeEventListener("message",n)),i.data.chromeExtensionStatus&&(t(i.data.chromeExtensionStatus,null,Rn(i.data.chromeExtensionStatus)),window.removeEventListener("message",n)))}setTimeout(e?function(){Ct(e)}:Ct,100)};function Rn(r,t,e){var n={audio:!1,video:{mandatory:{chromeMediaSource:r?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return e&&(n.audio={mandatory:{chromeMediaSource:r?"screen":"desktop"},optional:[]}),t&&(n.video.mandatory.chromeMediaSourceId=t,n.audio&&n.audio.mandatory&&(n.audio.mandatory.chromeMediaSourceId=t)),n}function Ct(r){if(!be){nn(function(){Ct(r)});return}if(!be.isLoaded){setTimeout(function(){Ct(r)},100);return}r?r.forEach?be.contentWindow.postMessage({captureCustomSourceId:r},"*"):be.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):be.contentWindow.postMessage({captureSourceId:!0},"*")}var be;window.getScreenConstraints=function(r){nn(function(){getScreenId(function(t,e,n){n||(n={video:!0}),r(t,n.video)})})};function nn(r){if(be){r();return}be=document.createElement("iframe"),be.onload=function(){be.isLoaded=!0,r()},be.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",be.style.display="none",(document.body||document.documentElement).appendChild(be)}window.getChromeExtensionStatus=function(r){if(navigator.mozGetUserMedia){r("installed-enabled");return}window.addEventListener("message",t);function t(e){e.data&&e.data.chromeExtensionStatus&&(r(e.data.chromeExtensionStatus),window.removeEventListener("message",t))}setTimeout(zt,100)};function zt(){if(!be){nn(zt);return}if(!be.isLoaded){setTimeout(zt,100);return}be.contentWindow.postMessage({getChromeExtensionStatus:!0},"*")}Hn.getScreenId=window.getScreenId;var et={},Me="screen",De,$e;if(typeof window<"u"&&typeof navigator<"u"&&typeof navigator.userAgent<"u"){var $n=typeof window.InstallTrigger<"u";window.opera||navigator.userAgent.indexOf(" OPR/")>=0,window.addEventListener("message",function(r){r.origin==window.location.origin&&lo(r.data)})}function lo(r){if(r=="PermissionDeniedError"){if($e)return $e("PermissionDeniedError");throw new Error("PermissionDeniedError")}r=="rtcmulticonnection-extension-loaded"&&(Me="desktop"),r.sourceId&&$e&&$e(De=r.sourceId,r.canRequestAudioTrack===!0)}function ho(r){if(r){if(Me=="desktop")return r(!0);window.postMessage("are-you-there","*"),setTimeout(function(){Me=="screen"?r(!1):r(!0)},2e3)}}function qn(r){if(!r)throw'"callback" parameter is mandatory.';if(De)return r(De);$e=r,window.postMessage("get-sourceId","*")}function po(r){if(!r)throw'"callback" parameter is mandatory.';if(De)return r(De);$e=r,window.postMessage("audio-plus-tab","*")}function vo(r,t){if($n)return t("not-chrome");arguments.length!=2&&(t=r,r="lfcgfepafnobdloecchnfaclibenjold");var e=document.createElement("img");e.src="chrome-extension://"+r+"/icon.png",e.onload=function(){Me="screen",window.postMessage("are-you-there","*"),setTimeout(function(){Me=="screen"?t("installed-disabled"):t("installed-enabled")},2e3)},e.onerror=function(){t("not-installed")}}function mo(r){Gn(r,!0)}function Gn(r,t){De="";var e={mozMediaSource:"window",mediaSource:"window"};if($n)return r(null,e);var n={mandatory:{chromeMediaSource:Me,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};if(Me=="desktop"&&!De){t?po(function(i,o){n.mandatory.chromeMediaSourceId=i,o&&(n.canRequestAudioTrack=!0),r(i=="PermissionDeniedError"?i:null,n)}):qn(function(i){n.mandatory.chromeMediaSourceId=i,r(i=="PermissionDeniedError"?i:null,n)});return}Me=="desktop"&&(n.mandatory.chromeMediaSourceId=De),r(null,n)}et.getScreenConstraints=Gn;et.getScreenConstraintsWithAudio=mo;et.isChromeExtensionAvailable=ho;et.getChromeExtensionStatus=vo;et.getSourceId=qn;const go={},bo=Object.freeze(Object.defineProperty({__proto__:null,default:go},Symbol.toStringTag,{value:"Module"})),Eo=Ln(bo);var Jt={exports:{}};typeof Object.create=="function"?Jt.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Jt.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}};var So=Jt.exports,rn={},on={};function yo(r,t){var e={jsonrpc:"2.0"};if(r.method)e.method=r.method,r.params&&(e.params=r.params),t!=null&&(e.id=t);else if(t!=null){if(r.error){if(r.result!==void 0)throw new TypeError("Both result and error are defined");e.error=r.error}else if(r.result!==void 0)e.result=r.result;else throw new TypeError("No result or error is defined");e.id=t}return JSON.stringify(e)}function wo(r){var t=r;(typeof r=="string"||r instanceof String)&&(t=JSON.parse(r));var e=t.jsonrpc;if(e!=="2.0")throw new TypeError("Invalid JsonRPC version '"+e+"': "+r);if(t.method==null){if(t.id==null)throw new TypeError("Invalid message: "+r);var n=t.result!==void 0,i=t.error!==void 0;if(n&&i)throw new TypeError("Both result and error are defined: "+r);if(!n&&!i)throw new TypeError("No result or error is defined: "+r);t.ack=t.id,delete t.id}return t}on.pack=yo;on.unpack=wo;var sn={};function Co(r){throw new TypeError("Not yet implemented")}function Oo(r){throw new TypeError("Not yet implemented")}sn.pack=Co;sn.unpack=Oo;var _o=on,Ro=sn;rn.JsonRPC=_o;rn.XmlRPC=Ro;function zn(){var r={};this.forEach=function(t){for(var e in r){var n=r[e];for(var i in n)t(n[i])}},this.get=function(t,e){var n=r[e];if(n!=null)return n[t]},this.remove=function(t,e){var n=r[e];if(n!=null){delete n[t];for(var i in n)return!1;delete r[e]}},this.set=function(t,e,n){if(t==null)return this.remove(e,n);var i=r[n];i==null&&(r[n]=i={}),i[e]=t}}zn.prototype.pop=function(r,t){var e=this.get(r,t);if(e!=null)return this.remove(r,t),e};var Io=zn,Ft={},jt,In;function Jn(){if(In)return jt;In=1;var r=oe.OpenViduLogger,t=r.getInstance(),e=2e3,n=3e3,i=3;function o(s){var d=!1,p,c=s.uri,l=!1,b=new WebSocket(c);b.onopen=function(){t.debug("WebSocket connected to "+c),s.onconnected&&s.onconnected()},b.onerror=function(k){t.error("Could not connect to "+c+" (invoking onerror if defined)",k),s.onerror&&s.onerror(k)};var y=function(){b.readyState===i?d?t.debug("Connection closed by user"):s.ismasternodecrashed()?t.error("Master Node has crashed. Stopping reconnection process"):(t.debug("Connection closed unexpectedly. Reconnecting..."),O(e,1)):t.debug("Close callback from previous websocket. Ignoring it")};b.onclose=y;function O(k,I){if(t.debug("reconnect (attempt #"+I+", max="+k+")"),I===1){if(l){t.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection.");return}else l=!0;s.onreconnecting&&s.onreconnecting()}P(k,I)}function P(k,I){t.debug("Reconnection attempt #"+I),b.close(),b=new WebSocket(c),b.onopen=function(){t.debug("Reconnected to "+c+" after "+I+" attempts..."),l=!1,p(),s.onreconnected()&&s.onreconnected(),b.onclose=y},b.onerror=function(v){t.warn("Reconnection error: ",v),I===k?s.ondisconnect&&s.ondisconnect():setTimeout(function(){O(k,I+1)},n)}}this.close=function(){d=!0,b.close()},this.forceClose=function(){b.close()},this.reconnectWs=function(){t.debug("reconnectWs"),O(e,1)},this.send=function(k){b.send(k)},this.addEventListener=function(k,I){p=function(){b.addEventListener(k,I)},p()},this.getReadyState=function(){return b.readyState}}return jt=o,jt}var Ut,Pn;function Po(){if(Pn)return Ut;Pn=1;var r=Xn(),t=Jn(),e=oe.OpenViduLogger;Date.now=Date.now||function(){return+new Date};var n=5e3,i="RECONNECTING",o="CONNECTED",s="DISCONNECTED",d=e.getInstance();function p(c){var l=this,b=c.ws,y=-1,O=0,P=!0,k=!1,I,v=s,T=b.onreconnecting,D=b.onreconnected,C=b.onconnected,L=b.onerror;c.rpc.pull=function(S,_){_.reply(null,"push")},b.onreconnecting=function(){if(d.debug("--------- ONRECONNECTING -----------"),v===i){d.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it");return}m(),v=i,T&&T()},b.onreconnected=function(){if(d.debug("--------- ONRECONNECTED -----------"),v===o){d.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it");return}v=o,a(),D&&D()},b.onconnected=function(){if(d.debug("--------- ONCONNECTED -----------"),v===o){d.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it");return}v=o,P=!0,g(),C&&C()},b.onerror=function(S){d.debug("--------- ONERROR -----------"),v=s,m(),L&&L(S)};var F=new t(b);d.debug("Connecting websocket to URI: "+b.uri);var U={request_timeout:c.rpc.requestTimeout,ping_request_timeout:c.rpc.heartbeatRequestTimeout},u=new r(r.packers.JsonRPC,U,F,function(S){d.debug("Received request: "+JSON.stringify(S));try{var _=c.rpc[S.method];_===void 0?d.error("Method "+S.method+" not registered in client"):_(S.params,S)}catch(M){d.error("Exception processing request: "+JSON.stringify(S)),d.error(M)}});this.send=function(S,_,M){var E=Date.now();u.encode(S,_,function(f,R){if(f){try{d.error("ERROR:"+f.message+" in Request: method:"+S+" params:"+JSON.stringify(_)+" request:"+f.request),f.data&&d.error("ERROR DATA:"+JSON.stringify(f.data))}catch{}f.requestTime=E}M&&(R!=null&&R.value!=="pong"&&d.debug("Response: "+JSON.stringify(R)),M(f,R))})};function a(){d.debug("notReconnectIfNumLessThan = "+O+" (old="+y+")"),y=O}function h(){if(P){var S=null;(O==0||O==y)&&(S={interval:c.heartbeat||n}),O++,l.send("ping",S,function(_){return function(M,E){M&&(d.debug("Error in ping request #"+_+" ("+M.message+")"),_>y&&(P=!1,a(),d.debug("Server did not respond to ping message #"+_+". Reconnecting... "),F.reconnectWs()))}}(O))}else d.debug("Trying to send ping, but ping is not enabled")}function g(){k||(d.debug("Starting ping (if configured)"),k=!0,c.heartbeat!=null&&(I=setInterval(h,c.heartbeat),h()))}function m(){clearInterval(I),k=!1,P=!1,O=-1,u.cancel()}this.close=function(S,_){d.debug("Closing  with code: "+S+" because: "+_),I!=null&&(d.debug("Clearing ping interval"),clearInterval(I)),k=!1,P=!1,F.close(S,_)},this.forceClose=function(S){F.forceClose(S)},this.reconnect=function(){F.reconnectWs()},this.resetPing=function(){P=!0,O=0,g()},this.getReadyState=function(){return F.getReadyState()}}return Ut=p,Ut}var kn;function ko(){if(kn)return Ft;kn=1;var r=Po();return Ft.JsonRpcClient=r,Ft}var Ht={},Tn;function To(){if(Tn)return Ht;Tn=1;var r=Jn();return Ht.WebSocketWithReconnection=r,Ht}var $t,Nn;function Xn(){if(Nn)return $t;Nn=1;var r=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch{r=!0}Function.prototype.bind||(Function.prototype.bind=function(y){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var O=Array.prototype.slice.call(arguments,1),P=this,k=function(){},I=function(){return P.apply(this instanceof k&&y?this:y,O.concat(Array.prototype.slice.call(arguments)))};return k.prototype=this.prototype,I.prototype=new k,I});var t=Eo.EventEmitter,e=So,n=rn,i=Io,o=5e3;function s(y){if(!y)return{};for(var O in y){var P=y[O];typeof P=="string"&&(y[O]={response:P})}return y}function d(y){if(y){if(y instanceof Function)return{send:y};if(y.send instanceof Function)return y;if(y.postMessage instanceof Function)return y.send=y.postMessage,y;if(y.write instanceof Function)return y.send=y.write,y;if(y.onmessage===void 0&&!(y.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function p(y,O){r?(this.method=y,this.params=O):(Object.defineProperty(this,"method",{value:y,enumerable:!0}),Object.defineProperty(this,"params",{value:O,enumerable:!0}))}function c(y,O,P,k){var I=this;if(!y)throw new SyntaxError("Packer is not defined");if(!y.pack||!y.unpack)throw new SyntaxError("Packer is invalid");var v=s(y.responseMethods);if(O instanceof Function){if(P!=null)throw new SyntaxError("There can't be parameters after onRequest");k=O,P=void 0,O=void 0}if(O&&O.send instanceof Function){if(P&&!(P instanceof Function))throw new SyntaxError("Only a function can be after transport");k=P,P=O,O=void 0}if(P instanceof Function){if(k!=null)throw new SyntaxError("There can't be parameters after onRequest");k=P,P=void 0}if(P&&P.send instanceof Function&&k&&!(k instanceof Function))throw new SyntaxError("Only a function can be after transport");O=O||{},t.call(this),k&&this.on("request",k),r?this.peerID=O.peerID:Object.defineProperty(this,"peerID",{value:O.peerID});var T=O.max_retries||0;function D(f){I.decode(f.data||f)}this.getTransport=function(){return P},this.setTransport=function(f){P&&(P.removeEventListener?P.removeEventListener("message",D):P.removeListener&&P.removeListener("data",D)),f&&(f.addEventListener?f.addEventListener("message",D):f.addListener&&f.addListener("data",D)),P=d(f)},r||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(P);var C=O.request_timeout||o,L=O.ping_request_timeout||C,F=O.response_timeout||o,U=O.duplicates_timeout||o,u=0,a=new i,h=new i,g=new i,m={};function S(f,R,B){var x={message:f,timeout:setTimeout(function(){h.remove(R,B)},F)};h.set(x,R,B)}function _(f,R){var B=setTimeout(function(){g.remove(f,R)},U);g.set(B,f,R)}function M(f,R,B,x,H){p.call(this,f,R),this.getTransport=function(){return H},this.setTransport=function(J){H=d(J)},r||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var j=h.get(B,x);H||I.getTransport()||(r?this.duplicated=!!j:Object.defineProperty(this,"duplicated",{value:!!j}));var Z=v[f];this.pack=y.pack.bind(y,this,B),this.reply=function(J,te,w){if(J instanceof Function||J&&J.send instanceof Function){if(te!=null)throw new SyntaxError("There can't be parameters after callback");w=J,te=null,J=void 0}else if(te instanceof Function||te&&te.send instanceof Function){if(w!=null)throw new SyntaxError("There can't be parameters after callback");w=te,te=null}w=d(w),j&&clearTimeout(j.timeout),x!=null&&(J&&(J.dest=x),te&&(te.dest=x));var re;if(J||te!=null){if(I.peerID!=null&&(J?J.from=I.peerID:te.from=I.peerID),Z)if(Z.error==null&&J)re={error:J};else{var $=J?Z.error:Z.response;re={method:$,params:J||te}}else re={error:J,result:te};re=y.pack(re,B)}else j?re=j.message:re=y.pack({result:null},B);return S(re,B,x),w=w||this.getTransport()||I.getTransport(),w?w.send(re):re}}e(M,p);function E(f){var R=m[f];if(R){delete m[f];var B=a.pop(R.id,R.dest);B&&(clearTimeout(B.timeout),_(R.id,R.dest))}}this.cancel=function(f){if(f)return E(f);for(var f in m)E(f)},this.close=function(){var f=this.getTransport();f&&f.close&&f.close(4003,"Cancel request"),this.cancel(),g.forEach(clearTimeout),h.forEach(function(R){clearTimeout(R.timeout)})},this.encode=function(f,R,B,x,H){if(R instanceof Function){if(B!=null)throw new SyntaxError("There can't be parameters after callback");H=R,x=void 0,B=void 0,R=void 0}else if(B instanceof Function){if(x!=null)throw new SyntaxError("There can't be parameters after callback");H=B,x=void 0,B=void 0}else if(x instanceof Function){if(H!=null)throw new SyntaxError("There can't be parameters after callback");H=x,x=void 0}I.peerID!=null&&(R=R||{},R.from=I.peerID),B!=null&&(R=R||{},R.dest=B);var j={method:f,params:R};if(H){let re=function(A,Ee){I.cancel(j),H(A,Ee)},$=function(A){var Ee=f==="ping"?L:C;return te.timeout=setTimeout(ue,Ee*Math.pow(2,J++)),m[j]={id:Z,dest:B},a.set(te,Z,B),A=A||w||I.getTransport(),A?A.send(j):j},Oe=function(A){A=d(A),console.warn(J+" retry for request message:",j);var Ee=g.pop(Z,B);return clearTimeout(Ee),$(A)},ue=function(){if(J<T)return Oe(x);var A=new Error("Request has timed out");A.request=j,A.retry=Oe,re(A)};var Z=u++,J=0;j=y.pack(j,Z);var te={message:j,callback:re,responseMethods:v[f]||{}},w=d(x);return $(x)}return j=y.pack(j),x=x||this.getTransport(),x?x.send(j):j},this.decode=function(f,R){if(!f)throw new TypeError("Message is not defined");try{f=y.unpack(f)}catch(N){return console.debug(N,f)}var B=f.id,x=f.ack,H=f.method,j=f.params||{},Z=j.from,J=j.dest;if(I.peerID!=null&&Z==I.peerID)return;if(B==null&&x==null){var te=new p(H,j);return I.emit("request",te)?void 0:te}function w(){if(R=d(R)||I.getTransport(),R){var N=h.get(B,Z);if(N)return R.send(N.message)}var q=B??x,ie=new M(H,j,q,Z,R);if(!I.emit("request",ie))return ie}function re(N,q,ie){N.callback(q,ie)}function $(N){console.warn("Response already processed",f),clearTimeout(N),_(x,Z)}if(H){if(J==null||J==I.peerID){var z=a.get(x,Z);if(z){var Oe=z.responseMethods;return H==Oe.error?re(z,j):H==Oe.response?re(z,null,j):w()}var ue=g.get(x,Z);if(ue)return $(ue)}return w()}var A=f.error,Ee=f.result;if(!(A&&A.dest&&A.dest!=I.peerID)&&!(Ee&&Ee.dest&&Ee.dest!=I.peerID)){var z=a.get(x,Z);if(!z){var ue=g.get(x,Z);return ue?$(ue):console.warn("No callback was defined for this message",f)}re(z,A,Ee)}}}e(c,t),c.RpcNotification=p,$t=c;var l=ko(),b=To();return c.clients=l,c.clients.transports=b,c.packers=n,$t}const No="OpenVidu",Mo={freeice:"2.2.2",hark:"1.2.3",jsnlog:"2.30.0",platform:"1.3.6",uuid:"8.3.2","wolfy87-eventemitter":"5.2.9"},Do="OpenVidu Browser",Ao={"@types/node":"15.12.2","@types/platform":"1.3.3",browserify:"17.0.0",grunt:"1.4.1","grunt-cli":"1.4.3","grunt-contrib-copy":"1.0.0","grunt-contrib-sass":"2.0.0","grunt-contrib-uglify":"5.0.1","grunt-contrib-watch":"1.1.0","grunt-postcss":"0.9.0","grunt-string-replace":"1.3.1","grunt-ts":"6.0.0-beta.22",terser:"5.7.0",tsify:"5.0.4",tslint:"6.1.3",typedoc:"0.19.2",typescript:"4.0.7"},Lo="Apache-2.0",Vo="lib/index.js",xo="openvidu-browser",Bo={type:"git",url:"git://github.com/OpenVidu/openvidu"},Wo={browserify:"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js Main.ts -p [ tsify ] --exclude kurento-browser-extensions --debug -o ../static/js/openvidu-browser-$VERSION.js -v","browserify-prod":"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js --debug Main.ts -p [ tsify ] --exclude kurento-browser-extensions | ../node_modules/terser/bin/terser --source-map content=inline --output ../static/js/openvidu-browser-$VERSION.min.js",build:"cd src/OpenVidu && ./../../node_modules/typescript/bin/tsc && cd ../.. && ./node_modules/typescript/bin/tsc --declaration src/index.ts --outDir ./lib --sourceMap --target es5 --lib dom,es5,es2015.promise,scripthost",docs:"./generate-docs.sh"},Fo="lib/index.d.ts",jo="2.20.0",Uo={author:No,dependencies:Mo,description:Do,devDependencies:Ao,license:Lo,main:Vo,name:xo,repository:Bo,scripts:Wo,types:Fo,version:jo};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.OpenVidu=void 0;var Ho=rt,$o=tn(),Mn=Nt(),qo=Ze,Dn=ke,Y=xe,qt=st,Go=oe,zo=Ce,Jo=Hn,An=et,Xo=Qt,Yo=Kt,Qo=Xn(),Ko=Uo,ee=Go.OpenViduLogger.getInstance(),X,Zo=function(){function r(){var t=this;this.masterNodeHasCrashed=!1,this.publishers=[],this.secret="",this.recorder=!1,this.life=-1,this.advancedConfiguration={},this.webrtcStatsInterval=-1,this.sendBrowserLogs=Xo.OpenViduLoggerConfiguration.disabled,this.isPro=!1,this.ee=new Yo,X=zo.PlatformUtils.getInstance(),this.libraryVersion=Ko.version,ee.info("OpenVidu initialized"),ee.info("Platform detected: "+X.getDescription()),ee.info("openvidu-browser version: "+this.libraryVersion),(X.isMobileDevice()||X.isReactNative())&&this.onOrientationChanged(function(){t.publishers.forEach(function(e){e.stream.isLocalStreamPublished&&e.stream&&e.stream.hasVideo&&t.sendNewVideoDimensionsIfRequired(e,"deviceRotated",75,10)})})}return r.prototype.onOrientationChanged=function(t){window.addEventListener("orientationchange",t)},r.prototype.sendNewVideoDimensionsIfRequired=function(t,e,n,i){var o=this,s=0,d=t.stream.videoDimensions.width,p=t.stream.videoDimensions.height,c=setInterval(function(){s++,s>i&&clearTimeout(c),t.getVideoDimensions(t.stream.getMediaStream()).then(function(l){(l.width!==d||l.height!==p)&&(clearTimeout(c),o.sendVideoDimensionsChangedEvent(t,e,d,p,l.width,l.height))})},n)},r.prototype.sendVideoDimensionsChangedEvent=function(t,e,n,i,o,s){var d=this;t.stream.videoDimensions={width:o||0,height:s||0},this.sendRequest("streamPropertyChanged",{streamId:t.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(t.stream.videoDimensions),reason:e},function(p,c){p?ee.error("Error sending 'streamPropertyChanged' event",p):(d.session.emitEvent("streamPropertyChanged",[new Dn.StreamPropertyChangedEvent(d.session,t.stream,"videoDimensions",t.stream.videoDimensions,{width:n,height:i},e)]),t.emitEvent("streamPropertyChanged",[new Dn.StreamPropertyChangedEvent(t,t.stream,"videoDimensions",t.stream.videoDimensions,{width:n,height:i},e)]),d.session.sendVideoData(t))})},r.prototype.initSession=function(){return this.session=new Mn.Session(this),this.session},r.prototype.initPublisher=function(t,e,n){var i;e&&typeof e!="function"?(i=e,i={audioSource:typeof i.audioSource<"u"?i.audioSource:void 0,frameRate:typeof MediaStreamTrack<"u"&&i.videoSource instanceof MediaStreamTrack?void 0:typeof i.frameRate<"u"?i.frameRate:void 0,insertMode:typeof i.insertMode<"u"?typeof i.insertMode=="string"?qt.VideoInsertMode[i.insertMode]:i.insertMode:qt.VideoInsertMode.APPEND,mirror:typeof i.mirror<"u"?i.mirror:!0,publishAudio:typeof i.publishAudio<"u"?i.publishAudio:!0,publishVideo:typeof i.publishVideo<"u"?i.publishVideo:!0,resolution:typeof MediaStreamTrack<"u"&&i.videoSource instanceof MediaStreamTrack?void 0:typeof i.resolution<"u"?i.resolution:"640x480",videoSource:typeof i.videoSource<"u"?i.videoSource:void 0,filter:i.filter}):i={insertMode:qt.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var o=new $o.Publisher(t,i,this),s;return e&&typeof e=="function"?s=e:n&&(s=n),o.initialize().then(function(){s!==void 0&&s(void 0),o.emitEvent("accessAllowed",[])}).catch(function(d){s!==void 0&&s(d),o.emitEvent("accessDenied",[d])}),this.publishers.push(o),o},r.prototype.initPublisherAsync=function(t,e){var n=this;return new Promise(function(i,o){var s,d=function(p){p?o(p):i(s)};e?s=n.initPublisher(t,e,d):s=n.initPublisher(t,d)})},r.prototype.initLocalRecorder=function(t){return new Ho.LocalRecorder(t)},r.prototype.checkSystemRequirements=function(){return X.isIPhoneOrIPad()?X.isIOSWithSafari()||X.isIonicIos()||X.isChromeMobileBrowser()||X.isEdgeMobileBrowser()||X.isOperaMobileBrowser()||X.isFirefoxMobileBrowser()?1:0:X.isChromeBrowser()||X.isChromeMobileBrowser()||X.isFirefoxBrowser()||X.isFirefoxMobileBrowser()||X.isOperaBrowser()||X.isOperaMobileBrowser()||X.isEdgeBrowser()||X.isEdgeMobileBrowser()||X.isSafariBrowser()||X.isAndroidBrowser()||X.isElectron()||X.isSamsungBrowser()?1:0},r.prototype.checkScreenSharingCapabilities=function(){return X.canScreenShare()},r.prototype.getDevices=function(){return new Promise(function(t,e){navigator.mediaDevices.enumerateDevices().then(function(n){var i,o=[];X.isIonicAndroid()&&typeof cordova<"u"&&(!((i=cordova==null?void 0:cordova.plugins)===null||i===void 0)&&i.EnumerateDevicesPlugin)?cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then(function(s){var d=[],p=[],c=[];d=s.filter(function(l){return l.kind==="audioinput"}),p=n.filter(function(l){return l.kind==="videoinput"}),c=n.filter(function(l){return l.kind==="audioinput"}),p.forEach(function(l,b){if(l.label)o.push({kind:l.kind,deviceId:l.deviceId,label:l.label});else{var y="";b===0?y="Front Camera":b===1?y="Back Camera":y="Unknown Camera",o.push({kind:l.kind,deviceId:l.deviceId,label:y})}}),c.forEach(function(l,b){if(l.label)o.push({kind:l.kind,deviceId:l.deviceId,label:l.label});else{var y="";switch(b){case 0:y="Default";break;case 1:var O=d.filter(function(I){return I.label.includes("Built")})[0];y=O?O.label:"Built-in Microphone";break;case 2:var P=d.filter(function(I){return I.label.includes("Wired")})[0];P?y=P.label:y="Headset earpiece";break;case 3:var k=d.filter(function(I){return I.label.includes("Bluetooth")})[0];y=k?k.label:"Wireless";break;default:y="Unknown Microphone";break}o.push({kind:l.kind,deviceId:l.deviceId,label:y})}}),t(o)}):(n.forEach(function(s){(s.kind==="audioinput"||s.kind==="videoinput")&&o.push({kind:s.kind,deviceId:s.deviceId,label:s.label})}),t(o))}).catch(function(n){ee.error("Error getting devices",n),e(n)})})},r.prototype.getUserMedia=function(t){var e=this;return new Promise(function(n,i){var o=function(s,d){var p=d.audio===void 0?!0:d.audio,c={audio:p,video:!1};navigator.mediaDevices.getUserMedia(c).then(function(l){s.addTrack(l.getAudioTracks()[0]),n(s)}).catch(function(l){s.getAudioTracks().forEach(function(b){b.stop()}),s.getVideoTracks().forEach(function(b){b.stop()}),i(e.generateAudioDeviceError(l,c))})};e.generateMediaConstraints(t).then(function(s){var d,p;if(s.videoTrack&&s.audioTrack||s.audioTrack&&((d=s.constraints)===null||d===void 0?void 0:d.video)===!1||s.videoTrack&&((p=s.constraints)===null||p===void 0?void 0:p.audio)===!1)n(e.addAlreadyProvidedTracks(s,new MediaStream));else{s.videoTrack&&delete s.constraints.video,s.audioTrack&&delete s.constraints.audio;var c=!1;if(typeof t.videoSource=="string"&&(t.videoSource==="screen"||t.videoSource==="window"||X.isElectron()&&t.videoSource.startsWith("screen:"))&&(c=!s.audioTrack&&t.audioSource!==null&&t.audioSource!==!1,navigator.mediaDevices.getDisplayMedia&&!X.isElectron())){navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(b){if(e.addAlreadyProvidedTracks(s,b),c){o(b,s.constraints);return}else n(b)}).catch(function(b){var y=Y.OpenViduErrorName.SCREEN_CAPTURE_DENIED,O=b.toString();i(new Y.OpenViduError(y,O))});return}var l=c?{video:s.constraints.video}:s.constraints;navigator.mediaDevices.getUserMedia(l).then(function(b){if(e.addAlreadyProvidedTracks(s,b),c){o(b,s.constraints);return}else n(b)}).catch(function(b){var y,O=b.toString();t.videoSource!=="screen"?y=Y.OpenViduErrorName.DEVICE_ACCESS_DENIED:y=Y.OpenViduErrorName.SCREEN_CAPTURE_DENIED,i(new Y.OpenViduError(y,O))})}}).catch(function(s){i(s)})})},r.prototype.enableProdMode=function(){ee.enableProdMode()},r.prototype.setAdvancedConfiguration=function(t){this.advancedConfiguration=t},r.prototype.generateMediaConstraints=function(t){var e=this;return new Promise(function(n,i){var o={audioTrack:void 0,videoTrack:void 0,constraints:{audio:void 0,video:void 0}},s=t.audioSource,d=t.videoSource;if((s===null||s===!1)&&(o.constraints.audio=!1),(d===null||d===!1)&&(o.constraints.video=!1),o.constraints.audio===!1&&o.constraints.video===!1&&i(new Y.OpenViduError(Y.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time")),typeof MediaStreamTrack<"u"&&s instanceof MediaStreamTrack&&(o.audioTrack=s),typeof MediaStreamTrack<"u"&&d instanceof MediaStreamTrack&&(o.videoTrack=d),s===void 0&&(o.constraints.audio=!0),d===void 0&&(o.constraints.video={width:{ideal:640},height:{ideal:480}}),d!==null&&d!==!1){if(t.resolution){var p=t.resolution.toLowerCase().split("x"),c=Number(p[0]),l=Number(p[1]);o.constraints.video={width:{ideal:c},height:{ideal:l}}}t.frameRate&&(o.constraints.video.frameRate={ideal:t.frameRate})}e.configureDeviceIdOrScreensharing(o,t,n,i),n(o)})},r.prototype.startWs=function(t){var e={heartbeat:5e3,ws:{uri:this.wsUri+"?sessionId="+this.session.sessionId,onconnected:t,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this),ismasternodecrashed:this.isMasterNodeCrashed.bind(this)},rpc:{requestTimeout:1e4,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),connectionPropertyChanged:this.session.onConnectionPropertyChanged.bind(this.session),networkQualityLevelChanged:this.session.onNetworkQualityLevelChangedChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session),masterNodeCrashedNotification:this.onMasterNodeCrashedNotification.bind(this),forciblyReconnectSubscriber:this.session.onForciblyReconnectSubscriber.bind(this.session)}};this.jsonRpcClient=new Qo.clients.JsonRpcClient(e)},r.prototype.onMasterNodeCrashedNotification=function(t){console.error("Master Node has crashed"),this.masterNodeHasCrashed=!0,this.session.onLostConnection("nodeCrashed"),this.jsonRpcClient.close(4103,"Master Node has crashed")},r.prototype.getWsReadyState=function(){return this.jsonRpcClient.getReadyState()},r.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},r.prototype.sendRequest=function(t,e,n){e&&e instanceof Function&&(n=e,e={}),ee.debug('Sending request: {method:"'+t+'", params: '+JSON.stringify(e)+"}"),this.jsonRpcClient.send(t,e,n)},r.prototype.getWsUri=function(){return this.wsUri},r.prototype.getSecret=function(){return this.secret},r.prototype.getRecorder=function(){return this.recorder},r.prototype.generateAudioDeviceError=function(t,e){t.name==="Error"&&(t.name=t.constructor.name);var n,i;switch(t.name.toLowerCase()){case"notfounderror":return n=Y.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i=t.toString(),new Y.OpenViduError(n,i);case"notallowederror":return n=Y.OpenViduErrorName.DEVICE_ACCESS_DENIED,i=t.toString(),new Y.OpenViduError(n,i);case"overconstrainederror":return t.constraint.toLowerCase()==="deviceid"?(n=Y.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i="Audio input device with deviceId '"+e.audio.deviceId.exact+"' not found"):(n=Y.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,i="Audio input device doesn't support the value passed for constraint '"+t.constraint+"'"),new Y.OpenViduError(n,i);case"notreadableerror":return n=Y.OpenViduErrorName.DEVICE_ALREADY_IN_USE,i=t.toString(),new Y.OpenViduError(n,i);default:return new Y.OpenViduError(Y.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR,t.toString())}},r.prototype.addAlreadyProvidedTracks=function(t,e){return t.videoTrack&&e.addTrack(t.videoTrack),t.audioTrack&&e.addTrack(t.audioTrack),e},r.prototype.configureDeviceIdOrScreensharing=function(t,e,n,i){var o=this,s=e.audioSource,d=e.videoSource;if(typeof s=="string"&&(t.constraints.audio={deviceId:{exact:s}}),typeof d=="string")if(!this.isScreenShare(d))this.setVideoSource(t,d);else if(this.checkScreenSharingCapabilities())if(X.isElectron()){var c="screen:",l=d,b=l.substr(l.indexOf(c)+c.length);t.constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:b}},n(t)}else if(this.advancedConfiguration.screenShareChromeExtension&&!(X.isFirefoxBrowser()||X.isFirefoxMobileBrowser())&&!navigator.mediaDevices.getDisplayMedia){An.getScreenConstraints(function(O,P){if(O||P.mandatory&&P.mandatory.chromeMediaSource==="screen")if(O==="permission-denied"||O==="PermissionDeniedError"){var k=new Y.OpenViduError(Y.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");ee.error(k),i(k)}else{var I=o.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();An.getChromeExtensionStatus(I,function(v){if(v==="installed-disabled"){var T=new Y.OpenViduError(Y.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");ee.error(T),i(T)}if(v==="not-installed"){var D=new Y.OpenViduError(Y.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,o.advancedConfiguration.screenShareChromeExtension);ee.error(D),i(D)}});return}else t.constraints.video=P,n(t)});return}else if(navigator.mediaDevices.getDisplayMedia)n(t);else{var y=X.isFirefoxBrowser()||X.isFirefoxMobileBrowser()?e.videoSource:void 0;Jo.getScreenId(y,function(O,P,k){if(O)if(O==="not-installed"){var I=o.advancedConfiguration.screenShareChromeExtension?o.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",v=new Y.OpenViduError(Y.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,I);ee.error(v),i(v)}else if(O==="installed-disabled"){var v=new Y.OpenViduError(Y.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");ee.error(v),i(v)}else if(O==="permission-denied"){var v=new Y.OpenViduError(Y.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");ee.error(v),i(v)}else{var v=new Y.OpenViduError(Y.OpenViduErrorName.GENERIC_ERROR,"Unknown error when accessing screen share");ee.error(v),ee.error(O),i(v)}else t.constraints.video=k.video,n(t)});return}else{var p=new Y.OpenViduError(Y.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera, Safari (>=13.0), Edge (>= 80) or Electron. Detected client: "+X.getName()+" "+X.getVersion());ee.error(p),i(p)}},r.prototype.setVideoSource=function(t,e){t.constraints.video||(t.constraints.video={}),t.constraints.video.deviceId={exact:e}},r.prototype.disconnectCallback=function(){ee.warn("Websocket connection lost"),this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},r.prototype.reconnectingCallback=function(){ee.warn("Websocket connection lost (reconnecting)"),this.isRoomAvailable()?this.session.emitEvent("reconnecting",[]):alert("Connection error. Please reload page.")},r.prototype.reconnectedCallback=function(){var t=this;if(ee.warn("Websocket reconnected"),this.isRoomAvailable())if(this.session.connection)this.sendRequest("connect",{sessionId:this.session.connection.rpcSessionId},function(n,i){if(n)if(t.isMasterNodeCrashed())ee.warn("Master Node has crashed!");else{ee.error(n);var o=function(s){ee.warn("Websocket was able to reconnect to OpenVidu Server, but your Connection was already destroyed due to timeout. You are no longer a participant of the Session and your media streams have been destroyed"),t.session.onLostConnection("networkDisconnect"),t.jsonRpcClient.close(4101,"Reconnection fault")};t.life===-1?o(n):t.sendRequest("sessionStatus",{sessionId:t.session.sessionId},function(s,d){t.life===d.life?o(s):(ee.warn("Websocket was able to reconnect to OpenVidu Server, but your Master Node crashed."),t.session.onLostConnection("nodeCrashed"),t.jsonRpcClient.close(4101,"Reconnection fault"))})}else t.jsonRpcClient.resetPing(),t.session.onRecoveredConnection()});else{ee.warn("There was no previous connection when running reconnection callback");var e=new qo.SessionDisconnectedEvent(this.session,"networkDisconnect");this.session.ee.emitEvent("sessionDisconnected",[e]),e.callDefaultBehavior()}else alert("Connection error. Please reload page.")},r.prototype.isMasterNodeCrashed=function(){return this.masterNodeHasCrashed},r.prototype.isRoomAvailable=function(){return this.session!==void 0&&this.session instanceof Mn.Session?!0:(ee.warn("Session instance not found"),!1)},r.prototype.isScreenShare=function(t){return t==="screen"||t==="window"||X.isElectron()&&t.startsWith("screen:")},r}();Ot.OpenVidu=Zo;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.EventDispatcher=r.ExceptionEvent=r.NetworkQualityLevelChangedEvent=r.FilterEvent=r.ConnectionPropertyChangedEvent=r.StreamPropertyChangedEvent=r.VideoElementEvent=r.StreamManagerEvent=r.StreamEvent=r.SignalEvent=r.SessionDisconnectedEvent=r.RecordingEvent=r.PublisherSpeakingEvent=r.ConnectionEvent=r.Event=r.VideoInsertMode=r.OpenViduError=r.LocalRecorderState=r.Filter=r.LocalRecorder=r.Connection=r.Stream=r.StreamManager=r.Subscriber=r.Publisher=r.Session=r.OpenVidu=void 0;var t=Xt,e=Ot;Object.defineProperty(r,"OpenVidu",{enumerable:!0,get:function(){return e.OpenVidu}});var n=Nt();Object.defineProperty(r,"Session",{enumerable:!0,get:function(){return n.Session}});var i=tn();Object.defineProperty(r,"Publisher",{enumerable:!0,get:function(){return i.Publisher}});var o=ze;Object.defineProperty(r,"Subscriber",{enumerable:!0,get:function(){return o.Subscriber}});var s=Je;Object.defineProperty(r,"StreamManager",{enumerable:!0,get:function(){return s.StreamManager}});var d=qe;Object.defineProperty(r,"Stream",{enumerable:!0,get:function(){return d.Stream}});var p=ot;Object.defineProperty(r,"Connection",{enumerable:!0,get:function(){return p.Connection}});var c=rt;Object.defineProperty(r,"LocalRecorder",{enumerable:!0,get:function(){return c.LocalRecorder}});var l=Ge;Object.defineProperty(r,"Filter",{enumerable:!0,get:function(){return l.Filter}});var b=Yt;Object.defineProperty(r,"LocalRecorderState",{enumerable:!0,get:function(){return b.LocalRecorderState}});var y=xe;Object.defineProperty(r,"OpenViduError",{enumerable:!0,get:function(){return y.OpenViduError}});var O=st;Object.defineProperty(r,"VideoInsertMode",{enumerable:!0,get:function(){return O.VideoInsertMode}});var P=de;Object.defineProperty(r,"Event",{enumerable:!0,get:function(){return P.Event}});var k=ct;Object.defineProperty(r,"ConnectionEvent",{enumerable:!0,get:function(){return k.ConnectionEvent}});var I=at;Object.defineProperty(r,"PublisherSpeakingEvent",{enumerable:!0,get:function(){return I.PublisherSpeakingEvent}});var v=ut;Object.defineProperty(r,"RecordingEvent",{enumerable:!0,get:function(){return v.RecordingEvent}});var T=Ze;Object.defineProperty(r,"SessionDisconnectedEvent",{enumerable:!0,get:function(){return T.SessionDisconnectedEvent}});var D=ft;Object.defineProperty(r,"SignalEvent",{enumerable:!0,get:function(){return D.SignalEvent}});var C=en();Object.defineProperty(r,"StreamEvent",{enumerable:!0,get:function(){return C.StreamEvent}});var L=Ye;Object.defineProperty(r,"StreamManagerEvent",{enumerable:!0,get:function(){return L.StreamManagerEvent}});var F=Qe;Object.defineProperty(r,"VideoElementEvent",{enumerable:!0,get:function(){return F.VideoElementEvent}});var U=ke;Object.defineProperty(r,"StreamPropertyChangedEvent",{enumerable:!0,get:function(){return U.StreamPropertyChangedEvent}});var u=lt;Object.defineProperty(r,"ConnectionPropertyChangedEvent",{enumerable:!0,get:function(){return u.ConnectionPropertyChangedEvent}});var a=dt;Object.defineProperty(r,"FilterEvent",{enumerable:!0,get:function(){return a.FilterEvent}});var h=ht;Object.defineProperty(r,"NetworkQualityLevelChangedEvent",{enumerable:!0,get:function(){return h.NetworkQualityLevelChangedEvent}});var g=Ke;Object.defineProperty(r,"ExceptionEvent",{enumerable:!0,get:function(){return g.ExceptionEvent}});var m=Xe;Object.defineProperty(r,"EventDispatcher",{enumerable:!0,get:function(){return m.EventDispatcher}}),t.JL.setOptions({enabled:!1})})(ai);const es={name:"OvVideo"},ts=Object.assign(es,{props:{streamManager:Object},setup(r){const t=r,e=ti(null);return ni(()=>{t.streamManager.addVideoElement(e.value)}),(n,i)=>(Vn(),xn("video",{ref_key:"videoEl",ref:e,autoplay:""},null,512))}}),ns={key:0},is={name:"UserVideo"},ss=Object.assign(is,{props:{streamManager:Object},setup(r){const t=r,e=ii(()=>{const{clientData:i}=n();return i});function n(){const{connection:i}=t.streamManager.stream;return JSON.parse(i.data)}return(i,o)=>r.streamManager?(Vn(),xn("div",ns,[ri(ts,{"stream-manager":r.streamManager},null,8,["stream-manager"]),dn("div",null,[dn("p",null,oi(e.value),1)])])):si("",!0)}});export{ss as _,ai as l};
